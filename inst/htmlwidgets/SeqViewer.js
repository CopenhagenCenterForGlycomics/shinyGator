(function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(r,'a',r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=14)})([function(e,t,r){'use strict';(function(e){/*!
  * bean.js - copyright Jacob Thornton 2011
  * https://github.com/fat/bean
  * MIT License
  * special thanks to:
  * dean edwards: http://dean.edwards.name/
  * dperini: https://github.com/dperini/nwevents
  * the entire mootools team: github.com/mootools/mootools-core
  */const r=function(t){function r(e){var t=e.relatedTarget;return t?t!=this&&'xul'!=t.prefix&&!/document/.test(this.toString())&&!f(this,t):null===t}var n=1,s={},o={},d=/over|out/,l=/[^\.]*(?=\..*)\.|.*/,c=/\..*/,u='addEventListener',p='attachEvent',h=t.document||{},g=h.documentElement||{},m=g[u],_=m?u:p,f=function(e,t){for(var r=t.parentNode;null!==r;){if(r==e)return!0;r=r.parentNode}},y=function(e,t){return e.__uid=t&&t+'::'+n++||e.__uid||n++},v=function(e){var t=y(e);return s[t]=s[t]||{}},b=m?function(e,t,r,n){e[n?u:'removeEventListener'](t,r,!1)}:function(e,t,r,n,s){s&&n&&(e['_on'+s]=e['_on'+s]||0),e[n?p:'detachEvent']('on'+t,r)},x=function(e,r,n){return function(s,o){return s=R(s||((this.ownerDocument||this.document||this).parentWindow||t).event),r.apply(e,[s].concat(n).concat(o))}},E=function(t,r,n,s,o){return function(d){(s?s.apply(this,arguments):!!m||d&&d.propertyName=='_on'+n||!d)&&r.apply(t,Array.prototype.slice.call(arguments,d?0:1).concat(o))}},A=function(e,t,r,n){var s=t.replace(c,''),d=v(e),u=d[s]||(d[s]={}),p=r,h=y(r,t.replace(l,''));if(u[h])return e;var g=N[s];g&&(r=g.condition?E(e,r,s,g.condition):r,s=g.base||s);var f=L[s];if(r=f?x(e,r,n):E(e,r,s,!1,n),f=m||f,'unload'==s){var A=r;r=function(){w(e,s,r)&&A()}}return e[_]&&b(e,f?s:'propertychange',r,!0,!f&&s),u[h]=r,r.__uid=h,r.__originalFn=p,'unload'==s?e:o[y(e)]=e},w=function(e,t,r){function n(t){if((r=s[o][t],!!r)&&(delete s[o][t],e[_])){o=N[o]?N[o].base:o;var n=m||L[o];b(e,n?o:'propertychange',r,!1,!n&&o)}}var s=v(e),o=t.replace(c,''),d,u,p;if(!s||!s[o])return e;for(d=t.replace(l,''),u=d?d.split('.'):[r.__uid],n(d),p=u.length;p--;n(u[p]));return e},T=function(t,e,r){return function(n){for(var s='string'==typeof t?r(t,this):t,o=n.target;o&&o!=this;o=o.parentNode)for(var d=s.length;d--;)if(s[d]==o)return e.apply(o,arguments)}},C=function e(t,r,n,s,o){if('object'==typeof r&&!n)for(var d in r)r.hasOwnProperty(d)&&e(t,d,r[d]);else{var l='string'==typeof n,c=(l?n:r).split(' ');n=l?T(r,s,o):n;for(var u=c.length;u--;)A(t,c[u],n,Array.prototype.slice.call(arguments,l?4:3))}return t},k=function e(t,r,n){var s='string'==typeof r,o=s&&r.replace(l,''),o=o&&o.split('.'),d=w,u=v(t),p,h,g,m,_;if(s&&/\s/.test(r)){for(r=r.split(' '),_=r.length-1;e(t,r[_])&&_--;);return t}if(m=s?r.replace(c,''):r,!u||o||s&&!u[m]){for(p in u)if(u.hasOwnProperty(p))for(_ in u[p])for(h=o.length;h--;)u[p].hasOwnProperty(_)&&new RegExp('^'+o[h]+'::\\d*(\\..*)?$').test(_)&&d(t,[p,_].join('.'));return t}if('function'==typeof n)d(t,m,n);else if(o)d(t,r);else for(p in d=m?d:e,g=s&&m,m=m?n||u[m]||m:u,m)m.hasOwnProperty(p)&&(d(t,g||p,m[p]),delete m[p]);return t},S=m?function(e,r,n){evt=document.createEvent(e?'HTMLEvents':'UIEvents'),evt[e?'initEvent':'initUIEvent'](r,!0,!0,t,1),n.dispatchEvent(evt)}:function(e,t,r){e?r.fireEvent('on'+t,document.createEventObject()):r['_on'+t]++},R=function t(r){var n={};if(!r)return n;var s=r.type,o=r.target||r.srcElement;for(var l in n.preventDefault=t.preventDefault(r),n.stopPropagation=t.stopPropagation(r),n.target=o&&3==o.nodeType?o.parentNode:o,s&&s.indexOf('key')?n.keyCode=r.which||r.keyCode:/click|mouse|menu/i.test(s)&&(n.rightClick=3==r.which||2==r.button,n.pos={x:0,y:0},r.pageX||r.pageY?(n.clientX=r.pageX,n.clientY=r.pageY):(r.clientX||r.clientY)&&(n.clientX=r.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.clientY=r.clientY+document.body.scrollTop+document.documentElement.scrollTop),d.test(s)&&(n.relatedTarget=r.relatedTarget||r[('mouseover'==s?'from':'to')+'Element'])),r)l in n||(n[l]=r[l]);return n};R.preventDefault=function(t){return function(){t.preventDefault?t.preventDefault():t.returnValue=!1}},R.stopPropagation=function(t){return function(){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}};var L={click:1,dblclick:1,mouseup:1,mousedown:1,contextmenu:1,mousewheel:1,DOMMouseScroll:1,mouseover:1,mouseout:1,mousemove:1,selectstart:1,selectend:1,keydown:1,keypress:1,keyup:1,orientationchange:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1,focus:1,blur:1,change:1,reset:1,select:1,submit:1,load:1,unload:1,beforeunload:1,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:0,abort:1,scroll:1},N={mouseenter:{base:'mouseover',condition:r},mouseleave:{base:'mouseout',condition:r}},q={add:C,remove:k,clone:function e(t,r,n){var s=v(r),o=y(t),d,l;for(l in d=n?s[n]:s,d)d.hasOwnProperty(l)&&(n?C:e)(t,n||r,n?d[l].__originalFn:l);return t},fire:function(e,t,r){var n=t.split(' '),s,o,d;for(o=n.length;o--;){t=n[o].replace(c,'');var u=L[t],p=n[o].replace(l,''),h=v(e)[t];if(p)for(p=p.split('.'),s=p.length;s--;)for(d in h)h.hasOwnProperty(d)&&new RegExp('^'+p[s]+'::\\d*(\\..*)?$').test(d)&&h[d].apply(e,[!1].concat(r));else if(!r&&e[_])S(u,t,e);else for(s in h)h.hasOwnProperty(s)&&h[s].apply(e,[!1].concat(r))}return e}},O=function(e){var t=k(e).__uid;t&&(delete o[t],delete s[t])};t[p]&&C(t,'unload',function(){for(var e in o)o.hasOwnProperty(e)&&O(o[e]);t.CollectGarbage&&CollectGarbage()});var D=t.bean;return q.noConflict=function(){return t.bean=D,this},'undefined'!=typeof e&&e.exports?e.exports=q:t.bean=q,q}({});t.a=r}).call(t,r(6)(e))},function(e,t,r){'use strict';var n=r(0);const s={};Object.defineProperty&&!s.IE8&&function(){var e=[],t=!1;Object.defineProperty(s,'ready',{get:function(){return!!(0!==e.length||t)&&function(){e.forEach(function(e){e.call()})}},set:function(r){return!1===r||!0===r?(e=[],r&&(t=!0),t):t?void r.call():void e.push(r)}})}(),s.registerGroup=function(e,t){if(this.groups||(this.groups={}),!this.groups[e]){var r=new s.Group;if(r.name=e,t=t||{},t.hide_member_controllers&&(r.hide_member_controllers=!0),t.hide_group_controller&&(r.hide_group_controller=!0),t.fullname&&(r.fullname=t.fullname),t.color&&(r.color=t.color),t.group){if(r.group=this.getGroup(t.group),!r.group)throw'Cannot register this layer with the given group - the group has not been registered yet';r.group._layers.push(r)}return r._layers=[],r.group_id=new Date().getMilliseconds(),this.groups[e]=r,n.a.fire(s,'groupRegistered',[r]),r}},s.registerLayer=function(e,t,r){this.layers||(this.layers={}),r||(r=[]);var o;if(this.layers[e]&&((this.layers[e].disabled||0<r.length)&&(this.layers[e].disabled=!1,n.a.fire(s,'layerRegistered',[this.layers[e]].concat(r))),o=this.layers[e]),o&&t.group&&(o.group!==this.getGroup(t.group)&&(o.group=this.getGroup(t.group),o.group._layers.push(o)),!o.group))throw'Cannot register this layer with the given group - the group has not been registered yet';if(o)return o;if(o=new s.Layer,o.name=e,t=t||{},t.fullname&&(o.fullname=t.fullname),t.color&&(o.color=t.color),t.data&&(o.data=t.data),o&&t.group){if(o.group=this.getGroup(t.group),!o.group)throw'Cannot register this layer with the given group - the group has not been registered yet';o.group._layers.push(o)}return this.layers[e]=o,t.css&&console.log('options.css is deprecated'),o.layer_id=new Date().getMilliseconds(),n.a.fire(s,'layerRegistered',[o].concat(r)),o},s.Group=function(){},s.Group.prototype.size=function(){for(var e=0,t=0;t<this._layers.length;t++)this._layers[t].disabled||(e+=1);return e},s.Group.prototype.eachLayer=function(e){for(var t=0;t<this._layers.length;t++)this._layers[t].disabled||e.call(this._layers[t],this._layers[t])},s.Layer=function(){this.scales=new Set},s.getLayer=function(e){return s.layers?'string'==typeof e?s.layers[e]:e:void 0},s.getGroup=function(e){return'undefined'==typeof e?void 0:s.groups?'string'==typeof e?s.groups[e]:e==s.groups[e.name]?e:null:void 0},t.a=s},function(e,t,r){'use strict';var n=r(0),s=r(7),o=r(1);const d=function(){};let l=Symbol('resultclass');d.buildService=function(e){let t=class extends d{constructor(e,r){return super(),this._endpointURL='undefined'==typeof r?t.SERVICE_URL:r,this.agi=e,this}toString(){for(var e in o.a)if(this===o.a[e])return'MASCP.'+e}get Result(){return this[l]||this.constructor.Result}set Result(e){this[l]=e}};return t.Result=class{constructor(t){return e.apply(this,[t]),this}},Object.assign(e.apply({},[]),t.Result.prototype),t},d.clone=function(e,t){var r=d.buildService(function(){return this});return r.Result=e.Result,r.prototype=new e,o.a[t]=r,r.prototype.__class__=r,r},d.prototype=Object.assign({agi:null,result:null,async:!0},d.prototype),d.prototype._dataReceived=function(e,t){if(!e)return!1;var r=this.Result;if(e&&e.error&&''!=e.error&&null!==e.error)return n.a.fire(this,'error',[e.error]),!1;if('[object Array]'===Object.prototype.toString.call(e)){for(var s=0;s<e.length;s++)arguments.callee.call(this,e[s],t);0===s&&(this.result=new r),this.result._raw_data={data:e}}else if(!this.result){var o;try{o=new r(e)}catch(e){return n.a.fire(this,'error',[e]),!1}o._raw_data||(o._raw_data=e),this.result=o}else{try{r.call(this.result,e)}catch(e){return n.a.fire(this,'error',[e]),!1}this.result._raw_data||(this.result._raw_data=e)}return e&&e.retrieved&&(this.result.retrieved=e.retrieved,this.result._raw_data.retrieved=e.retrieved),this.result.agi=this.agi,!0},d.prototype.gotResult=function(){var e=this,t=function(t){t.readers||(t.readers=[]),t.readers.push(e.toString())};n.a.add(o.a,'layerRegistered',t),n.a.add(o.a,'groupRegistered',t),n.a.fire(e,'resultReceived');try{n.a.remove(o.a,'layerRegistered',t),n.a.remove(o.a,'groupRegistered',t)}catch(t){}n.a.fire(d,'resultReceived')},d.prototype.requestComplete=function(){n.a.fire(this,'requestComplete'),n.a.fire(d,'requestComplete',[this])},d.prototype.requestIncomplete=function(){n.a.fire(this,'requestIncomplete'),n.a.fire(d,'requestIncomplete',[this])},d.registeredLayers=function(e){var t=[];for(var r in o.a.layers)if(o.a.layers.hasOwnProperty(r)){var n=o.a.layers[r];n.readers&&0<=n.readers.indexOf(e.toString())&&t.push(n)}return t},d.registeredGroups=function(e){var t=[];for(var r in o.a.groups)if(o.a.groups.hasOwnProperty(r)){var n=o.a.groups[r];n.readers&&0<=n.readers.indexOf(e.toString())&&t.push(n)}return t},d.prototype.bind=function(e,t){return n.a.add(this,e,t),this},d.prototype.once=function(e,t){var r=this;r.bind(e,function s(){n.a.remove(r,e,s),t.apply(r,[].slice.call(arguments))})},d.prototype.unbind=function(e,t){return n.a.remove(this,e,t),this},function(e){var t=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r+'='+e[r]);return t.join('&')},r={},s=function(n){n.async=!0;var e=null;if(!n.url)return void n.success.call(null,null);var s=new XMLHttpRequest;if('GET'==n.type&&n.data){var d=n.url.indexOf('?');d==n.url.length-1&&(n.url=n.url.slice(0,-1),d=-1);var l=0<=d?'&':'?';n.url=n.url.replace(/\?$/,'')+l+t(n.data)}if('GET'==n.type&&n.session_cache){if(r[n.url])return void r[n.url].then(function(e){n.success.call(null,e)}).catch(function(e){n.error.apply(null,[null,s,e])});var c=n.success,u=n.error;r[n.url]=new Promise(function(e,t){n.success=function(t){e(t)},n.error=function(e,s,o){t([e,s,o]),delete r[n.url]}}),r[n.url].catch(function(e){u.apply(null,e)}).then(function(e){c.call(null,e)})}s.open(n.type,n.url,n.async),'POST'==n.type&&(s.setRequestHeader('Content-Type',n.content?n.content:'application/x-www-form-urlencoded'),e=n.content?n.data:t(n.data)),s.customUA&&s.setRequestHeader('User-Agent',s.customUA),n.auth&&s.setRequestHeader('Authorization','Bearer '+n.auth),n.api_key&&s.setRequestHeader('x-api-key',n.api_key);var p=5;return s.onreadystatechange=function(){if(4==s.readyState){if(300<=s.status&&400>s.status&&0<p){var t=s.getResponseHeader('location').replace(/location:\s+/,'');return--p,s.open('GET',t,n.async),void s.send()}if(503==s.status)return s.last_wait=2*(n.last_wait||500),void setTimeout(function(){s.open(n.type,n.url,n.async),'POST'==n.type&&s.setRequestHeader('Content-Type',n.content?n.content:'application/x-www-form-urlencoded'),s.customUA&&s.setRequestHeader('User-Agent',s.customUA),s.send(e)},n.last_wait);if(403==s.status){var r=s.getResponseHeader('Server');if('AmazonS3'===r)return void n.success.call(null,{error:'No data'},403,s)}if(200<=s.status&&300>s.status){var o='xml'==n.dataType?'undefined'==typeof document?{getElementsByTagName:function(){return[]}}:document.implementation.createDocument(null,'nodata',null):{};try{s.responseText;o='xml'==n.dataType?s.responseXML:'txt'==n.dataType?s.responseText:JSON.parse(s.responseText)}catch(t){return'unexpected_eos'==t.type?void n.success.call(null,{},s.status,s):void n.error.call(null,s.responseText,s,{error:t.type||t.message,stack:t})}if(202==s.status&&'RUNNING'==o.status)return void setTimeout(function(){s.open(n.type,n.url,n.async),'POST'==n.type&&s.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),s.customUA&&s.setRequestHeader('User-Agent',s.customUA),s.send(e)},5e3);n.success.call(null,o,s.status,s),o=null}else n.error.call(null,s.responseText,s,s.status)}},o.a.NETWORK_FAIL&&o.a.NETWORK_FAIL.enabled?void setTimeout(function(){console.log('Causing network failure'),s={onreadystatechange:s.onreadystatechange},s.readyState=4,s.status=o.a.NETWORK_FAIL.status||500,s.responseText='Intercepted by Network Failure simulator',s.onreadystatechange()},1e3):void s.send(e)};d.request=function(e,t,r){var n=o.a.IE?l:s;o.a.IE&&!e.match(/^https?\:/)&&(n=s);var d;return e?void('string'==typeof e?d={async:!0,url:e,timeout:5e3,type:'GET',error:function(e,r,n){t.call(null,{status:n})},success:function(e){t.call(null,null,e)}}:e.hasOwnProperty('url')&&(d=e,d.success=function(e){t.call(null,null,e)},d.error=function(e,r,n){t.call(null,{status:n})}),r&&(d.dataType='txt','xml'===r&&(d.dataType='xml')),n.call(null,d)):void t(null)};var l=function(e){var r=new XDomainRequest,n=!1,s=0;for(r.onerror=function(){e.error(r,r,{message:'XDomainRequest error'})},r.onprogress=function(){},r.open('GET',e.url+'?'+t(e.data)),r.onload=function(){if(n=!0,'xml'==e.dataType){var t=new ActiveXObject('Microsoft.XMLDOM');t.async=!1,t.loadXML(r.responseText),e.success(t,'success',r)}else if('json'==e.dataType){var s=null;try{s=JSON.parse(r.responseText)}catch(t){e.error(r,r,{message:'JSON parsing error'})}s&&e.success(s,'success',r)}else e.success(r.responseText,'success',r)},setTimeout(function(){r.send()},0);!e.async&&!n&&3>s;)alert('This browser does not support synchronous requests, click OK while we\'re waiting for data'),s+=1;e.async||n||alert('No data')};let c=function(e,t,r){if(d._current_reqs-=1,r&&null!==r.status&&0===r.status)return n.a.fire(this,'error',[{error:'Zero return status from request '}]),void this.requestComplete();var s=this._dataReceived(e,t);s&&this.gotResult(),null!==s&&'undefined'!=typeof s?this.requestComplete():this.requestIncomplete()},u=function(e,t,r){d._current_reqs-=1,'string'==typeof r&&(r={error:r,request:t}),isNaN(r)||(r={error:'Reqeust error',status:r,request:t}),n.a.fire(this,'error',[r]),n.a.fire(d,'requestComplete'),this.requestComplete()},p=function(e){if(!1!==e){if(!e)return n.a.fire(this,'error',['No request data']),n.a.fire(d,'requestComplete',[this]),this.requestComplete(),this;var t={async:this.async,url:e.url||this._endpointURL,timeout:5e3,error:u.bind(this),success:c.bind(this)};t=Object.assign(e,t),s(t),d._current_reqs+=1}};e.retrieve=function(e,t){var r=this;if(d._current_reqs=d._current_reqs||0,d._waiting_reqs=d._waiting_reqs||0,d.MAX_REQUESTS){var s=arguments.callee;if(d._current_reqs>d.MAX_REQUESTS)return d._waiting_reqs+=1,n.a.add(d,'requestComplete',function(){n.a.remove(this,'requestComplete',arguments.callee),setTimeout(function(){d._waiting_reqs-=1,s.call(r,e,t)},0)}),this}if(e&&(this.agi=e),e&&t){this.agi=e,this.result=null;var o=!1,l=function e(s){n.a.remove(r,'resultReceived',e),n.a.remove(r,'error',e),n.a.remove(r,'requestComplete',e),o||(s?t.call(r,s):t.call(r)),o=!0};n.a.add(r,'resultReceived',l),n.a.add(r,'error',l),n.a.add(r,'requestComplete',l)}var c=this.requestData();return Promise.resolve(c).then(p.bind(this)),this}}(d.prototype),d.prototype.requestData=function(){},d.prototype.toString=function(){for(var e in o.a)if(this.__class__==o.a[e])return'MASCP.'+e},d.prototype.registerSequenceRenderer=function(e,t){return this.setupSequenceRenderer&&(this.renderers=this.renderers||[],this.setupSequenceRenderer(e,t),this.renderers.push(e)),e.trigger('readerRegistered',[this]),this},d.prototype.resetOnResult=function(e,t,r){var n=this,s=function s(o){o!==n||(e.unbind('resultsRendered',s),t.forEach(function(t){e.remove(r,t)}))};this.bind('resultReceived',function t(){n.unbind('resultReceived',t),e.bind('resultsRendered',s)})},d.prototype.setupSequenceRenderer=function(){return this},d.Result=function(){},d.Result.prototype={agi:null,reader:null},d.Result.prototype.render=function(){},t.a=d},function(e,t,r){'use strict';function n(){return Reflect.construct(HTMLElement,[],Object.getPrototypeOf(this).constructor)}var s=r(13),o=r(11),d=r(2),l=r(1);const c=Symbol('component');class u extends o.a{constructor(e,t){super(e),this[c]=t}getVisibleLength(){return this.rightVisibleResidue()-this.leftVisibleResidue()}getTotalLength(){return this.sequence.length}getLeftPosition(){return this.leftVisibleResidue()}setLeftPosition(e){return this.setLeftVisibleResidue(e)}get selecting(){return this[c].selecting}}const p=document.createElement('template');p.innerHTML=`
<style>
  :host {
    display: block;
    position: relative;
  }
  :host([resizeable]) {
    resize: both;
    overflow: auto;
    padding-right: 5px;
    padding-bottom: 5px;
  }
  #container, .widget_contents {
    width: 100%;
    height: 100%;
  }
  #container {
  }
</style>
<div class="widget_contents" >
  <div id="container">
  </div>
</div>
<slot></slot>
`;const h=Symbol('interactive');class g{constructor(e){this.component=e}get enabled(){return this.component.interactive&&!this.component.selecting}set enabled(e){this.component.interactive=e}}class m extends s.a{constructor(e){super(),this.component=e}get enabled(){return this.component.interactive&&!this.component.selecting}set enabled(e){this.component.interactive=e}}Object.setPrototypeOf(n.prototype,HTMLElement.prototype),Object.setPrototypeOf(n,HTMLElement),window.ShadyCSS&&ShadyCSS.prepareTemplate(p,'x-protviewer');let _=function(e){e.font_order='Helvetica, Arial, sans-serif',e.zoom=.81,e.padding=10,e.trackOrder=[],e.reset(),e.trackGap=6,e.trackHeight=5,e.fixedFontScale=1},f=function(e){let t=new u(e,this);return _(t),x.call(this,t),t},y=(e,t,r)=>{d.a.request(r,function(n,s){s&&e.importIcons(t,s.documentElement,r)},'xml')},v=(e)=>{e.fitZoom()},b=function(e,t){t.applyToElement(e._canvas),t.addTouchZoomControls(e,e._canvas,this[h]),e._canvas.addEventListener('panned',()=>{let e=new Event('pandone',{bubbles:!0,cancelable:!0});this.dispatchEvent(e)}),s.a.addScrollZoomControls.call(this[h],e,e._canvas,.1)},x=function(e){var t=new m(this);e.bind('sequenceChange',()=>{y(e,'ui','https://glycodomain.glycomics.ku.dk/icons.svg'),y(e,'sugar','https://glycodomain.glycomics.ku.dk/sugars.svg'),v(e),b.call(this,e,t),E.call(this),_(e),e.navigation.show(),e.refresh()})},E=function(){for(let e of this.querySelectorAll('x-gatortrack'))this.createTrack(e)},A=function(e){e.bind('selection',(t)=>{let r=t.get(e);r[0]||r[1]?this.setAttribute('selected',`${r[0]}:${r[1]}`):this.removeAttribute('selected');for(let e of this.querySelectorAll('x-gatortrack')){let r=t.get(e.layer);r[0]||r[1]?e.setAttribute('selected',`${r[0]}:${r[1]}`):e.removeAttribute('selected')}})};class w extends n{static get observedAttributes(){return[]}constructor(){super()}attributeChangedCallback(){}connectedCallback(){window.ShadyCSS&&ShadyCSS.styleElement(this);let e=this.attachShadow({mode:'open'});e.appendChild(p.content.cloneNode(!0)),this[h]=new g(this),this.renderer=f.call(this,e.getElementById('container')),this.renderer.grow_container=!0,window.getComputedStyle(this).height&&'0px'!==window.getComputedStyle(this).height&&'auto'!==window.getComputedStyle(this).height&&(this.renderer.grow_container=!1,window.getComputedStyle(this).getPropertyValue('--fill-viewer')&&(this.renderer.fixed_size=!0)),A.call(this,this.renderer)}fitToZoom(){v(this.renderer)}createTrack(e){l.a.registerLayer(e.name,{},[this.renderer]),this.renderer.trackOrder=this.renderer.trackOrder.concat([e.name]),this.renderer.showLayer(e.name),this.renderer.refresh()}refreshTracks(){E.call(this)}get selecting(){return this.hasAttribute('selecting')}set selecting(e){e?this.setAttribute('selecting',''):this.removeAttribute('selecting')}get interactive(){return this.hasAttribute('interactive')}set interactive(e){e?this.setAttribute('interactive',''):this.removeAttribute('interactive')}}customElements.define('x-protviewer',w),t.a=w},function(e,t,r){'use strict';var n=r(5),s=r(8),o=r(9),d=r(10),l=r(18),c=r(2),u=r(1),p=r(11),h=r(13),g=r(3),m=r(23),_=r(24);u.a.ClustalRunner=n.a,u.a.UniprotReader=s.a,u.a.UserdataReader=o.a,u.a.GenomeReader=d.a,u.a.GatorDataReader=l.a,u.a.GatorComponent=g.a,u.a.GeneComponent=m.a,u.a.TrackComponent=_.a,t.a=u.a},function(e,t,r){'use strict';var n=r(2),s=r(0);const o=n.a.buildService(function(e){return this._raw_data=e,e&&'string'==typeof e&&(this._raw_data={data:{sequences:this.getSequences(),alignment:this.getAlignment()}}),this});o.SERVICE_URL='http://www.ebi.ac.uk/Tools/services/rest/clustalw2/run/',o.hash=function(e){var t=0;for(i=0;i<e.length;i++)char=e.charCodeAt(i),t=char+(t<<6)+(t<<16)-t;return t},o.prototype.requestData=function(){var e=[].concat(this.sequences||[]),t=this;if(this.agi=o.hash(this.sequences.join(','))+'',!o.SERVICE_URL.match(/ebi/))return{type:'POST',dataType:'json',api_key:MASCP.GATOR_CLIENT_ID,data:{sequences:e.join(',')}};if(s.a.fire(t,'running'),this.job_id)return{type:'GET',dataType:'txt',url:'http://www.ebi.ac.uk/Tools/services/rest/clustalw2/status/'+this.job_id};if(this.result_id)return{type:'GET',dataType:'txt',url:'http://www.ebi.ac.uk/Tools/services/rest/clustalw2/result/'+this.result_id+'/aln-clustalw'};for(var r=0;r<e.length;r++)e[r]='>seq'+r+'\n'+e[r];return{type:'POST',dataType:'txt',data:{sequence:escape(e.join('\n')+'\n'),email:'joshi%40sund.ku.dk'}}},function(e){var t=e.prototype._dataReceived;e.prototype._dataReceived=function(e,r){if(null===e)return t.call(this,null,r);if('object'==typeof e){if(e.status&&'RUNNING'==e.status){var n=this;return s.a.fire(n,'running'),setTimeout(function(){n.retrieve(n.agi)},5e3),void console.log('Got back running status')}return t.call(this,e,r)}if('string'==typeof e&&e.match(/^clustalw/))return this.job_id=e,void this.retrieve(this.agi);if(e.match(/FINISHED/)){this.result_id=this.job_id,this.job_id=null;var n=this;return void setTimeout(function(){n.retrieve(n.agi)},500)}if(e.match(/RUNNING/)){var n=this;return void setTimeout(function(){n.retrieve(n.agi)},500)}return t.call(this,e,r)}}(o),function(){var e=function(e){var t=[],r={},n;for(n in e)e.hasOwnProperty(n)&&-1<=parseInt(n)&&t.push(parseInt(n));t=t.sort(function(e,t){return e-t});for(var s=t.length-1,o;0<=s;s--){o=s-1,n=parseInt(t[s]);for(var d=e[n];0<=o;)n-=e[t[o]].length,o--;d.match(/^\s+$/)||(r[n+1]=d+(r[n+1]||''))}return r},t=function(e,t,r){for(var n=0,s;n<e.length;n++)s=e[n].toString(),'-'==s.charAt(t)?r[n]&&(r[n][t-1]=' ',(r[n][t]||'').match(/^\s+$/)&&(r[n][t-1]+=r[n][t],delete r[n][t])):(!r[n]&&(r[n]={},r[n][-1]=''),r[n][t-1]=s.charAt(t),r[n][t]&&r[n][t].match(/\w/)&&(r[n][t-1]+=r[n][t],delete r[n][t])),e[n]=s.slice(0,t)+s.slice(t+1)};o.Result.prototype.alignToSequence=function(r){this._orig_raw_data?this._raw_data=JSON.parse(this._orig_raw_data):this._orig_raw_data=JSON.stringify(this._raw_data);var n=this._raw_data.data.sequences.concat([this._raw_data.data.alignment]),s=[],o=n[r],d=o.length-1;for(d;0<=d;d--)'-'==o.charAt(d)&&t(n,d,s);for(d=0;d<n.length;d++)if(s[d]&&d!=r){s[d]=e(s[d]);var l=n[d];n[d]={sequence:l,insertions:s[d]},n[d].toString=function(){return this.sequence}}this._raw_data.data.alignment=n.pop(),this._raw_data.data.sequences=n},o.Result.prototype.calculatePositionForSequence=function(e,t){for(var r=this._raw_data.data.sequences[e].insertions||{},n=0,s=this._raw_data.data.sequences[e].toString(),o=0;o<s.length;o++)if(r[o]&&(n+=r[o].length),n+=1,'-'==s.charAt(o)&&(n-=1),t<=n)return t==n?o+1:(0==o&&(o=1),-1*o);return-1*s.length},o.Result.prototype.calculateSequencePositionFromPosition=function(e,t){for(var r=this._raw_data.data.sequences[e].insertions||{},n=0,s=this._raw_data.data.sequences[e].toString(),o=0;o<t;o++)r[o]&&(n+=r[o].length),n+=1,'-'==s.charAt(o)&&(n-=1);return 0==n&&(n+=1),n}}(),o.prototype.setupSequenceRenderer=function(e){var t=this;e.sequences=t.sequences,e.addAxisScale('clustal',function(e,r,n){let s=null,o=t.sequences.map(function(e){return e.agi});for(;0<o.length;){s=s||0;let e=o.shift();if(r.scales.has(e))break;s++,0===o.length&&(s=null)}return'primarySequence'===r.name&&(s=t.result.aligned_idx),null===s?e:n?t.result.calculateSequencePositionFromPosition(s,e):t.result.calculatePositionForSequence(s,e)});var r=[],n='isoforms',s='isoforms',o=function(e,t){var r=-3,n=-2,s=e.group(),o;o=e.line(n+1,r+4,n+3,r+1),o.setAttribute('stroke','#fcc'),o.setAttribute('stroke-width','10'),s.push(o),o=e.line(n+1,r+6,n+3,r+3),o.setAttribute('stroke','#fcc'),o.setAttribute('stroke-width','10'),s.push(o),o=e.line(n+1,r+4,n+3,r+3),o.setAttribute('stroke','#fcc'),o.setAttribute('stroke-width','5'),s.push(o),o=e.line(n+1,r+5.3,n+1,r+5.8),o.setAttribute('stroke','#fcc'),o.setAttribute('stroke-width','10'),s.push(o),o=e.line(n+1,r+5.9,n+1.5,r+5.9),o.setAttribute('stroke','#fcc'),o.setAttribute('stroke-width','10'),s.push(o);var d=e.circle(n+2.8,r+1.75,1);d.setAttribute('fill','#fff'),d.setAttribute('stroke','#ccc'),d.setAttribute('stroke-width','10'),s.push(d);var l=e.text(n+2.25,r+2.25,(t||'\xF7')+'');return l.setAttribute('fill','#ccc'),l.setAttribute('font-size',75),s.push(l),e.firstChild.nextSibling.appendChild(s),s},d=function d(l){for(var c=t.result;0<r.length;){var u=r.shift();e.remove(u.layer,u)}c.alignToSequence(l||0);var p=c.getSequences();if(!e.sequence)return void e.setSequence(p[l])(function(){e.sequences=t.sequences,MASCP.registerGroup(s,'Aligned'),MASCP.registerLayer(n,{fullname:'Conservation',color:'#000000'}),0>e.trackOrder.indexOf(n)&&(e.trackOrder=e.trackOrder.concat([n])),e.showLayer(n),e.createGroupController(n,s),d(l)});e.sequence=p[l],e.redrawAxis();var h=c.getAlignment().split('');r=r.concat(e.renderTextTrack(n,c.getAlignment().replace(/ /g,'\xA0'))),r.slice(-1)[0].setAttribute('data-spaces','true'),r.slice(-1)[0].layer=n;for(var g=[' ','.',':','*'],m=0;m<h.length;m++)r.push(e.getAA(m+1,n).addBoxOverlay(n,1,g.indexOf(h[m])/4,{merge:!0})),r.slice(-1)[0].layer=n;for(var m=0;m<p.length;m++){var _=t.sequences[m].agi.toUpperCase()||'missing'+m,f=MASCP.registerLayer(_,{fullname:t.sequences[m].name||_.toUpperCase(),group:s,color:'#ff0000',accession:t.sequences[m].agi});f.scales.clear(),f.scales.add(t.sequences[m].agi),f.fullname=t.sequences[m].name||_.toUpperCase();var y=e.renderTextTrack(_,p[m].toString());r=r.concat(y),r.slice(-1)[0].layer=_,0>e.trackOrder.indexOf(_.toUpperCase())&&(e.trackOrder=e.trackOrder.concat([s]));if(p[m].insertions)for(var v in p[m].insertions){var b=p[m].insertions;if((0!=v||''!=b[v])&&!(1>b[v].length)){var x=b[v].length;0==v&&(v=1);var E=o(e._canvas,x);E.setAttribute('fill','#ffff00');var A=e.getAA(v,n).addToLayer(_,{content:E,bare_element:!0,height:10,offset:-5,no_tracer:!0})[1];A.container.setAttribute('height','300'),A.container.setAttribute('viewBox','-50 -100 200 300'),r.push(A),r.slice(-1)[0].layer=_}}}e.zoom=1,e.showGroup(s),e.refresh()};this.bind('resultReceived',function(){var t=this;d(0),t.result.aligned_idx=0;var r=[];t.sequences.forEach(function(e){r.push(e.agi.toUpperCase())});var s=[];e.bind('orderChanged',function(o){if(t.result){var l=o.slice(o.indexOf(n)+1,o.length).filter(function(e){return 0<=r.indexOf(e)});if(l.join(',')==s.join(','))return;s=l,t.result.aligned_idx=r.indexOf(s[0]),d(t.result.aligned_idx),e.refreshScale()}})})},o.Result.prototype.getSequences=function(){if(this._raw_data&&this._raw_data.data&&this._raw_data.data.sequences)return[].concat(this._raw_data.data.sequences);for(var e=this._raw_data.match(/seq\d+(.*)/g),t=[],r=0,n;r<e.length;r++)n=e[r].match(/seq(\d+)\s+(.*)/),t[n[1]]||(t[n[1]]=''),t[n[1]]+=n[2];return t},o.Result.prototype.getAlignment=function(){if(this._raw_data&&this._raw_data.data&&this._raw_data.data.alignment)return this._raw_data.data.alignment.toString();this._text_data=this._raw_data;for(var e=/ {16}(.*)/g,t='',r=e.exec(this._raw_data);null!==r;)t+=r[1],r=e.exec(this._raw_data);return t};let d=(e,t,r)=>r.indexOf(e)===t,l=(e)=>{if(0==e.length)return{data:{sequences:[],alignment:''}};let t=e.map((e)=>e.split('')),r=t[0].map((e,r)=>1==t.map((e)=>e[r]).filter(d).length?'*':':').join('');return{data:{sequences:e,alignment:r}}};o.EmulatedClustalRunner=function(e){let t=new o;return t.retrieve=function(){let e=l(this.sequences||[]);this._dataReceived(e),this.sequences=this.sequences.map((e,t)=>({agi:'seq'+t,toString:()=>e})),this.gotResult(),this.requestComplete()},e&&t.registerSequenceRenderer(e),t},t.a=o},function(e){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,'loaded',{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,'id',{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,'exports',{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t){'use strict';/*! @source http://purl.eligrey.com/github/jsandbox/blob/master/src/jsandbox.js*/var r=function(e){var t='undefined',r=e.document,n=e.Worker;if(typeof n!=t){for(var s='load',o='requests',d='input',l='terminate',c='data',u='callback',p='onerror',h='worker',g='onresponse',m='prototype',_='call',f='string',y='function',v=function e(){var t=this;if(!(t instanceof e))return new e;try{t[h]=new n(e.url)}catch(e){'SecurityError'===e.name&&(t[h]=new n(window.URL.createObjectURL(new Blob(['('+T.toString()+'(self,eval))'],{type:'text/javascript'}))))}t[o]={},t[h].onmessage=function(e){var r=e[c],n;return'object'==typeof r?'log'==r.id?void console.log(r.message):void(n=t[o][r.id],n&&(r.error?(typeof t[p]==y&&t[p](r,n),typeof n[p]==y&&n[p][_](t,r.error)):(typeof t[g]==y&&t[g](r,n),typeof n[u]==y&&n[u][_](t,r.results)),delete t[o][r.id])):void 0}},b=v[m],x=function(e){b[e]=function(t,r,n,l){(typeof t==f||'[object Array]'===Object[m].toString[_](t)||1<arguments.length)&&(t={data:t,input:n,callback:r,onerror:l}),e===s&&typeof t[c]==f&&(t[c]=[t[c]]);var u=t[c],p=this.createRequestID();return n=t[d],delete t[c],delete t[d],this[o][p]=t,this[h].postMessage({id:p,method:e,data:u,input:n}),p},v[e]=function(){var t=new v;return t[g]=t[p]=function(){t[l](),t=null},v[m][e].apply(t,Array[m].slice[_](arguments)),v}},E=['eval',s,'exec'],A=3;A--;)x(E[A]);if(b[l]=function(){this[o]={},this[h].onmessage=null,this[h][l]()},b.abort=function(e){delete this[o][e]},b.createRequestID=function(){var e=Math.random().toString();return e in this[o]?this.createRequestID():e},typeof r!=t){var w=r.getElementsByTagName('link');for(A=w.length;A--;)if('jsandbox'===w[A].getAttribute('rel')){v.url=w[A].getAttribute('href');break}}var T=function(e,t){var r=e.postMessage,n=e.importScripts,s='message',o=function(s){var o=s.data,d={};d.id=o.id;var l=o.data;e.input=o.input||{};try{switch(o.method){case'eval':d.results=t(l);break;case'exec':n('data:application/javascript,'+encodeURIComponent(l));break;case'load':n.apply(e,l);}}catch(t){d.code=t.message,d.error=t.stack,d.line=t.lineNumber,d.fileName=t.fileName}delete e.input;try{delete e.onmessage}catch(t){}r(d)};e.addEventListener?e.addEventListener(s,o,!1):e.attachEvent&&e.attachEvent('on'+s,o),e.window=e,e.console={log:function(e){r({id:'log',message:e})}},e.Worker=e.addEventListener=e.removeEventListener=e.importScripts=e.XMLHttpRequest=e.postMessage=e.attachEvent=e.detachEvent=e.ActiveXObject=void 0};return v.url||(v.url=window.URL.createObjectURL(new Blob(['('+T.toString()+'(self,eval))'],{type:'text/javascript'}))),v}}(self);t.a=r},function(e,t,r){'use strict';var n=r(2),s=r(9),o=r(0),d=r(1);const l=n.a.buildService(function(e){if(e&&'string'==typeof e){var t=l.parseFasta(e),r;for(r in t)t.hasOwnProperty(r)&&(e={data:t[r]},this._raw_data=e)}return this._data=e||{},this._data.data||(this._data={data:['','']}),this});l.SERVICE_URL=null,l.prototype.requestData=function(){this;if(!l.SERVICE_URL)throw new Error('No service URL for UniprotReader');return{type:'GET',dataType:'json',auth:d.a.GATOR_AUTH_TOKEN,api_key:d.a.GATOR_CLIENT_ID,url:l.SERVICE_URL+'/'+this.agi.toUpperCase()}},l.Result.prototype.getDescription=function(){return this._data.data[1]},l.Result.prototype.getSequence=function(){return this._data.data[0]},l.parseFasta=function(e){var t=e.split('>'),r={};return t.forEach(function(e){var t=e.split(/\n/);if(!(1>=t.length)){var n=t.shift(),s=t.join(''),o=n.split('|'),d=o[1],l=o[2];r[d]=[s,l]}}),r},l.readFastaFile=function(e,t){var r=l.parseFasta(e),n=new s.a;return n.toString=function(){return'UniprotReader'},n.map=function(e){return e.data},n.datasetname='UniprotReader',t(n),setTimeout(function(){n.avoid_database=!0,n.setData('UniprotReader',{data:r})},0),n},t.a=l},function(e,t,r){'use strict';var n=r(2),s=r(17),o=r(1),d=r(0);const l=n.a.buildService(function(e){return e?(this._raw_data=e,this):this});l.prototype.toString=function(){return'UserdataReader.'+this.datasetname},l.prototype.requestData=function(){var e=this.agi.toUpperCase();return{type:'GET',dataType:'json',data:{agi:e,service:this.datasetname}}},l.prototype.setupSequenceRenderer=function(){};var c=function(e){var t=this.map,r=e.data,n=r.shift(),s={},o=n.indexOf(t.id),d=[];for(var l in t)'id'!=l&&t.hasOwnProperty(l)&&d.push({name:l,index:n.indexOf(t[l])});for(;0<r.length;){var c=r.shift(),u=c[o].toLowerCase();s[u]||(s[u]={data:{}});var p=s[u],h;for(h=d.length-1;0<=h;h--)p.data[d[h].name]||(p.data[d[h].name]=[]),p.data[d[h].name]=p.data[d[h].name].concat((c[d[h].index]||'').split(','));p.retrieved=e.retrieved,p.title=e.title,e.etag&&(p.etag=e.etag)}return s};l.prototype.setData=function(e,t){if(t){var r=this;s.a.CacheService(this),this.datasetname=e,t.retrieved||(t.retrieved=new Date),t.title||(t.title=e),r.title=t.title;var n={};if('object'==typeof this.map&&(n=c.call(this,t)),'function'==typeof this.map){if(this.map.callback){var o=arguments.callee;return void this.map(t,function(t){r.map=function(e){return e},o.call(r,e,t)})}n=this.map(t)}if(this.map){this.data=n;var u=new l;u.toString=function(){return r.toString()},u.data=n,u.retrieve=function(e,t){this.agi=e,t.call(this)},s.a.CacheService(u);var p=[],h;for(h in n)n.hasOwnProperty(h)&&(h.match(/[A-Z]/)&&(n[h.toLowerCase()]=n[h],delete n[h],h=h.toLowerCase()),p.push(h));var g=p.length,m=this.retrieve;return this.retrieve=function(e,t){console.log('Data not ready! Waiting for ready state');var r=this;d.a.add(r,'ready',function(){d.a.remove(r,'ready',arguments.callee),r.retrieve(e,t)})},1>p.length?void setTimeout(function(){r.retrieve=m,d.a.fire(r,'ready',[t])},0):void s.a.BulkOperation(function(e){if(e)return void d.a.fire(r,'error',[e]);var s=this.transaction;u.avoid_database=!0,u.retrieve(p[0],function(){for(;0<p.length;){var e=p.shift();if(d.a.fire(r,'progress',[100*((g-p.length)/g),g-p.length,g]),u.agi=e,u._dataReceived(n[e]),0===p.length)return r.retrieve=m,void s(function(e){e?d.a.fire(r,'error'):d.a.fire(r,'ready',[t])})}})})}}},l.datasets=function(e,t){s.a.FindCachedService(this,function(r){for(var n=[],s=0,o=r.length;s<o;s++)n.push(r[s].replace(/UserdataReader./,''));n.forEach&&n.forEach(e),t&&t()})},t.a=l},function(e,t,r){'use strict';var n=Math.floor,s=r(1),o=r(2),d=r(0);const l=o.a.buildService(function(e){return this._raw_data=e,this});l.SERVICE_URL='http://mygene.info/v2/query',l.prototype.requestData=function(){return(this.acc=this.agi,!this.geneid)?{type:'GET',dataType:'json',url:'https://mygene.info/v2/query',data:{q:'uniprot:'+this.acc.toUpperCase(),fields:'entrezgene',email:'joshi%40sund.ku.dk'}}:(this.acc||(this.acc=this.agi=''+this.geneid),this.exons?this.tried_isoform?s.a.GatorDataReader.authenticate().then((e)=>(this.tried_bare=!0,{type:'GET',dataType:'json',auth:s.a.GATOR_AUTH_TOKEN,api_key:s.a.GATOR_CLIENT_ID,url:e+'/data/latest/combined/'+this.swissprot.toUpperCase()})):s.a.GatorDataReader.authenticate().then((e)=>(this.tried_isoform=!0,{type:'GET',dataType:'json',auth:s.a.GATOR_AUTH_TOKEN,api_key:s.a.GATOR_CLIENT_ID,url:e+'/data/latest/combined/'+this.swissprot.toUpperCase()+'-1'})):{type:'GET',url:'https://mygene.info/v3/gene/'+this.geneid,dataType:'json',data:{fields:'exons_hg19,uniprot.Swiss-Prot'}})};let c=(e)=>{let t={};for(let r of e)t[r.transcript]=r,r.exons=r.position,delete r.position;return t};(function(e){var t=e.prototype._dataReceived;e.prototype._dataReceived=function(e,r){var n=this;if(e.data&&'db'===r)return n.sequences=[{agi:'genome'}],Object.keys(e.data).forEach(function(e){n.sequences.push({agi:e.toLowerCase()})}),t.call(this,e,r);if(200>r||400<=r)return t.call(this,null,r);if(!this.geneid)return this.geneid=e.hits[0].entrezgene,void this.retrieve(this.acc||this.agi);if(!this.exons){if(this.exons=c(e.exons_hg19||e.exons),this.swissprot=(e.uniprot||{})['Swiss-Prot'].toLowerCase(),!this.nt_mapping)return void this.retrieve(this.acc||this.agi);e=this.nt_mapping.map(function(e){return e.join('\t')}).join('\n')}if(e=e.data.filter((e)=>'uniprot_refseqnt'==e.dataset),0<e.length)e=e[0].data.map((e)=>[e.refseqnt.replace(/\..*/,''),e.uniprot].join('\t')).join('\n');else{if(this.tried_isoform&&!this.tried_bare)return void this.retrieve(this.acc||this.agi);e=''}var s={};return n.sequences=[{agi:'genome'}],(e||'').split('\n').forEach(function(e){var t=e.split('\t');if(t[1]){var r=t[1].toLowerCase().replace(/-\d+/,''),o=t[0];o=o.replace(/\..*$/,''),n.exons[o]&&((!n.agi||!n.acc)&&(n.acc=r,n.agi=r),!s[r]&&(s[r]=[]),n.exons[o]._id=o,s[r].push(n.exons[o]),n.sequences.push({agi:r.toLowerCase()}))}}),t.call(this,{data:s},r)}})(l),l.Result.prototype.getSequences=function(){var e=[],t=this._raw_data.data,r=Object.keys(t);let s,o;return s=o=null,r.forEach(function(e){var r=t[e].map(function(e){return Array.isArray(e)&&(e=e.filter(function(e){return e.chr.match(/^[\dXx]+$/)})[0]),[e.txstart,e.txend]});r.forEach(function(e){(!s||e[0]<s)&&(s=e[0]),(!o||e[1]>o)&&(o=e[1])})}),e=[Array(n((o-s)/3)).join('.')],this.min=s,this.max=o,e},l.Result.prototype.getIntrons=function(e){var t=this,r=[],n=Object.keys(t._raw_data.data);return n.forEach(function(n){var s=t._raw_data.data[n];s.forEach(function(n){if(Array.isArray(n)&&(n=n.filter(function(e){return e.chr.match(/^[\dXx]+$/)})[0],!n))return null;for(var s=n.exons,o=0;o<s.length;o++)0==o?r.push([t.min,s[o][0]-e]):r.push([s[o-1][1]+e,s[o][0]-e]),o==s.length-1&&r.push([s[o][1]+e,t.max]),r.slice(-1)[0][0]>r.slice(-1)[0][1]&&r.splice(r.length-1,1)})}),r},l.prototype.proteinLength=function(e){for(var t=e.exons,r=0,s=0;s<t.length;s++)if(!(e.cdsstart>t[s][1]&e.cdsstart>t[s][0])&&!(e.cdsend<t[s][0])){var o=e.cdsstart>t[s][0]?e.cdsstart:t[s][0],d=e.cdsend<t[s][1]?e.cdsend:t[s][1];r+=d-o}return n(r/3)-1},l.prototype.calculateSequencePositionFromProteinPosition=function(e,t){var r=this,s=r.result._raw_data.data[e.toLowerCase()];if(!s)return-1;s.txstart||(s=s.map(function(e){return Array.isArray(e)&&(e=e.filter(function(e){return e.chr.match(/^[\dXx]+$/)})[0],!e)?null:e}));var o=s[0]||{},d=o.exons||[],l=n(t/3),c=0;if(t<o.cdsstart&&(c=6,-1==o.strand&&(c=3)),t>o.cdsend&&(c=3*r.proteinLength(o),1==o.strand&&(c+=3)),0==c)for(var u=0;u<d.length;u++)if(!(o.cdsstart>d[u][1]&o.cdsstart>d[u][0])){var p=o.cdsstart>d[u][0]?o.cdsstart:d[u][0],h=o.cdsend<d[u][1]?o.cdsend:d[u][1];if(t<p)break;if(t<=h&&t>=p){c+=t-p;break}else c+=h-p}return c=n(c/3)-1,-1==o.strand&&(c=r.proteinLength(o)-c),c},l.prototype.calculateProteinPositionForSequence=function(e,t){var r=this,n=r.result._raw_data.data[e.toLowerCase()];if(!n)return-1;n.txstart||(n=n.map(function(e){return Array.isArray(e)&&(e=e.filter(function(e){return e.chr.match(/^[\dXx]+$/)})[0],!e)?null:e}));var s=n[0]||{},o=s.exons||[];-1==s.strand&&(t=r.proteinLength(s)-t);for(var d=3*t,l=0,c;l<o.length;l++)if(!(s.cdsstart>o[l][1]&s.cdsstart>o[l][0])){var u=s.cdsstart>o[l][0]?s.cdsstart:o[l][0],p=o[l][1]-u;if(p>=d){c=u+d;break}else d-=p}return c},l.prototype.calculatePositionForSequence=function(e,t){var r=this,n=r.sequences[e].agi,s=[],o=t;'genome'==n||(o=r.calculateProteinPositionForSequence(e,t));for(var d=0;d<s.length;d++)t>s[d][1]&&(o-=s[d][1]-s[d][0]),t<s[d][1]&&t>s[d][0]&&(o=-1);return o},function(e){var t=function(e,t){var r=e._raw_data.data;t&&console.log('Filtering exons so we only show',t);var n=Object.keys(r),s=e.max,o=e.min,d=[],l=0;return n.filter((e)=>!t||e===(t||'').toLowerCase()).forEach(function(e){r[e].map(function(e,t){if(!(Array.isArray(e)&&(e=e.filter(function(e){return e.chr.match(/^[\dXx]+$/)})[0],!e))){var r=e.exons,n=0==t?'#999':'#f99';r.forEach(function(t){d.push({aa:1+t[0],type:'box',width:t[1]-t[0],options:{offset:l,height_scale:1,fill:n,merge:!1}}),0<e.strand?d.push({aa:t[1]-1,type:'marker',options:{height:4,content:{type:'right_triangle',fill:'#aaa'},offset:l+2,bare_element:!0}}):d.push({aa:t[0]+1,type:'marker',options:{height:4,content:{type:'left_triangle',fill:'#aaa'},offset:l+2,bare_element:!0}})}),d.push({aa:e.cdsstart,type:'box',width:1,options:{fill:'#0000ff',height_scale:2,offset:l-2,merge:!1}}),d.push({aa:e.cdsend,type:'box',width:1,options:{fill:'#0000ff',height_scale:2,offset:l-2,merge:!1}}),l+=1}});l+=2}),d},r=function(e){var t=e.removed_regions||[],r=[],s=e.max,o=e.min,d=e._raw_data.data,l=Object.keys(d),c=l.reduce(function(e,t){return e+d[t].length},0);return t.forEach(function(e){var t=e[0],s=e[1],o=n(t%1e6/1e3)+'kb',d=n(s%1e6/1e3)+'kb';r.push({aa:t-1,type:'box',width:s-t+3,options:{fill:'#999',height_scale:3*c,offset:-1*c}}),r.push({aa:t-3,type:'text',options:{txt:o,fill:'#000',height:4,offset:-4,align:'right'}}),r.push({aa:s+3,type:'text',options:{txt:d,fill:'#000',height:4,offset:4,align:'left'}})}),r},d=function(e,t){var r=e.getIntrons(t),n=[{index:e.min-2,start:!0,idx:-1},{index:e.min,start:!1,idx:-1}];r.forEach(function(e,t){n.push({index:e[0],start:!0,idx:t}),n.push({index:e[1],start:!1,idx:t})}),n.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:e.index==t.index?e.start?-1:1:void 0});var s=[];n.forEach(function(t,r){t.start&&n[r+1]&&!1==n[r+1].start&&t.index!=n[r+1].index&&n[r+1].index!=e.min&&s.push([t.index,n[r+1].index])}),e.removed_regions=s},l=function(e){return function(t,r,s){var o=t;if(!e.result)return s?3*o:n(o/3);var d=e.result.removed_regions||[];if(s){o=3*t,p=o;for(var l=0;l<d.length&&0<o;l++){var c=0<l?d[l-1]:[null,e.result.min],u=d[l]||[e.result.max,null];o-=u[0]-c[1],0<o&&(p+=d[l][1]-d[l][0])}return p+e.result.min}for(var p=o-e.result.min,l=0;l<d.length;l++)o>d[l][1]&&(p-=d[l][1]-d[l][0]),o<d[l][1]&&o>d[l][0]&&(p=d[l][1]-e.result.min);return 3>p&&(p=3),n(p/3)}};Object.defineProperty(e.prototype,'exon_margin',{set:function(e){this._exon_margin=e,this.result&&(d(this.result,e),this.redrawIntrons())},get:function(){return this._exon_margin}});var c=function(e,t,n){var s=[],d=function(){if(!(1>s.length)&&s[0].parentNode){for(var e=!1,t=0;!e&&t<s.length-3;t+=3){if(s[t].hasAttribute('display')){e=!0;continue}s[t].getBoundingClientRect().right>s[t+3].getBoundingClientRect().left&&(e=!0)}s.forEach(function(t){'rect'==t.nodeName||(e?t.setAttribute('display','none'):t.removeAttribute('display'))})}};return e.bind('zoomChange',d),function(){var l=this.result;e.sequence=Array(n(l.max)).join('.'),0<s.length&&(s.forEach(function(r){e.remove(t,r)}),s=[]);var c={agi:t,gotResult:function(){s=e.renderObjects(t,r(l)),e.refresh(),d()}};o.a.prototype.registerSequenceRenderer.call(c,e),c.gotResult()}};e.prototype.setupSequenceRenderer=function(e){var r=this;e.addAxisScale('genome',function(e,t,n){if(t&&t.scales.has('genomic'))return e;let s=Object.keys(r.result._raw_data.data),o=t.name;for(let r of s)(t.scales.has(r.toUpperCase())||t.scales.has(r.toLowerCase()))&&(o=r);return n?r.calculateSequencePositionFromProteinPosition(o,e):r.calculateProteinPositionForSequence(o,e)});var n='cds';this.bind('resultReceived',function u(p){p||(p=0),s.a.registerLayer(n,{fullname:'Exons',color:'#000000'}),s.a.getLayer(n).scales.add('genomic'),0>e.trackOrder.indexOf(n)&&e.trackOrder.push(n),e.showLayer(n);var h=this.result,g=h.getSequences(),m=l(r);if(e.addAxisScale('removeIntrons',m),d(r.result,r.exon_margin||300),!e.sequence)return void e.setSequence(Array(m(h.max)).join('.'))(function(){u(p)});e.sequence=Array(m(h.max)).join('.'),e.redrawAxis();var _={agi:n,gotResult:function(){e.renderObjects(n,t(h,r.reviewed?r.swissprot:r.uniprot))}};o.a.prototype.registerSequenceRenderer.call(_,e),_.gotResult(),r.redrawIntrons=c(e,n,m),r.redrawIntrons()})}}(l),t.a=l},function(e,t,r){'use strict';var n=Math.max,s=Math.min,o=Math.abs,d=Math.floor,l=r(1),c=r(19),u=r(20),p=r(0),h=r(12);const g='http://www.w3.org/2000/svg',m=function e(t){this._RS=50,c.a.apply(this,arguments);var r=this;l.a.registerLayer('primarySequence',{fullname:'Primary Sequence'}),e.Zoom(r);var n=function(){t.cached_width=t.getBoundingClientRect().width},s;return window.addEventListener('resize',function(){clearTimeout(s),window.requestAnimationFrame?window.requestAnimationFrame(n):s=setTimeout(n,100)},!0),t.cached_width=t.getBoundingClientRect().width,p.a.remove(this,'sequenceChange'),p.a.add(this,'sequenceChange',function(){for(var e in l.a.layers)l.a.layers.hasOwnProperty(e)&&(l.a.layers[e].disabled=!0);r.zoom=r.zoom}),this};m.prototype=new c.a,function(e){var t=function(){var e=this;this._object&&('undefined'==typeof svgweb?this._object.parentNode.removeChild(this._object):svgweb.removeChild(this._object,this._object.parentNode),this._canvas=null,this._object=null);var t;if(document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure','1.1')){var r=this.win().document.createElementNS(g,'svg');r.setAttribute('width','100%'),r.setAttribute('height','100%'),this._container.appendChild(r),this._canvas=r,t={addEventListener:function(e,t){r.contentDocument={rootElement:r},t.call(r)}}}return t.addEventListener('load',function(){var t=this;Object(h.a)(t),e.font_order&&(t.font_order=e.font_order);var r=t.makeEl('g'),s=t.makeEl('svg');s.RS=e._RS,Object(h.a)(s),e.font_order&&(s.font_order=e.font_order),r.appendChild(s),t.appendChild(r);try{s.addEventListener}catch(e){}var o=s.makeEl('rect',{x:'-10%',y:'-10%',width:'120%',height:'120%',style:'fill: #ffffff;'}),d=t.makeEl('rect',{x:'0',y:'0',width:'50',height:'100%',style:'fill: url(#left_fade);'}),l=t.makeEl('rect',{x:'100%',y:'0',width:'25',height:'100%',transform:'translate(-15,0)',style:'fill: url(#right_fade);'});t.appendChild(d),t.appendChild(l),p.a.add(s,'pan',function(){0<=s.currentTranslateCache.x?d.setAttribute('visibility','hidden'):d.setAttribute('visibility','visible'),e.rightVisibleResidue()<e.sequence.length?l.setAttribute('visibility','visible'):l.setAttribute('visibility','hidden')}),p.a.add(s,'_anim_begin',function(){d.setAttribute('visibility','hidden'),l.setAttribute('visibility','hidden')}),p.a.add(s,'_anim_end',function(){p.a.fire(s,'pan')}),s.currentTranslateCache={x:0,y:0},0<=s.currentTranslateCache.x&&d.setAttribute('visibility','hidden'),l.setAttribute('visibility','hidden');var c=t.makeEl('g');t.appendChild(c);var u=t.makeEl('svg');c.appendChild(u),r.style.willChange='transform',s.setScale=function(e){var t=(r._cached_transform||'').replace(/scale\([^\)]+\)/,'');null!==e&&(t=(' scale('+e+') '+t).replace(/\s+/g,' ')),r._cached_transform=t,r.style.transform=t},u.setScale=function(e){var t=(c._cached_transform||'').replace(/scale\([^\)]+\)/,'');null!==e&&(t=(t+' scale('+e+') ').replace(/\s+/g,' ')),c._cached_transform=t,c.style.transform=t},p.a.add(s,'zoomChange',()=>{e.fixed_size&&(s.setScale(1),u.setScale(1),requestAnimationFrame(()=>{let e=t.getBoundingClientRect().height,n=s.getBoundingClientRect().height,o=(r._cached_transform||'scale(1)').match(/scale\(([\d\.]+)\)/)||'1';s.setScale((1*e/n).toFixed(2)),u.setScale((1*e/n).toFixed(2))}))}),p.a.add(s,'panend',()=>{let e=new Event('panned',{bubbles:!0,cancelable:!0});s.dispatchEvent(e)});var g=window.navigator.userAgent,m=!1;0<=g.indexOf('Edge/')&&(m=!0),s.setCurrentTranslateXY=function(e,t){var n=r._cached_transform||'';n=(n.replace(/translate\([^\)]+\)/,'')+' translate('+e+'px, '+t+'px) ').replace(/\s+/g,' '),r._cached_transform=n,m?r.setAttribute('transform',n.replace(/px/g,'')):r.style.transform=n,this.currentTranslateCache.x=e,this.currentTranslateCache.y=t},s.setCurrentTranslateXY(0,0),u.setCurrentTranslateXY=function(e,t){var r=(c.getAttribute('transform')||'').replace(/translate\([^\)]+\)/,'');r=r+' translate('+e+', '+t+') ',c.setAttribute('transform',r),this.currentTranslate.x=e,this.currentTranslate.y=t},u.setCurrentTranslateXY(0,0),n.call(e,u);var _=e.navigation,f=_.show,y=_.hide;_.show=function(){f.apply(_,arguments),s.style.GomapScrollLeftMargin=100*e._RS/e.zoom},_.hide=function(){y.apply(_,arguments),s.style.GomapScrollLeftMargin=1e3},e._container_canvas=t,t.setAttribute('preserveAspectRatio','xMinYMin meet'),t.setAttribute('width','100%'),t.setAttribute('height','100%'),s.appendChild(s.makeEl('rect',{x:0,y:0,opacity:0,width:'100%',height:'100%',"stroke-width":'0',fill:'#ffffff'})),e._object=this,e._canvas=s,e._canvas._canvas_height=0,p.a.fire(e,'svgready')},!1),t},r=function(t){return t.stopPropagation(),!0},n=function(e){this.navigation=new m.Navigation(e,this);var t=this.navigation,n=this,s=function(){t.demote()},o=function(){t.promote(),t.refresh()};l.a.IE||(p.a.add(this._canvas,'panstart',s),p.a.add(this._canvas,'panend',o),p.a.add(this._canvas,'_anim_begin',s),p.a.add(this._canvas,'_anim_end',o),e.addEventListener('DOMMouseScroll',r,!1),e.addEventListener('wheel',r,!1),e.onmousewheel=r)},s=function(){var e=this,t=e.addTextTrack(this.sequence,this._canvas.set());t.attr({y:.5*e._axis_height*e._RS}),e.select=function(){var e=Array.prototype.slice.call(arguments),t=e[0],r=e[1];this.moveHighlight.apply(this,e)};var r=function(){t.attr({y:.5*e._axis_height*e._RS})},n=e._canvas;return p.a.add(n,'zoomChange',r),p.a.add(t,'removed',function(){p.a.remove(n,'zoomChange',r)}),t},u=_=function(e,t){var r=this._RS,n=this,s=0,o=0,d=e.set(),l=e.rect(0,0,t,1.5);l.setAttribute('fill','url(\'#'+n.axis_pattern_id+'\')'),l.removeAttribute('stroke'),l.removeAttribute('stroke-width'),l.setAttribute('id','axis_back');var c=30,u=e.set(),h=e.set(),g=e.set(),m=e.set(),_=10,f=20;for(5e3<this.sequence.length&&(_=100,f=200),1e3<this.sequence.length&&(_=20,f=40),o=0;o<t/5;o++){var y=e.text(s-.5,0,''+s);u.push(y),0==s%f&&0!=s?h.push(y):0==s%_&&0!=s&&g.push(y),0==s%(250*parseInt(this.sequence.length/500))&&0!=s&&m.push(y),s+=5}for(o=0;o<u.length;o++)u[o].style.textAnchor='middle',u[o].firstChild.setAttribute('dy','1.5ex');u.attr({"pointer-events":'none',"text-anchor":'middle',"font-size":7*r+'pt'}),u.hide(),n._axis_height=parseInt(c/n.zoom);var v=function(){var e=n;e._axis_height=parseInt(c/e.zoom);var t=e._canvas.ownerSVGElement.getElementById(e.axis_pattern_id);if(m.forEach(function(e){e.setAttribute('visibility','hidden')}),3.6<this.zoom){l.setAttribute('transform','translate(-5,'+.3*e._axis_height*r+')'),l.setAttribute('height',.25*e._axis_height*r),t.setAttribute('width',10*r),t.firstChild.setAttribute('x',9.5*r),t.firstChild.setAttribute('width',r/e.zoom),g.show(),h.show();var s=.15*n._axis_height;1>s&&(s=1),g.attr({"font-size":s*r+'pt',"text-anchor":'end'}),h.attr({"font-size":s*r+'pt',"text-anchor":'end'}),this._visibleTracers&&this._visibleTracers()&&this._visibleTracers().show()}else if(1.8<this.zoom)g.hide(),h.show(),h.attr({"font-size":.5*r*n._axis_height+'pt',"text-anchor":'middle'}),l.setAttribute('transform','translate(-25,'+.5*e._axis_height*r+')'),l.setAttribute('height',.3*e._axis_height*r),t.setAttribute('width',20*r),t.firstChild.setAttribute('width',r/e.zoom),t.firstChild.setAttribute('x','0'),this.tracers&&this.tracers.hide();else if(.2<this.zoom){this.tracers&&this.tracers.hide(),g.hide(),h.show(),h.attr({"font-size":.5*r*n._axis_height+'pt',"text-anchor":'middle'}),l.setAttribute('transform','translate(-25,'+.5*e._axis_height*r+')'),l.setAttribute('height',.3*e._axis_height*r),t.setAttribute('width',50*r),t.firstChild.setAttribute('width',r/e.zoom);var o=-1e4,d=!1;h.forEach(function(e){e.cached_bbox||(e.cached_bbox=e.getBBox()),e.cached_bbox.x<=o+10*r||0!=parseInt(e.textContent)%50?(e.setAttribute('visibility','hidden'),d=!0):(e.setAttribute('visibility','visible'),o=e.cached_bbox.x+e.cached_bbox.width)}),d&&h[0].setAttribute('visibility','hidden')}else{this.tracers&&this.tracers.hide(),g.hide(),h.hide(),m.show(),m.attr({"font-size":.5*r*n._axis_height+'pt',"text-anchor":'middle'}),l.setAttribute('transform','translate(-50,'+.85*e._axis_height*r+')'),l.setAttribute('height',.1*e._axis_height*r),t.setAttribute('width',250*r),t.firstChild.setAttribute('width',r/e.zoom);var o=-1e4,d=!1;m.forEach(function(e){e.cached_bbox||(e.cached_bbox=e.getBBox()),e.cached_bbox.x<=o+10*r||0!=parseInt(e.textContent)%250?e.setAttribute('visibility','hidden'):(e.setAttribute('visibility','visible'),o=e.cached_bbox.x+e.cached_bbox.width)}),d&&m[0].setAttribute('visibility','hidden')}};return p.a.add(e,'zoomChange',v),p.a.add(d,'removed',function(){p.a.remove(e,'zoomChange',v);l.parentNode.removeChild(l),u.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}),d},_;e.prototype.panTo=function(e,t){var r=this,n=r.leftVisibleResidue(),s=1;return n==e?void(t&&t.call(null)):void(n>e&&(s=-1),requestAnimationFrame(function(){r.setLeftVisibleResidue(n),n+=s,p.a.fire(r._canvas,'panend'),n===e?t&&t.call(null):requestAnimationFrame(arguments.callee)}))},e.prototype.zoomTo=function(e,t,r){var n=this,s=n.zoom,d=(e-s)/50;if(p.a.add(n,'zoomChange',function e(){p.a.remove(n,'zoomChange',e),delete n.zoomCenter,r&&r.call(null)}),t)n.zoomCenter='center'==t?t:{x:n._RS*t};else return void(n.zoom=e);let l=()=>{n.zoom=s,s+=d,.01<o(s-e)&&requestAnimationFrame(l)};requestAnimationFrame(l)},e.prototype.showResidues=function(e,t){let r=this._container.clientWidth/this._RS,n=this._container.clientWidth,s=n/(2*this.sequence.length);if(this.sequence){let r=s/((t-e)/this.sequence.length);if(r===this.zoom)return this.setLeftVisibleResidue(e),Promise.resolve();this.zoomCenter={x:d(.5*(t+e))};let n=new Promise((t)=>{let r=()=>{p.a.remove(this,'zoomChange',r),delete this.zoomCenter,this.setLeftVisibleResidue(e),t()};p.a.add(this,'zoomChange',r)});return this.zoom=r,n}},e.prototype.setLeftVisibleResidue=function(e){var t=this;t._canvas.setCurrentTranslateXY(t._canvas.width.baseVal.value*(1-e/(t.sequence.length+t.padding+2))-t._canvas.width.baseVal.value,0)},e.prototype.leftVisibleResidue=function(){var e=this,t=d((e.sequence.length+e.padding+2)*(1-(e._canvas.width.baseVal.value+e._canvas.currentTranslateCache.x)/e._canvas.width.baseVal.value))-1;return 0>t&&(t=0),t},e.prototype.rightVisibleResidue=function(){var e=this,t=e._container_canvas.parentNode.cached_width;t||(t=e._container_canvas.parentNode.getBoundingClientRect().width);var r=d(e.leftVisibleResidue()+(e.sequence.length+e.padding+2)*(t/e._canvas.width.baseVal.value));return r>e.sequence.length&&(r=e.sequence.length),r},e.prototype.addAxisScale=function(e,t){this._scalers||(this._scalers=[]);let r=this._scalers.filter((t)=>t.identifier!==e);return r.push(t),this._scalers=r,t.identifier=e,t},e.prototype.refreshScale=function(){var e=this,t=Object.keys(this._layer_containers);t.forEach(function(t){e._layer_containers[t].forEach(function(r){if(r.move&&r.aa){var n=e.scalePosition(r.aa,t),s=e.scalePosition(r.aa+r.aa_width,t);0>n&&(n*=-1),0>s&&(s*=-1),r.move(n-1,s-n)}})})},e.prototype.scalePosition=function(e,t,r){var n=l.a.getLayer(t);n||(console.log('Missing layer object for layer identifier',t,'making dummy layer scaled with identifier',t),n={name:t,scales:new Set},n.scales.add(t));let s=(this._scalers||[]).concat([]);var o=(r?s.reverse():s).reduce((e,t)=>t(e,n,r),e);return o},e.prototype.getAA=function(e,t,r){return this.getAminoAcidsByPosition([e],t,r).shift()},e.prototype.getAminoAcidsByPosition=function(e,t){for(var r=this,n=e.map(function(e){return o(r.scalePosition(e,t))}),s=c.a.prototype.getAminoAcidsByPosition.call(this,n),d=0;d<n.length;d++)s[d]&&(s[d].original_index=e[d]);return s},e.prototype.getAminoAcidsByPeptide=function(e,t){t=l.a.getLayer(t);var r=this,n=[],s=t.accession,o;o=r.sequences?r.sequences[r.sequences.map(function(e){return(e.agi||e.acc||'').toLowerCase()}).indexOf(s.toLowerCase())].toString():r.sequence;for(var d=o.indexOf(e),c=0;c<e.length;c++)n.push(d+c);var u=r.getAminoAcidsByPosition(n,t);return u.addToLayer=u.length?function(e,t,r){return u[0].addBoxOverlay(e,u.length,t,r)}:function(){},u},e.prototype.win=function(){if(this._container&&this._container.ownerDocument&&this._container.ownerDocument.defaultView){var e=this._container.ownerDocument.defaultView;return'object'==typeof e&&e.constructor!==Window&&(e=e[Object.keys(e)[0]]),e}return null},e.prototype.setSequence=function(e){var r=this._cleanSequence(e);if(r==this.sequence&&null!==r)return void p.a.fire(this,'sequenceChange');if(r){this.sequence=r,delete this.sequences;var n=this.sequence.split(''),o=n.length;if(0!==o){var d=this,c=function(){var e=[];d.sequence.split('').forEach(function(t,r){var n={};n._index=r,n._renderer=d,d._extendElement(n),n.amino_acid=t,e.push(n)}),d._sequence_els=e};c();var h=this._RS;p.a.remove(this,'svgready'),p.a.add(this,'svgready',function(){var e=d._canvas;e.RS=h,e.setAttribute('background','#000000'),e.setAttribute('preserveAspectRatio','xMinYMin meet');var t=e.makeEl('defs');d._container_canvas.appendChild(t),t.appendChild(e.make_gradient('track_shine','0%','100%',['#111111','#aaaaaa','#111111'],[.5,.5,.5])),t.appendChild(e.make_gradient('simple_gradient','0%','100%',['#aaaaaa','#888888'],[1,1])),t.appendChild(e.make_gradient('left_fade','100%','0%',['#ffffff','#ffffff'],[1,0])),t.appendChild(e.make_gradient('right_fade','100%','0%',['#ffffff','#ffffff'],[0,1])),t.appendChild(e.make_gradient('red_3d','0%','100%',['#CF0000','#540000'],[1,1])),d.gradients=[],d.add3dGradient=function(r){t.appendChild(e.make_gradient('grad_'+r,'0%','100%',[r,'#ffffff',r],[1,1,1])),d.gradients.push(r)};var r=e.makeEl('filter',{id:'drop_shadow',filterUnits:'objectBoundingBox',x:'-50%',y:'-50%',width:'200%',height:'200%'});r.appendChild(e.makeEl('feGaussianBlur',{in:'SourceGraphic',stdDeviation:'4',result:'blur_out'})),r.appendChild(e.makeEl('feOffset',{in:'blur_out',result:'the_shadow',dx:'3',dy:'1'})),r.appendChild(e.makeEl('feBlend',{in:'SourceGraphic',in2:'the_shadow',mode:'normal'})),t.appendChild(r);var n=e.makeEl('svg',{width:'100%',height:'100%',id:'new_link_icon',viewBox:'0 0 100 100',preserveAspectRatio:'xMinYMin meet'});t.appendChild(n),n.appendChild(e.makeEl('rect',{x:'12.5',y:'37.5',"stroke-width":'3',width:'50',height:'50',stroke:'#ffffff',fill:'none'})),n.appendChild(e.makeEl('path',{d:'M 50.0,16.7 L 83.3,16.7 L 83.3,50.0 L 79.2,56.2 L 68.8,39.6 L 43.8,66.7 L 33.3,56.2 L 60.4,31.2 L 43.8,20.8 L 50.0,16.7 z',"stroke-width":'3',stroke:'#999999',fill:'#ffffff'}));var g=e.makeEl('svg',{width:'100%',height:'100%',id:'plus_icon',viewBox:'0 0 100 100',preserveAspectRatio:'xMinYMin meet'});g.appendChild(e.plus(0,0,100/e.RS)),t.appendChild(g);var m=e.makeEl('svg',{width:'100%',height:'100%',id:'minus_icon',viewBox:'0 0 100 100',preserveAspectRatio:'xMinYMin meet'});m.appendChild(e.minus(0,0,100/e.RS)),t.appendChild(m);var f='axis_pattern_'+new Date().getTime(),y=e.makeEl('pattern',{patternUnits:'userSpaceOnUse',x:'0',y:'0',width:10*e.RS,height:2*e.RS,id:f});d.axis_pattern_id=f;var v=e.makeEl('rect',{x:'0',y:'0',width:'10%',height:'1000%',fill:'#000',stroke:'0'});y.appendChild(v),t.appendChild(y);var b=this;d._axis_height=10;var x=s.call(b,e);d.hideAxis=function(){u=function(e){return p.a.add(e,'zoomChange',function(){b._axis_height=10/b.zoom}),{}},b._axis_height=10/b.zoom,this.redrawAxis()},d.showAxis=function(){u=_,this.redrawAxis()};var E=u.call(b,e,o);d.redrawAxis=function(){p.a.fire(E,'removed'),x.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),p.a.fire(x,'removed'),E=u.call(b,e,d.sequence.length),x=s.call(b,e),c(),d.refresh()},d.hide_axis?this.hideAxis():this.showAxis(),d._layer_containers={},d.enablePrintResizing(),d.enableScaling(),d.enableSelection(),p.a.add(l.a,'layerRegistered',function(e,t){t&&t!==d||d.addTrack(e)}),p.a.fire(d,'sequenceChange')});var g=t.call(this);this._canvas||('undefined'==typeof svgweb?this._container.appendChild(g):svgweb.appendChild(g,this._container));var m=this;this.EnableHighlights();var f=function(e){m._canvas?e.apply():p.a.add(m,'sequenceChange',function(){p.a.remove(m,'sequenceChange',arguments.callee),e.apply()})};return f.ready=function(e){this.call(this,e)},f}}}}(m),function(){var e='http://www.w3.org/2000/svg',t=function(t){t.ELEMENT_NODE||(t.ELEMENT_NODE=1,t.ATTRIBUTE_NODE=2,t.TEXT_NODE=3,t.CDATA_SECTION_NODE=4,t.ENTITY_REFERENCE_NODE=5,t.ENTITY_NODE=6,t.PROCESSING_INSTRUCTION_NODE=7,t.COMMENT_NODE=8,t.DOCUMENT_NODE=9,t.DOCUMENT_TYPE_NODE=10,t.DOCUMENT_FRAGMENT_NODE=11,t.NOTATION_NODE=12),t._importNode=function(r,n){switch(r.nodeType){case t.ELEMENT_NODE:var s=t.createElementNS(e,r.nodeName);if(r.attributes&&0<r.attributes.length)for(var o=0,d=r.attributes.length;o<d;)/^on/.test(r.attributes[o].nodeName)||s.setAttribute(r.attributes[o].nodeName,r.getAttribute(r.attributes[o++].nodeName));if(n&&r.childNodes&&0<r.childNodes.length)for(var o=0,d=r.childNodes.length;o<d;)'USE'!==r.childNodes[o].nodeName&&'SCRIPT'!==r.childNodes[o].nodeName.toUpperCase()&&s.appendChild(t._importNode(r.childNodes[o++],n));return s;break;case t.TEXT_NODE:case t.CDATA_SECTION_NODE:case t.COMMENT_NODE:return t.createTextNode(r.nodeValue);}}},r=function(e,t){if(e.childNodes&&0<e.childNodes.length)for(var r=0,n=e.childNodes.length;r<n;){if('USE'===e.childNodes[r].nodeName.toUpperCase()){var s=e.childNodes[r].getAttribute('xlink:href');e.childNodes[r].setAttribute('xlink:href',s.replace(/^#/,'#'+t+'_'))}r++}};m.prototype.importIcons=function(n,s,o){var d=this._container_canvas.ownerDocument;if(!this._container_canvas.getElementById('defs_'+n)){this._container_canvas.appendChild(d.createElement('defs')),this._container_canvas.lastChild.setAttribute('id','defs_'+n);var l=this._container_canvas.lastChild;d._importNode||t(d);var c=window.navigator.userAgent;if(0<=c.indexOf('Edge/'))return this.icons_failed=this.icons_failed||{},void(this.icons_failed[n]=o);var u=d._importNode(s,!0);if('undefined'!=typeof XPathResult){for(var p=d.evaluate('//svg:defs/*',u,function(){return e},XPathResult.ANY_TYPE,null),h=p.iterateNext(),g=[];h;)g.push(h),h=p.iterateNext();0===g.length&&(this.icons_failed=this.icons_failed||{},this.icons_failed[n]=o),g.forEach(function(e){e.setAttribute('id',n+'_'+e.getAttribute('id')),r(e,n),l.appendChild(e)})}else for(var m=u.querySelectorAll('defs > *'),_=0;_<m.length;_++)m[_].setAttribute('id',n+'_'+m[_].getAttribute('id')),r(h,n),l.appendChild(m[_])}}}(),m.prototype.addValuesToLayer=function(e,t,r){var n=this._RS,s=this._canvas;if(!s){var o=arguments.callee,d=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),o.call(d,e,t)}),void log('Delaying rendering, waiting for sequence change')}var l=1,c,u;r=r||{},r.height&&(l=r.height/this._layer_containers[e].track_height);var h=0;r.offset&&(h=r.offset/this._layer_containers[e].track_height);var g=function(e){var r=' m'+-.5*n+' 0',s=null;return t.forEach(function(t){'undefined'==typeof s||(r+=' l'+n+' '+-1*n*e*l*(t-s)),s=t,(isNaN(c)||t>c)&&(c=t),(isNaN(u)||t<u)&&(u=t)}),r},m=this._canvas.path('M0 0 M0 0 m0 '+(c||0)*n+' '+g(1)),_=u,f=c;if(m.setAttribute('stroke',r.color||'#ff0000'),m.setAttribute('stroke-width',(r.thickness||.35)*n),m.setAttribute('fill','none'),m.setAttribute('visibility','hidden'),m.setAttribute('pointer-events','none'),this._layer_containers[e].push(m),m.setAttribute('transform','translate(1,10) scale(1,1)'),!r.hide_axis){var y=this._canvas.path('M0 0 m0 '+n*((c||0)-(u||0))+' l'+this._sequence_els.length*n+' 0');y.setAttribute('stroke-width',.2*n),y.setAttribute('visibility','hidden'),y.setAttribute('transform','translate(1,0)'),y.setAttribute('pointer-events','none'),y.setHeight=function(e){0>_&&0<f?y.setAttribute('d','M0 0 M0 0 m0 '+e*h+' m0 '+.5*e*l+' l'+v._sequence_els.length*n+' 0'):y.setAttribute('d','M0 0 M0 0 m0 '+e*h+' m0 '+.5*(1-_)*e*l+' l'+v._sequence_els.length*n+' 0'),y.setAttribute('stroke-width',.2*n/v.zoom)},this._layer_containers[e].push(y)}var v=this;if(r.label){var b=this._canvas.text(0,0,r.label.max||r.label.min);b.setAttribute('transform','translate(0,0)'),b.setAttribute('font-size',4*n+'pt'),b.setHeight=function(e){b.setAttribute('y',e*h),b.setAttribute('font-size',4*n/v.zoom+'pt')},this._layer_containers[e].push(b)}return m.setHeight=function(e){var t=g(.5*e/n);m.setAttribute('d','M0 0 M0 0 m0 '+e*h+' m0 '+.5*e*l+' '+t),m.setAttribute('stroke-width',(r.thickness||.35)*n/v.zoom)},m},function(){var e=function(e,t){var r=this._renderer._canvas;if(!r){var n=arguments.callee,s=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),n.call(s,e)}),void log('Delaying rendering, waiting for sequence change')}var o=null,d=null,c=this._renderer;t||(t={});var u=1;t.height&&(t.height=parseFloat(t.height),'undefined'!=typeof t.height&&t.bare_element&&(t.height*=2),u=t.height/this._renderer._layer_containers[e].track_height,'undefined'!=typeof t.offset&&(t.offset=-1.25-1.25+5*(t.offset/t.height)));var d=r.growingMarker(0,0,t.content||e.charAt(0).toUpperCase(),t);if(d.setAttribute('transform','translate('+(this._index+.5)*this._renderer._RS+',0.01) scale('+u+')'),d.setAttribute('height','250'),d.firstChild.setAttribute('transform','translate(-100,0) rotate(0,100,0.001)'),t.break_viewbox&&(d.container.removeAttribute('viewBox'),d.container.setAttribute('width','100%'),d.container.setAttribute('height','100%')),!t.no_tracer){var h=r.circle(this._index+.5,10,.25);h.setAttribute('visibility','hidden'),h.style.opacity='0.4',o=r.rect(this._index+.5,10,.05,0),o._index=this._index,o.style.strokeWidth='0',o.style.fill=l.a.layers[e].color,o.setAttribute('visibility','hidden'),r.insertBefore(o,r.firstChild.nextSibling);var c=this._renderer;this._renderer._layer_containers[e].tracers||(this._renderer._layer_containers[e].tracers=r.set()),r.tracers||(r.tracers=r.set(),r._visibleTracers=function(){return c._visibleTracers()}),o.setHeight=function(e){if('hidden'!=o.getAttribute('visibility')){var t=d.getAttribute('transform'),r=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(t);if(r[1]&&r[2]){var n=parseFloat(r[2]),s=parseFloat(r[1]),l=s+n*(50*(d.offset||0)+125)-parseInt(this.getAttribute('y'));this.setAttribute('height',0>l?0:l)}else this.setAttribute('height',e)}},this._renderer._layer_containers[e].tracers.push(o),this._renderer._layer_containers[e].tracers.push(h),o.setAttribute('pointer-events','none'),h.setAttribute('pointer-events','none'),r.tracers.push(o)}'undefined'==typeof t.offset||null===t.offset||(d.offset=t.offset),d.setAttribute('visibility','hidden'),this._renderer._layer_containers[e].push(d);var g=[o,d,h];return d.setAttribute('class',e),g.move=function(e){var t=d.getAttribute('transform'),r=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(t);r[1]&&r[2]&&d.setAttribute('transform','translate('+(e+.5)*c._RS+','+r[1]+') scale('+r[2]+')'),o&&(o.move(e+.5,.05),h.move(e+.5))},o&&(d.tracer=o,d.bobble=h),this._renderer._layer_containers[e].push(g),g},t=function(e,t,r,o){var d=this._renderer._canvas,c=this._renderer;if(o||(o={}),!d){var u=arguments.callee,h=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),u.call(h,e,t,o)}),void log('Delaying rendering, waiting for sequence change')}var g=d.rect(-.25+this._index,60,t||1,o.height||4,o),m=parseFloat(g.getAttribute('x')),_=m+parseFloat(g.getAttribute('width')),f=this._renderer._layer_containers[e];if('undefined'!=typeof o.merge&&o.merge)for(var y=0;y<f.length;y++)if(f[y].value==r){var v=parseFloat(f[y].getAttribute('x')),b=v+parseFloat(f[y].getAttribute('width'));if(v<=m&&m<=b||m<=v&&v<=_)return f[y].setAttribute('x',''+s(v,m)),f[y].setAttribute('width',''+(n(b,_)-s(v,m))),g.parentNode.removeChild(g),f[y]}if(this._renderer._layer_containers[e].push(g),g.setAttribute('class',e),g.setAttribute('visibility','hidden'),g.setAttribute('stroke-width','0px'),'undefined'!=typeof r&&(g.setAttribute('opacity',r),g.value=r),g.setAttribute('fill',o.fill||l.a.layers[e].color),g.position_start=this._index,g.position_end=this._index+t,'undefined'!=typeof o.offset||o.height_scale){var x=o.offset;g.setHeight=function(e){var t=o.height?o.height*c._RS/c.zoom:e*(o.height_scale||1);'bottom'==o.align?(this.setAttribute('y',x*c._RS/c.zoom-e*(o.height_scale||1)),this.setAttribute('height',t)):(this.setAttribute('y',x*c._RS/c.zoom),this.setAttribute('height',t))}}return g},r=function(e,t,r){var n=this._renderer._canvas,s=this._renderer;if(!n){var o=arguments.callee,l=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),o.call(l,e,t,r)}),void log('Delaying rendering, waiting for sequence change')}r||(r={}),r.height&&(r.height*=this._renderer._RS);var c=r.height||this._renderer._layer_containers[e].trackHeight||4,u=this._index;1<t&&(u+=d(.5*t));var h=4/3,g=n.text(u,0,r.txt||r.content||'Text');if(g.setAttribute('font-size',h*c),g.cached_width=g.getComputedTextLength()/c,g.setAttribute('font-weight','bolder'),g.setAttribute('fill',r.fill||'#ffffff'),g.setAttribute('stroke','#000000'),'stroke_width'in r||(r.stroke_width=5),g.setAttribute('stroke-width',r.stroke_width+''),g.setAttribute('style','font-family: '+n.font_order),g.firstChild.setAttribute('dy','1.3ex'),g.setAttribute('text-anchor','middle'),r.align&&('left'==r.align&&g.setAttribute('text-anchor','start'),'right'==r.align&&g.setAttribute('text-anchor','end')),1<t){var m=n.clipPath(),_=n.rect(-.5*t,r.offset||0,t,c);m.push(_),_.removeAttribute('y');var f='id'+new Date().getTime()+'_'+m.parentNode.childNodes.length;m.setAttribute('id',f),g.setAttribute('clip-path','url(#'+f+')')}return'undefined'==typeof r.offset?g.setHeight=function(e){g.setAttribute('stroke-width',5/s.zoom),r.height?(g.setAttribute('font-size',h*r.height/s.zoom),_&&_.setAttribute('height',r.height/s.zoom)):(g.setAttribute('font-size',h*e),_&&_.setAttribute('height',e))}:(g.setAttribute('transform','translate('+g.getAttribute('x')+','+g.getAttribute('y')+')'),g.offset=r.offset,g.setHeight=function(e){var n=this.offset;this.setAttribute('x',0),this.setAttribute('y',n*s._RS/s.zoom),_&&_.setAttribute('y',this.getAttribute('y')),this.setAttribute('stroke-width',5/s.zoom),r.height?(this.setAttribute('font-size',h*r.height/s.zoom),_&&_.setAttribute('height',r.height/s.zoom)):(this.setAttribute('font-size',h*e),_&&_.setAttribute('height',e)),_?this.cached_width*e>50*t?(this.setAttribute('x',50*(-.5*t)),this.setAttribute('text-anchor','start')):(this.setAttribute('x','0'),this.setAttribute('text-anchor','middle')):(this.setAttribute('x','0'),this.setAttribute('text-anchor','middle'))}),1<t&&(g.move=function(e,t){_&&_.setAttribute('x',.5*(-1*t*s._RS)),_&&_.setAttribute('width',t*s._RS),g.setAttribute('x',(e+parseInt(.5*t))*s._RS)}),this._renderer._layer_containers[e].push(g),g},c=function(e,t,r){var n=this._renderer._canvas,s=this._renderer;if(!n){var o=arguments.callee,d=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),o.call(d,e,t,r)}),void log('Delaying rendering, waiting for sequence change')}var c={pentagon:n.pentagon,hexagon:n.hexagon,rectangle:n.rect,ellipse:n.ellipticalRect,roundrect:function(e,t,r,s){return n.roundRect(e,t,r,s,.25*s)}};r.rotate||(r.rotate=0);var u=null,h=(r.shape.split('-')||'')[0];if(h in c){var g=r.shape.split('-')[1];'left'!=g||r.rotate||(r.rotate=90),'right'!=g||r.rotate||(r.rotate=270),'flip'!=g||r.rotate||(r.rotate=180),u=c[h].call(n,this._index,60,t||1,r.height||4,r.rotate)}else return;if('undefined'!=typeof r.offset){var m=u.getAttribute('x'),_=u.getAttribute('y');u.setAttribute('transform','translate('+m+','+_+')'),u.setAttribute('x','0');var f=r.offset||0,y=r.height||4;u.setAttribute('y',f*this._renderer._RS),u.setHeight=function(){this._orig_stroke_width||(this._orig_stroke_width=parseInt(this.getAttribute('stroke-width'))),u.setAttribute('y',f*s._RS/s.zoom),u.setAttribute('height',y*s._RS/s.zoom),u.setAttribute('stroke-width',this._orig_stroke_width/s.zoom),'ellipse'==r.shape&&u.setAttribute('ry',.5*(y*s._RS)/s.zoom),'roundrect'==r.shape&&(u.setAttribute('rx',.25*(y*s._RS)/s.zoom),u.setAttribute('ry',.25*(y*s._RS)/s.zoom))},u.move=function(e,t){var r=this.getAttribute('transform'),n=/translate\(.*[,\s](.*)\)/.exec(r);n[1]&&this.setAttribute('transform','translate('+e*s._RS+','+n[1]+')'),this.setAttribute('width',t*s._RS)}}if('undefined'!=typeof r.offset&&('hexagon'==r.shape||'pentagon'==r.shape)){var f=r.offset||0,y=r.height||4,v=n.group();v.setAttribute('transform',u.getAttribute('transform')),v.push(u),u.setAttribute('transform','translate(0,0)'),v.setHeight=function(){u._orig_stroke_width||(u._orig_stroke_width=parseInt(u.getAttribute('stroke-width'))||0),u.setHeight(y*s._RS/s.zoom),u.setAttribute('stroke-width',this._orig_stroke_width/s.zoom),u.setAttribute('transform','translate(0,0)')},this._renderer._layer_containers[e].push(v),v.setAttribute('visibility','hidden'),v.setAttribute('class',e),v.position_start=this._index,v.position_end=this._index+t}else this._renderer._layer_containers[e].push(u),u.setAttribute('visibility','hidden'),u.setAttribute('class',e),u.position_start=this._index,u.position_end=this._index+t;return u.setAttribute('fill',r.fill||l.a.layers[e].color),r.stroke&&u.setAttribute('stroke',r.stroke),r.stroke_width?u.setAttribute('stroke-width',s._RS*r.stroke_width):u.style.strokeWidth='0',u},u=function(e,t,r){var n=this._renderer._canvas;if(!n){var s=arguments.callee,o=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),s.call(o,e,t,r)}),void log('Delaying rendering, waiting for sequence change')}var d=n.rect(-.25+this._index,60,r||1,4);return this._renderer._layer_containers[e].push(d),d.style.strokeWidth='0px',d.setAttribute('fill',l.a.layers[e].color),d.setAttribute('visibility','hidden'),d.setAttribute('class',e),d},h=function(e,t,r){var s=this._renderer._canvas,o=this._renderer;if('string'==typeof t){var d=document.createElement('div');o.fillTemplate(t,r,function(e,t){d.innerHTML=t}),t=d}if(!s){var l=arguments.callee,c=this;return p.a.add(this._renderer,'sequencechange',function(){p.a.remove(this._renderer,'sequencechange',arguments.callee),l.call(c,e,width,r)}),void log('Delaying rendering, waiting for sequence change')}var u=s.callout(this._index+.5,.01,t,{width:10*r.width||100,height:10*r.height||100,align:r.align,"font-size":r['font-size']});return u.setHeight(r.height*this._renderer._RS),this._renderer._canvas_callout_padding=n(10*r.height||100,this._renderer._canvas_callout_padding||0),this._renderer._layer_containers[e].push(u),u.clear=function(){var t=o._layer_containers[e];0<t.indexOf(u)&&t.splice(t.indexOf(u),1),u.parentNode.removeChild(u)},u},_=function(e,t,r){var n=this._index,s=o(this._renderer.scalePosition(this.original_index+t,e))-1,d=c.call(n<s?this:this._renderer._sequence_els[s],e,o(s-n),r);return d.aa=this.original_index,d.aa_width=t,d},f=function(e,r,n,s){var d=this._index,l=o(this._renderer.scalePosition(this.original_index+r,e))-1,c=t.call(d<l?this:this._renderer._sequence_els[l],e,o(l-d),n,s);return(s||{}).merge?(c.aa_width=parseInt(c.getAttribute('width'))/this._renderer._RS,c.aa_width==r&&(c.aa=this.original_index)):(c.aa_width=r,c.aa=this.original_index),c},y=function(e,t,n){var s=this._index,d=o(this._renderer.scalePosition(this.original_index+t,e))-1,l=r.call(s<d?this:this._renderer._sequence_els[d],e,o(d-s),n);return l.aa=this.original_index,l.aa_width=t,l},v=function(e,t,r){var n=this._index,s=o(this._renderer.scalePosition(this.original_index+r,e))-1,d=u.call(n<s?this:this._renderer._sequence_els[s],e,t,o(s-n));return d.aa=this.original_index,d},b=function(t,r){var n=e.call(this,t,r);return n.aa=this.original_index,n.aa_width=1,n};m.prototype.enableScaling=function(){p.a.add(this,'readerRegistered',function(e){console.log('Enabling scaling for legacy readers');var t=e.gotResult,r=this;e.gotResult=function(){var n=e.acc||e.agi||'',s=m.prototype.getAminoAcidsByPosition,o=m.prototype.getAminoAcidsByPeptide,d=r.sequence;r.sequences?r.sequence=(r.sequences[r.sequences.map(function(e){return(e.agi||e.acc||'').toLowerCase()}).indexOf(n.toLowerCase())]||'').toString():d=null,r.getAminoAcidsByPosition=function(e,t,r){return t||r||console.log('Guessing scaling identifier as',n),s.call(this,e,t||n,r||n)},r.getAminoAcidsByPeptide=function(e,t,r){return t||r||console.log('Guessing scaling identifier as',n),o.call(this,e,t||n,r||n)},t.call(e),d&&(r.sequence=d),r.getAminoAcidsByPosition=s,r.getAminoAcidsByPeptide=o}})},m.prototype._extendElement=function(e){e.addToLayer=b,e.addBoxOverlay=f,e.addShapeOverlay=_,e.addTextOverlay=y,e.addToLayerWithLink=v,e.callout=h,e._renderer=this},m.prototype.remove=function(e,t){return!!t&&!!(this._layer_containers[e]&&0<=this._layer_containers[e].indexOf(t))&&(this._layer_containers[e].splice(this._layer_containers[e].indexOf(t),1),p.a.fire(t,'removed'),t.parentNode&&t.parentNode.removeChild(t),t.tracer&&t.tracer.parentNode&&t.tracer.parentNode.removeChild(t.tracer),t.bobble&&t.bobble.parentNode&&t.bobble.parentNode.removeChild(t.bobble),!0)};var x=function(e,t){var r=[],n=[];for(i=0;i<t.length;i++){var s=t[i],o=null;if(s)if(t[i+1]&&(o=t[i+1]),!o||10<parseInt(o.aa)-parseInt(s.aa)||e.sequence.substring(s,o-1).match(/[ST]/)){if(3>r.length)r.push(s);else{r.push(s),r.forEach(function(e){e.options.zoom_level='text'});var d=r[0].coalesce||t[0].coalesce;n.push({aa:r[0].aa,type:'shape',width:parseInt(s.aa)-parseInt(r[0].aa)+1,options:{zoom_level:'summary',shape:'roundrect',fill:d.fill,stroke:d.stroke,stroke_width:d.stroke_width,height:r[0].options.height,offset:r[0].options.offset}})}r=[]}else r.push(s)}n.forEach(function(e){t.push(e)})};m.prototype.fix_icons=function(e){if(!this.icons_failed)return e;if('string'==typeof e){var t=e.split('_');if(t[0]&&this.icons_failed[t[0].replace('#','')]){t[0]=this.icons_failed[t[0].replace('#','')]+'#';var r=t.shift();return console.log(e,r+t.join('_')),r+t.join('_')}}return e},m.prototype.renderObjects=function(t,e){var r=this;0<e.length&&e[0].coalesce&&x(r,e);var n=[];return e.forEach(function(s){var e=s.options?(s.options.height||r._layer_containers[t].track_height)+(s.options.offset+s.options.height||0):0;if(s.options&&e>r._layer_containers[t].track_height){var o=r._layer_containers[t].track_height+s.options.offset+(s.options.height||r._layer_containers[t].track_height);(r._layer_containers[t].fixed_track_height||0)<o&&(r._layer_containers[t].fixed_track_height=o)}var d,l;if((!s.aa||r.getAA(parseInt(s.aa),t))&&!('undefined'!=typeof s.aa&&isNaN(s.aa))){if('text'==s.type&&(s.aa?s.width?l=r.getAA(parseInt(s.aa),t).addTextOverlay(t,s.width,s.options):l=r.getAA(parseInt(s.aa),t).addTextOverlay(t,1,s.options):s.peptide&&(l=r.getAminoAcidsByPeptide(s.peptide,t).addTextOverlay(t,1,s.options))),'box'===s.type&&(s.aa?l=r.getAA(parseInt(s.aa),t).addBoxOverlay(t,parseInt(s.width),1,s.options):s.peptide&&(l=r.getAminoAcidsByPeptide(s.peptide,t).addToLayer(t,1,s.options))),'shape'==s.type&&(s.aa?l=r.getAA(parseInt(s.aa),t).addShapeOverlay(t,parseInt(s.width),s.options):s.peptide&&(l=r.getAminoAcidsByPeptide(s.peptide,t)[0].addShapeOverlay(t,s.peptide.length,s.options))),'line'==s.type&&(l=r.addValuesToLayer(t,s.values,s.options)),'marker'==s.type){var c=(s.options||{}).content,u=s.options.height;if(Array.isArray&&Array.isArray(c)){var p={};for(var h in s.options)s.options.hasOwnProperty(h)&&(p[h]=s.options[h]);s.options.content&&Array.isArray(_)&&(p.content=s.options.content.map(r.fix_icons.bind(r))),d=r.getAA(parseInt(s.aa),t).addToLayer(t,p),d=d[1],d.style.display='none',s.options.content=s.options.alt_content,c=s.options.content}if('object'==typeof c){var g;'circle'==c.type&&(g=r._canvas.circle(-.5,-.5,1,1)),'text_circle'==c.type&&(g=r._canvas.text_circle(.5,.5,1,c.text,c.options||{}),s.options.break_viewbox=!0),'left_triangle'==c.type&&(g=r._canvas.poly('-100,0 0,-100 0,100')),'right_triangle'==c.type&&(g=r._canvas.poly('0,100 100,0 0,-100')),['fill','stroke','stroke-width','fill-opacity','stroke-opacity','opacity'].forEach(function(e){c[e]&&g.setAttribute(e,c[e])}),s.options.content=g}var m={};for(var h in s.options)s.options.hasOwnProperty(h)&&(m[h]=s.options[h]);var _=(s.options||{}).content;_&&'string'==typeof _&&(m.content=r.fix_icons(_)),_&&Array.isArray(_)&&(m.content=_.map(r.fix_icons.bind(r)));var f=r.getAA(parseInt(s.aa),t).addToLayer(t,m);d&&(d.toggleReveal=function(e){e.stopPropagation(),'none'===this.style.display?(this.parentNode.appendChild(this),this.style.display='block'):this.style.display='none',r.refresh()},f[1].addEventListener('touchstart',d.toggleReveal.bind(d),!0),f[1].addEventListener('click',d.toggleReveal.bind(d),!1)),l=f[1]}(s.options||{}).zoom_level&&(l.zoom_level=s.options.zoom_level),s.identifier&&l.setAttribute('identifier',s.identifier),(s.options||{}).events&&l&&s.options.events.forEach(function(r){(r.type||'').split(',').forEach(function(e){'click'==e&&l.style&&(l.style.cursor='pointer'),l.addEventListener(e,function(n){n.event_data=r.data,n.layer=t,n.aa=s.aa})})}),n.push(l)}}),n},m.prototype.addTextTrack=function(e,t){var r=this._RS,n=this,s=300,d=n._canvas,c=e.split(''),u=d.set(),h=!1,m=0,_=!0,f=function(){};try{var y=document.createElementNS(g,'text');y.setAttribute('textLength',10),f(y.textLength)}catch(t){_=!1}var v=!1;'undefined'==typeof l.a.supports_dx?function(e){if(!e)return void(v=!1);var t=document.createElementNS(g,'text');if(t.setAttribute('textLength',30),!!t.getExtentOfChar){t.setAttribute('x','0'),t.setAttribute('y','0'),t.textContent='ABC',d.appendChild(t);var r=t.getExtentOfChar(2).x;t.setAttribute('dx','10'),v=!(9.5>o(t.getExtentOfChar(2).x-r)),l.a.supports_dx=v,t.parentNode.removeChild(t)}}(_):v=l.a.supports_dx;var b;if(_&&'lengthAdjust'in document.createElementNS(g,'text')&&'textLength'in document.createElementNS(g,'text'))e.length<=s?(b=d.text(0,12,document.createTextNode(e)),b.setAttribute('textLength',r*e.length)):(b=d.text(0,12,document.createTextNode(e.substr(0,s))),b.setAttribute('textLength',r*s)),d.insertBefore(b,d.firstChild.nextSibling),b.style.fontFamily='\'Lucida Console\', \'Courier New\', Monaco, monospace',b.setAttribute('lengthAdjust','spacing'),b.setAttribute('text-anchor','start'),b.setAttribute('dx',5),b.setAttribute('dy','1.5ex'),b.setAttribute('font-size',r),b.setAttribute('fill','#000000'),u.push(b),t.push(b);else{for(var x=0;x<c.length;x++)b=d.text(m,12,c[x]),b.firstChild.setAttribute('dy','1.5ex'),u.push(b),t.push(b),b.style.fontFamily='\'Lucida Console\', Monaco, monospace',m+=1;u.attr({width:r,"text-anchor":'start',height:r,"font-size":r,fill:'#000000'})}var E=function(){if(e.length<=s)return;var t=n._container_canvas.parentNode.cached_width;if(!t){t=n._container_canvas.parentNode.getBoundingClientRect().width;var o=document.documentElement.clientWidth;o>t&&(t=o)}let d=Math.ceil(10*t*n.zoom/r);d>e.length&&(d=e.length),b.setAttribute('textLength',r*d);var l=parseInt(n.leftVisibleResidue());l-=50,0>l&&(l=0),l+d>=e.length&&(l=e.length-d,0>l&&(l=0)),b.replaceChild(document.createTextNode(e.substr(l,d)),b.firstChild),b.setAttribute(v?'dx':'x',5+l*r)},A=function(){h&&u.attr({display:'none'})},w=function(){h&&(u.attr({display:'block'}),E())},T=function(){3.6<d.zoom?(u.attr({display:'block'}),h=!0,E()):.2<d.zoom?(u.attr({display:'none'}),h=!1):(u.attr({display:'none'}),h=!1)};return t.panevents||(d.addEventListener('panstart',A,!1),p.a.add(d,'panend',w),t.panevents=!0),p.a.add(d,'zoomChange',T,!1),p.a.add(u[0],'removed',function(){d.removeEventListener('panstart',A),p.a.remove(d,'panend',w),p.a.remove(d,'zoomChange',T),delete t.panevents}),u},m.prototype.renderTextTrack=function(e,t){var r=e;'string'!=typeof r&&(r=e.name);var n=this._canvas;if(n&&'undefined'!=typeof r){var s=this,o=this._layer_containers[r],d=this.addTextTrack(t,o);return d}}}(),m.prototype.EnableHighlights=function(){var e=this,t=[],r=function(){var r=e._canvas.rect(0,0,0,'100%');r.addEventListener('click',(e)=>(e.stopPropagation(),!1)),r.addEventListener('mousedown',(e)=>(e.stopPropagation(),!1)),r.addEventListener('touchstart',(e)=>(e.stopPropagation(),!1)),r.setAttribute('fill','#ffdddd'),r.removeAttribute('stroke');var n=r.parentNode;n.insertBefore(r,n.firstChild.nextSibling),t.push(r)};r(),e.moveHighlight=function(){var e=Array.prototype.slice.call(arguments),n=this._RS,s=0,o=0;for(s=0;s<e.length;s+=2){var d=e[s],l=e[s+1],c=t[o];c||(r(),c=t[o]),c.previousSibling.previousSibling&&0>t.indexOf(c.previousSibling.previousSibling)&&c.parentNode.insertBefore(c,c.parentNode.firstChild.nextSibling),c.setAttribute('x',(d-1)*n),c.setAttribute('width',(l-(d-1))*n),c.setAttribute('visibility','visible'),o+=1}for(s=o;s<t.length;s++)t[s].setAttribute('visibility','hidden')}},function(){var e=function(e,t){'ontouchstart'in window?e.addEventListener('touchstart',function(r){var n=r.touches[0].clientX,s=r.touches[0].clientY,d=function(){document.body.removeEventListener('touchmove',c),e.removeEventListener('touchend',l)},l=function(e){d(),e.stopPropagation(),e.preventDefault(),t&&t.call(null,e)},c=function(e){(10<o(e.touches[0].clientX-n)||10<o(e.touches[0].clientY-s))&&d()};document.body.addEventListener('touchmove',c,{passive:!0}),e.addEventListener('touchend',l,!1)},{passive:!0}):e.addEventListener('click',t,!1)},t=function(e){var t=0,r=0;return e||(e=window.event),e.pageX||e.pageY?(t=e.pageX-(document.body.scrollLeft+document.documentElement.scrollLeft),r=e.pageY-(document.body.scrollTop+document.documentElement.scrollTop)):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),self.targetElement&&(t=e.screenX,r=e.screenY),[t,r]},r=function(e,r){var n=t(e.changedTouches?e.changedTouches[0]:e),s={};if('svg'==r.nodeName){s=r.createSVGPoint();var o=r.getScreenCTM();s.x=n[0],s.y=n[1],self.matrix=o.inverse(),s=s.matrixTransform(self.matrix)}else s.x=n[0],s.y=n[1];return s},n=function(e,t,r){let n=new WeakMap;n.set(r,[e,t]);for(let o of Object.keys(r._layer_containers||{})){var s=l.a.getLayer(o);let d=[null,null];e&&t&&(d=[r.scalePosition(e,o,!0),r.scalePosition(t,o,!0)]),p.a.fire(s,'selection',d),n.set(s,d)}p.a.fire(r,'selection',n)};m.prototype.enableSelection=function(){var s=this;if(!s._canvas)return void p.a.add(s,'sequenceChange',function(){s.enableSelection()});var o=s._canvas,d,l,c,u;let h=!1;var g=function(e){e.preventDefault();var t=r(e,o);l=t.x,d>l?(u=parseInt(d/50),c=parseInt(l/50)):(u=parseInt(l/50),c=parseInt(d/50)),s.select(c+1,u)};e(o,function(){!s.selecting}),o.addEventListener('mousedown',function(e){if(s.selecting){h=!0,s.select();var r=t(e),n={};if('svg'==o.nodeName){n=o.createSVGPoint();var c=this.getScreenCTM();n.x=r[0],n.y=r[1],s.matrix=c.inverse(),n=n.matrixTransform(s.matrix)}else n.x=r[0],n.y=r[1];d=n.x,l=n.x,o.addEventListener('mousemove',g,!1),e.preventDefault()}},!1),o.addEventListener('mouseup',function(e){h&&(n(null===c?null:c+1,u,s),c=null,u=null,h=!1),o.removeEventListener('mousemove',g),e.preventDefault()}),o.addEventListener('touchend',function(){h&&setTimeout(function(){n(null===c?null:c+1,u,s),c=null,u=null,h=!1},500),o.removeEventListener('touchmove',g)}),o.addEventListener('touchstart',function(e){if(s.selecting&&1==e.changedTouches.length){h=!0,e.preventDefault();var r=t(e.changedTouches[0]),n={};if('svg'==o.nodeName){n=o.createSVGPoint();var c=this.getScreenCTM();n.x=r[0],n.y=r[1],s.matrix=c.inverse(),n=n.matrixTransform(s.matrix)}else n.x=r[0],n.y=r[1];d=n.x,l=n.x,o.addEventListener('touchmove',g,{passive:!1})}},{passive:!1})}}(),m.prototype._visibleTracers=function(){var e=null;for(var t in l.a.layers)this.isLayerActive(t)&&this._layer_containers[t]&&this._layer_containers[t].tracers&&(e?e.concat(this._layer_containers[t].tracers):e=this._layer_containers[t].tracers);return e},m.prototype._resizeContainer=function(){this._RS;if(this._container&&this._canvas){var e=2*(this.zoom||1)*this.sequence.length,t=2*(this.zoom||1)*(this._canvas._canvas_height/this._RS);this._canvas_callout_padding&&(t+=this._canvas_callout_padding),this._canvas.setAttribute('width',e),this._canvas.setAttribute('height',t),this.navigation.setDimensions(e,t),this.grow_container?this._container_canvas.setAttribute('height',t):(this._container_canvas.setAttribute('height','100%'),this._container_canvas.setAttribute('width','100%'),this.navigation.setZoom(this.zoom))}},function(e){var t=function(e,t){var r=this;!e._layer_containers[r.name]||0>=e._layer_containers[r.name].length||!t&&e._layer_containers[r.name].tracers&&e._layer_containers[r.name].tracers.hide()};e.prototype.addTrack=function(e){var r=this._RS,n=this;if(!this._canvas)return p.a.add(this,'sequencechange',function(){this.addTrack(e),p.a.remove(this,'sequencechange',arguments.callee)}),void console.log('No canvas, cannot add track, waiting for sequencechange event');var s=this._layer_containers||[];if(!s[e.name]||null===s[e.name]){s[e.name]=this._canvas.set(),s[e.name].track_height||(s[e.name].track_height=n.trackHeight||4),p.a.remove(e,'visibilityChange',t),p.a.add(e,'visibilityChange',t);p.a.remove(e,'removed'),p.a.add(e,'removed',function(e){e?e.removeTrack(this):n.removeTrack(this)})}this._layer_containers=s},e.prototype.removeTrack=function(e){if(this._layer_containers){var t=this._layer_containers||[];if(t[e.name]){let r=[].concat(t[e.name]);for(let t of r)this.remove(e.name,t);delete this._layer_containers[e.name],e.disabled=!0}}};e.prototype.disablePrintResizing=function(){delete this._media_func},e.prototype.enablePrintResizing=function(){if((this.win()||window).matchMedia){if(this._media_func)return this._media_func;this._media_func=function(e){var t=this;if(t._canvas){if(t.grow_container)return void(e.matches&&(delete t._container_canvas.parentNode.cached_width,p.a.fire(t._canvas,'panend')));if(!e.matches){if(t.old_zoom){var r=t.old_zoom;t.old_zoom=null,t.zoomCenter=null,t.withoutRefresh(function(){t.zoom=r}),t._canvas.setCurrentTranslateXY(t.old_translate,0),t._container_canvas.setAttribute('viewBox',t.old_viewbox),t.old_zoom=null,t.old_translate=null,t.refresh(),p.a.fire(t._canvas,'zoomChange')}return}try{var n=t._container;t.old_translate=t._canvas.currentTranslateCache.x,t._canvas.setCurrentTranslateXY(0,0);var s=.95*n.clientWidth/t.sequence.length;t.old_zoom||(t.old_zoom=t.zoom,t.old_viewbox=t._container_canvas.getAttribute('viewBox')),t.zoomCenter=null,t._container_canvas.removeAttribute('viewBox'),t.withoutRefresh(function(){t.zoom=s}),t.refresh()}catch(e){console.log(e),console.log(e.stack)}}};var e=this;e._bound_media||(this.win()||window).matchMedia('print').addListener(function(t){e._media_func&&e._media_func(t)}),e._bound_media=!0}},e.prototype.refresh=function(e){if(this._canvas){var t=this._layer_containers||[],r=this._RS,n=0,s=this.trackOrder||[],o=this.fixedFontScale;this.navigation&&this.navigation.reset();for(var d=0;d<s.length;d++){var c=s[d],u=t[c];if(u){var p;if(!this.isLayerActive(c)){var h={y:-1*this._axis_height*r,height:r*u.track_height/this.zoom,visibility:'hidden'};if(l.a.getLayer(c).group){var g=this.navigation.getController(l.a.getLayer(c).group);g&&this.isLayerActive(g)&&(h.y=t[g.name].currenty())}u.fixed_track_height&&delete h.height,e?u.animate(h):u.attr(h),u.tracers;continue}else;var m=n;if(u.fixed_track_height){u.fixed_track_height;p=this._axis_height+n/this.zoom,e?u.animate({visibility:'visible',y:p*r,height:r*u.track_height/this.zoom}):u.attr({visibility:'visible',y:p*r,height:r*u.track_height/this.zoom}),this.navigation&&(p-=1*u.track_height/this.zoom,this.navigation.renderTrack(l.a.getLayer(c),p*r,r*u.fixed_track_height/this.zoom,{"font-scale":3*(o||1)*u.track_height/u.fixed_track_height})),n+=u.fixed_track_height+this.trackGap-u.track_height}else p=this._axis_height+n/this.zoom,e?u.animate({visibility:'visible',y:p*r,height:r*u.track_height/this.zoom}):u.attr({visibility:'visible',y:p*r,height:r*u.track_height/this.zoom}),this.navigation&&(p-=1*u.track_height/this.zoom,this.navigation.renderTrack(l.a.getLayer(c),p*r,3*r*u.track_height/this.zoom,o?{"font-scale":o}:null),n+=u.track_height),n+=u.track_height+this.trackGap;if(u.refresh_zoom(),u.tracers){var _=this.isLayerActive(c)&&3.6<this.zoom?'visible':'hidden',f=(1.5+m/this.zoom)*r;e?u.tracers.animate({visibility:_,y:.65*this._axis_height*r,height:f}):u.tracers.attr({visibility:_,y:.65*this._axis_height*r,height:f})}}}var y=[-1,0,0,0];y[0]=-2*r,y[2]=(this.sequence.split('').length+this.padding+2)*r,y[3]=(this._axis_height+n/this.zoom+this.padding/this.zoom)*r,this._canvas.setAttribute('viewBox',y.join(' ')),this._canvas._canvas_height=y[3];var v=[].concat(y);v[0]=0,v[2]=this.zoom*(2*this.sequence.length)+this.padding,v[3]=2*this.zoom*(this._axis_height+n/this.zoom+this.padding/this.zoom),this.grow_container?this._container_canvas.removeAttribute('viewBox'):this._container_canvas.setAttribute('viewBox',v.join(' ')),this._resizeContainer(),y[0]=0,this.navigation&&(this.grow_container&&(this.navigation.nav_width_base=200>v[3]?v[3]:200),this.navigation.move_closer(),this._canvas.style.GomapScrollLeftMargin=this.navigation.visible()?100*r/this.zoom:1e3,this.navigation.setViewBox(y.join(' '))),this.navigation&&this.navigation.refresh()}};var r=function(e){e.setAttribute('xmlns','http://www.w3.org/2000/svg'),e.setAttribute('xmlns:xlink','http://www.w3.org/1999/xlink');var t=new XMLSerializer().serializeToString(e);return'data:image/svg+xml,'+encodeURIComponent(t)};e.prototype.pngURL=function(e,t){for(var n=this._canvas.cloneNode(!0),s=n.querySelectorAll('text[data-spaces]'),o=0;o<s.length;o++)s[o].parentNode.removeChild(s[o]);var d=document.createElementNS(g,'svg');d.setAttribute('width',this._container_canvas.getBoundingClientRect().width),d.setAttribute('height',this._container_canvas.getBoundingClientRect().height),d.setAttribute('preserveAspectRatio','xMinYMin meet');var l=document.createElementNS(g,'g');l.setAttribute('transform',this._canvas.parentNode.getAttribute('transform')),d.appendChild(l),l.appendChild(n);for(var c=this._container_canvas.querySelectorAll('defs'),o=0;o<c.length;o++)d.appendChild(c[o].cloneNode(!0));var u=document.createElement('canvas'),p=2*parseInt(d.getAttribute('width')),h=2*parseInt(d.getAttribute('height'));if(t&&p>t){var m=p/t;p=t,h=parseInt(h/m)}u.width=p,u.height=h;var _=new Image;_.width=1,_.height=1;var f=u.getContext('2d');_.onload=function(){f.drawImage(_,0,0,u.width,u.height),e(u.toDataURL())},_.onerror=function(){console.log('Got an error')};var y=r(d);_.src=y}}(m),m.Zoom=function(e){var t=null,r=null,n=null,s=null,d=null,c={setZoom:function(l){var c=e._container.cached_width;if(c||(c=e._container.clientWidth),!e.sequence)return void(n=l);var g=c/(2*e.sequence.length);l<g&&(l=g),10<l&&(l=10);var m=this;if(l==n)return void(this.refresh.suspended&&m._canvas&&m._canvas.zoom!==parseFloat(n)&&(m._canvas.zoom=parseFloat(n),m._canvas.setScale(1),p.a.fire(m._canvas,'zoomChange')));if(!m._canvas)return void(n=l);var _=!1;if('center'==m.zoomCenter&&(_=!0,m.zoomCenter={x:.5*m._RS*(m.leftVisibleResidue()+m.rightVisibleResidue())}),m.zoomCenter&&!s)d=m._canvas.currentTranslateCache.x||0,s=m.zoomCenter?m.zoomCenter.x:0;else if(s&&!m.zoomCenter)return;t?clearTimeout(t):r=parseFloat(n||1),n=parseFloat(l);var f=o(parseFloat(l)/r);if(window.cancelAnimationFrame(u),u=window.requestAnimationFrame(function(){m._canvas.setScale(f)}),p.a.fire(m._canvas,'_anim_begin'),document.createEvent){var y=document.createEvent('Events');y.initEvent('panstart',!1,!0),m._canvas.dispatchEvent(y)}m._canvas.currentTranslateCache.x;if(s){var v=(r-n)/(25*f)*s;v+=d/f,cancelAnimationFrame(h),h=window.requestAnimationFrame(function(){m._canvas.setCurrentTranslateXY(v,2*((r-n)/f*m._axis_height))})}var b=function(){t=null;o(parseFloat(n)/r);m._canvas.setScale(null),p.a.fire(m._canvas,'panend'),p.a.fire(m._canvas,'_anim_end');let e=function e(){if(p.a.remove(m._canvas,'zoomChange',e),m.refresh(),'undefined'!=typeof s){var t=(r-n)/25*s;t+=d,m._resizeContainer(),m._canvas.shiftPosition?m._canvas.shiftPosition(t,0):m._canvas.setCurrentTranslateXY(t,0)}s=null,d=null};p.a.add(m._canvas,'zoomChange',e),m._canvas&&(m._canvas.zoom=parseFloat(n),p.a.fire(m._canvas,'zoomChange')),p.a.fire(m,'zoomChange')};this.refresh.suspended?b():t=setTimeout(b,100)},fitZoom:function(){var t=e._container.cached_width;t||(t=e._container.clientWidth);var r=.5;e.sequence&&(r=t/(2*e.sequence.length)),e.zoom=r},getZoom:function(){return n||1}},u,h;Object.defineProperty&&!l.a.IE8&&Object.defineProperty(e,'zoom',{get:c.getZoom,set:c.setZoom}),e.fitZoom=c.fitZoom},function(e){var t={getPadding:function(){return this._padding||10},setPadding:function(e){this._padding=e,this.refresh()},getTrackGap:function(){if(!this._track_gap){var e='ontouchend'in document?20:10;this._track_gap=this._track_gap||e}return this._track_gap},setTrackGap:function(e){this._track_gap=e,this.refresh()}};Object.defineProperty&&!l.a.IE8&&(Object.defineProperty(e.prototype,'padding',{get:t.getPadding,set:t.setPadding}),Object.defineProperty(e.prototype,'trackGap',{get:t.getTrackGap,set:t.setTrackGap}))}(m),m.Navigation=u.a,t.a=m},function(e,t,r){'use strict';var s=Math.PI,n=Math.max,o=Math.min,d=Math.floor,l=r(0);const c=function(){function e(e,t){var r,n,s,o,d;e.visibility=function(){for(var t='hidden',r=0;r<e.length;r++)if(!Array.isArray(e[r])&&(d=e[r].getAttribute('visibility'),d&&'hidden'!=d)){t=d;break}return t},e.currenty=function(){var t=e.filter(function(e){return e&&!Array.isArray(e)}),r;return t[0]&&t[0].getAttribute('transform')&&(r=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(t[0].getAttribute('transform')),null!==r&&'undefined'!=typeof r&&(r=r[2])),t[0]?parseInt(r||t[0].getAttribute('y')||0,10):0},e.animate=function(r){if('undefined'==typeof r.y)return void l(r);if(0!==e.length){var n={},s;for(s in r)r.hasOwnProperty(s)&&(n[s]=r[s]);if(_(),e.animating)for(var o=0;o<(u||[]).length;o++)u[o].target_set==e&&(e.animating=!1,u.splice(o,1));var d=e.visibility(),c=n.visibility;if(d==c&&'hidden'==c)return void l(r);var p=e.currenty();if(isNaN(parseInt(p,10)))return void console.log('Have a NaN y value, skipping');var h=parseInt(n.y,10);delete n.y,d==c&&'visible'==c&&(delete n.visibility,c=null,l({visibility:'visible'})),'hidden'==n.visibility&&delete n.visibility,l(n);var m=0;if(h!=p){var f=1*(Math.abs(parseInt((h-p)/(50*t),10)/g)+1),y=(h-p)/f;n.y=p||0;e.animate;e.animating=!0,n.y=p+1*y;let r=function t(r){return 0>y&&n.y<h&&(n.y=h),0<y&&n.y>h&&(n.y=h),l(n),m+=r||1,n.y==h?void(e.animating=!1,c&&l({visibility:c}),u.splice(u.indexOf(t),1)):void(n.y=p+y*(m+1))};u.push(r),u[u.length-1].target_set=e}}},e.attr=function(e){return p?this.animate(e):l(e)};var l=function(t){var d={},l;for(l in t)t.hasOwnProperty(l)&&(d[l]=t[l]);var c=e.visibility(),u=parseInt(d.y,10);for(l in o=d.visibility,d)if(d.hasOwnProperty(l))for(var p=0;p<e.length;p++)if(e[p]&&!Array.isArray(e[p])&&'none'!=e[p].style.display){var h=d[l];if('style'==l&&e[p].hasAttribute('style')){var g=e[p].getAttribute('style');g+='; '+d[l],h=g}var m=e[p].hasAttribute('transform')&&0<=e[p].getAttribute('transform').indexOf('translate');if('height'==l&&e[p].setHeight?e[p].setHeight(d[l]):!(m&&('y'==l||'x'==l))&&e[p].setAttribute(l,h),'y'==l&&e[p].hasAttribute('d')){var _=e[p].getAttribute('d'),f=/M\s*([\d\.]+) ([\d\.]+)/;if(_=_.replace(f,''),isNaN(parseInt(h,10)))throw'Error '+l+' is '+d[l];e[p].setAttribute('d','M0 '+parseInt(h,10)+' '+_)}if('y'==l&&e[p].hasAttribute('cy')&&e[p].setAttribute('cy',d[l]),'y'==l&&e[p].hasAttribute('transform')){if(s=e[p].getAttribute('transform'),r=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/.exec(e[p].getAttribute('transform')),null===r)continue;r=r[1],s=s.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/,'translate('+r+','+h+')'),e[p].setAttribute('transform',s)}if('x'==l&&e[p].hasAttribute('transform')){if(s=e[p].getAttribute('transform'),n=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(e[p].getAttribute('transform')),null===n)continue;n=n[2],s=s.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,'translate('+h+','+n+')'),e[p].setAttribute('transform',s)}'text-anchor'==l&&e[p].hasAttribute('style')&&(e[p].style.textAnchor=d[l])}};return e.hide=function(){this.attr({visibility:'hidden'})},e.show=function(){this.attr({visibility:'visible'})},e.refresh_zoom=function(){for(var t=0;t<e.length;t++)Array.isArray(e[t])||(e[t].zoom_level&&'text'==e[t].zoom_level&&(e[t].ownerSVGElement&&3.5<e[t].ownerSVGElement.zoom?(e[t].setAttribute('display','inline'),e[t].setAttribute('opacity',1)):e[t].setAttribute('display','none')),e[t].zoom_level&&'summary'==e[t].zoom_level&&(e[t].ownerSVGElement&&3.5>=e[t].ownerSVGElement.zoom?(e[t].setAttribute('display','inline'),e[t].setAttribute('opacity',1)):e[t].setAttribute('display','none')))},e}var t=Math.round,r=[],c='http://www.w3.org/2000/svg',u=null,p=!1,h=null,g=75,m=null,_=function e(){null===u?u=[]:(u.forEach(function(e){e._last_step=null}),clearInterval(h)),p||(r.forEach(function(e){l.a.fire(e,'_anim_begin')}),p=!0);var n=null;h=setInterval(function(){if(!u||0===u.length)return clearInterval(h),h=null,u=null,p=!1,void r.forEach(function(e){l.a.fire(e,'_anim_end')});var s=[];r.forEach(function(e){s.push(e.suspendRedraw(5e3))});var o=new Date().getTime();n||(n=new Date().getTime());for(var d=0;d<(u||[]).length;d++){var c=new Date().getTime(),_=parseInt((c-n)/g,10);null===m&&2<_-u[d]._last_step&&(m=t(1.6*g)),u[d].apply(null,[_-(u[d]._last_step||_)]),u&&u[d]&&(u[d]._last_step=_)}var f=new Date().getTime();r.forEach(function(e){e.unsuspendRedraw(s.shift())});var y=f-o;y<g&&null===m&&1<=y?(g=t(1.5*(f-o)),e()):null!==m&&m!=g&&(g=m,e())},g)},f=/scale\((-?\d+\.?\d*)\)/,v=function(e){var t=this.getAttribute('transform').toString(),r=f.exec(t),n=parseFloat(this.getAttribute('height')||1),s=1;return null===r?(t+=' scale(1) ',r=1):r=parseFloat(r[1]),s=parseFloat(e)/n*r,t=t.replace(f,'scale('+s+')'),this.setAttribute('transform',t),this.setAttribute('height',e),s};return function(l){var u=l.RS||1;l.RS=u,l.font_order='Helvetica, Verdana, Arial, Sans-serif',r.push(l),l.makeEl=function(e,t){var r=l.ownerDocument.createElementNS(c,e);for(var n in t)t.hasOwnProperty(n)&&r.setAttribute(n,t[n]);return r},l.make_gradient=function(e,r,n,s,o){for(var d=this.makeEl('linearGradient',{id:e,x1:'0%',x2:r,y1:'0%',y2:n}),l=s.length;0<s.length;){var c=t(100*((l-s.length)/l)),u=s.shift(),p=o.shift();d.appendChild(this.makeEl('stop',{offset:c+'%',style:'stop-color:'+u+';stop-opacity:'+p}))}return d},l.path=function(e){var t=document.createElementNS(c,'path');return t.setAttribute('d',e),t.setAttribute('stroke','#000000'),t.setAttribute('stroke-width','1'),this.appendChild(t),t},l.poly=function(e){var t=document.createElementNS(c,'polygon');return t.setAttribute('points',e),this.appendChild(t),t},l.circle=function(e,t,r){var n=document.createElementNS(c,'circle');return n.setAttribute('cx','string'==typeof e?e:e*u),n.setAttribute('cy','string'==typeof t?t:t*u),n.setAttribute('r','string'==typeof r?r:r*u),n.move=function(e){n.setAttribute('cx',e*u)},this.appendChild(n),n},l.group=function(){var e=document.createElementNS(c,'g');return this.appendChild(e),e.push=function(t){e.appendChild(t)},e},l.clipPath=function(){var e=document.createElementNS(c,'clipPath');return this.appendChild(e),e.push=function(t){e.appendChild(t)},e},l.line=function(e,t,r,n){var s=document.createElementNS(c,'line');return s.setAttribute('x1','string'==typeof e?e:e*u),s.setAttribute('y1','string'==typeof t?t:t*u),s.setAttribute('x2','string'==typeof r?r:r*u),s.setAttribute('y2','string'==typeof n?n:n*u),this.appendChild(s),s},l.rect=function(e,t,r,n,s){s||(s={});var o=document.createElementNS(c,'rect');return o.setAttribute('x','string'==typeof e?e:e*u),o.setAttribute('y','string'==typeof t?t:t*u),o.setAttribute('width','string'==typeof r?r:r*u),o.setAttribute('height','string'==typeof n?n:n*u),o.setAttribute('stroke','#000000'),this.appendChild(o),'undefined'!=typeof s.offset&&(o.offset=s.offset,o.setAttribute('transform','translate('+o.getAttribute('x')+','+o.getAttribute('y')+')'),o.setAttribute('x','0'),o.setAttribute('y',o.offset*u)),o.move=function(e,t){if('undefined'!=typeof this.offset&&this.getAttribute('transform')){var r=this.getAttribute('transform'),n=/translate\(.*[,\s](.*)\)/.exec(r);n[1]&&this.setAttribute('transform','translate('+e*u+','+n[1]+')'),this.setAttribute('width',t*u)}else this.setAttribute('x',e*u),this.setAttribute('width',t*u)},o},l.roundRect=function(e,t,n,s,o,d){var l=this.rect(e,t,n,s,d);return'object'==typeof o&&o.x||(o={x:o,y:o}),l.setAttribute('rx',o.x*u),l.setAttribute('ry',o.y*u),l},l.ellipticalRect=function(e,t,r,n){return this.roundRect(e,t,r,n,{x:.25*r,y:.5*n})},l.pentagon=function(e,t,r,n,s){return this.nagon(e,t,r,n,5,s)},l.hexagon=function(e,t,r,n,s){return this.nagon(e,t,r,n,6,s)};var p=function(e,t){this.constructor.prototype.setAttribute.call(this,e,t),('height'==e||'width'==e||'x'==e||'y'==e)&&this.redraw(d(parseFloat(this.getAttribute('height'))))};l.nagon=function(e,t,r,o,l,n){var c=this.poly('');return c.setAttribute('x',e*u),c.setAttribute('y',t*u),c.setAttribute('width',r*u),c.redraw=function(e){e?this.last_height=e:e=this.last_height;for(var t=.5*d(parseFloat(c.getAttribute('width'))),r=.5*e,o=[],u=null,p=null,h=0;h<l;h++){var g=2*(n/360)*s+2/l*s*h,m=parseInt(t+t*Math.cos(g)),_=parseInt(r+r*Math.sin(g));o.push([m,_]),(null===u||m<u)&&(u=m),(null===p||m>p)&&(p=m)}var f=d(parseFloat(c.getAttribute('x'))),y=d(parseFloat(c.getAttribute('y')));o.map(function(n){return n[0]==u&&(n[0]=0),n[0]==p&&(n[0]=2*t),n[0]+=f,n[1]=y+.5*e*(n[1]/r),n.join(',')}),this.setAttribute('points',o.join(' '))},c.setHeight=c.redraw,c.move=function(e,t){var r=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(this.getAttribute('transform'));if(null!==r){r=r[2];var n=this.getAttribute('transform').replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,'translate('+e*u+','+r+')');this.setAttribute('transform',n),a=.5*t*u}},c.setAttribute=p,c.redraw(o*u),c},l.use=function(e,t,r,n,s){var o=document.createElementNS(c,'use');return o.setAttribute('x','string'==typeof t?t:t*u),o.setAttribute('y','string'==typeof r?r:r*u),o.setAttribute('width','string'==typeof n?n:n*u),o.setAttribute('height','string'==typeof s?s:s*u),o.setAttributeNS('http://www.w3.org/1999/xlink','href',e),this.appendChild(o),o},l.a=function(e){var t=document.createElementNS(c,'a');return t.setAttribute('target','_new'),t.setAttributeNS('http://www.w3.org/1999/xlink','href',e),this.appendChild(t),t},l.button=function(e,t,r,n,s){var o=document.createElementNS(c,'foreignObject');o.setAttribute('x',e),o.setAttribute('y',t),o.setAttribute('width',e+r),o.setAttribute('height',t+n),o.style?o.style.position='absolute':o.setAttribute('style','position: absolute;'),this.appendChild(o);var d=document.createElement('button');return d.style.display='block',d.textContent=s,o.appendChild(d),d},l.svgbutton=function(e,t,r,n,s){var o=this.group(),d=this.rect(e,t,r,n);d.setAttribute('rx','10'),d.setAttribute('ry','10'),d.setAttribute('stroke','#ffffff'),d.setAttribute('stroke-width','2'),d.setAttribute('fill','url(#simple_gradient)'),e=d.x.baseVal.value,t=d.y.baseVal.value,r=d.width.baseVal.value,n=d.height.baseVal.value;var l=this.text(e+r/2,t+n/3,s);l.setAttribute('text-anchor','middle'),l.firstChild.setAttribute('dy','1.5ex'),l.setAttribute('font-size',.5*n),l.setAttribute('fill','#ffffff'),o.push(d),o.push(l),o.background_element=d,o.text_element=l,o.setAttribute('cursor','pointer');var c=function(){d.setAttribute('fill','#999999'),d.setAttribute('stroke','#000000')};o.addEventListener('mousedown',c,!1),o.addEventListener('touchstart',c,!1);var u=function(){d.setAttribute('stroke','#ffffff'),d.setAttribute('fill','url(#simple_gradient)')};return o.addEventListener('mouseup',u,!1),o.addEventListener('mouseout',u,!1),o.addEventListener('touchend',u,!1),o},l.callout=function(e,t,r,n){var s=this.group(),o=this.roundRect(-.5*(n.width+4),20,n.width+4,n.height+4,4);o.setAttribute('fill','#000000');var d=this.roundRect(-.5*(n.width+1),22,n.width+1,n.height,4);d.setAttribute('fill','#eeeeee'),s.push(o),s.push(d);var l=this.poly('0,500 500,1000 -500,1000');l.setAttribute('fill','#000000'),s.push(l);var p=document.createElementNS(c,'foreignObject');p.setAttribute('x',-.5*(n.width+1)*u),p.setAttribute('y',22*u),p.setAttribute('width',n.width*u),p.setAttribute('height',n.height*u),s.push(p);var h=document.createElementNS('http://www.w3.org/1999/xhtml','html');h.setAttribute('xmlns','http://www.w3.org/1999/xhtml');var g=document.createElementNS('http://www.w3.org/1999/xhtml','body');g.style.fontSize=(n['font-size']||15)*u+'px',g.style.margin=5*u+'px',g.style.height=10*(n.height*u)+'px',h.appendChild(g),g.appendChild(r),p.appendChild(h);var m=n.height/15;if(s.setAttribute('transform','translate('+e*u+','+(t+20)*u+') scale('+m+')'),s.setHeight=v,!n.align){var _=parseFloat(this.getAttribute('viewBox').split(/\s+/)[2]);(e+10+.5*n.width)*u>_&&(n.align='right'),0>(e-.5*n.width)*u&&(n.align='left')}if(n.align){var f='right'==n.align?-.5:.5;o.setAttribute('transform','translate('+f*n.width*u+',0)'),d.setAttribute('transform','translate('+f*n.width*u+',0)'),l.setAttribute('transform','translate('+0*f*n.width*u+',0)'),l.setAttribute('points',0<f?'0,500 500,1000 0,1000':'0,500 0,1000 -500,1000'),p.setAttribute('transform','translate('+f*n.width*u+',0)')}return s.setAttribute('height',n.height*u),s},l.growingMarker=function(e,t,r,n){var s=document.createElementNS(c,'svg');n.stretch||Array.isArray&&Array.isArray(n.content)?s=this.group():(s.setAttribute('viewBox','-50 -100 200 250'),s.setAttribute('preserveAspectRatio','xMinYMin meet')),s.setAttribute('x',e),s.setAttribute('y',t);var o=this.marker(50/u,50/u,50/u,r,n);s.appendChild(o),s.contentElement=o.contentElement;var d=this.group(),l=this.group();return d.appendChild(l),l.appendChild(s),n.stretch||Array.isArray&&Array.isArray(n.content)||(s.setAttribute('width','200'),s.setAttribute('height','250')),n.angle&&(d.angle=n.angle),d.setAttribute('height','250'),d.setAttribute('transform','scale(1)'),d.setHeight=function(e){v.call(this,e);this.setAttribute('height',e);var t=this.offset||0;this.angle||(this.angle=0),this.firstChild.setAttribute('transform','translate(-100,'+t*u+') rotate('+this.angle+',100,0)')},d.container=s,d},l.marker=function(e,t,n,o,c){var p=0;if('string'==typeof e){var h=new RegExp(/(\d+)(.*)/g).exec(e);p=h[2],e=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(t),t=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(n),n=parseFloat(h[1])}var g={CX:e+p,CY:t+p,R:n+p,MIN_X:e-n+p,MAX_X:e+n+p,MIN_Y:t-n+p,MAX_Y:t+n+p,MID_X1:e-n/2+p,MID_X2:e+n/2+p,MID_Y1:t-n/2+p,MID_Y2:t+n/2+p},m=this.group();c||(c={});var _=c&&c.border?c.border:'rgb(0,0,0)';if(!c.bare_element)if(c.width)m.push(this.roundRect(-.5*c.width-1,-.5,c.width+2,3,1.5)),m.lastChild.setAttribute('fill',_);else{m.push(this.circle(0,-.5*n,n)),m.lastChild.setAttribute('fill',_),m.lastChild.setAttribute('border','true'),m.push(this.circle(0,1.5*n,n)),m.lastChild.setAttribute('fill',_),m.lastChild.setAttribute('border','true');var f=this.poly(-.9*n*u+','+0*n*u+' 0,'+-2.5*n*u+' '+.9*n*u+','+0*n*u);f.setAttribute('fill',_),f.setAttribute('stroke-width','0'),m.push(f),m.lastChild.setAttribute('border','true')}if(m.setAttribute('transform','translate('+e*u+','+.5*t*u+') scale(1)'),m.setHeight=v,m.setAttribute('height',g.R*u),'string'==typeof o)o.match(/^(:?https?:)?\/?.*#/)?(m.contentElement=this.use(o,-n,0,2*n,2*n),m.contentElement.setAttribute('content','true')):(m.contentElement=this.text_circle(0,0,2*n,o,c),m.contentElement.firstChild.setAttribute('content','true')),m.push(m.contentElement);else if(Array.isArray&&Array.isArray(o)){m.contentElement=this.group();var y=s/o.length,b=c.stretch,x=2;o.forEach(function(e,t){var r=t%x,s=2+d(t/x);r*=2*n,s*=2*n,r-=.5*n;var p=180*t/o.length;p-=0,p=0,b&&(c.stretch=-90<=p&&90>=p?'right':'left',0==p%90&&90!=p&&-90!=p&&(0==p&&(c.stretch='right'),1==o.length&&(c.stretch=!0))),90<p&&270>p&&(p=180+p);let h=null;if(e.match(/^(:?https?:)?\/?.*#/))h=l.use(e,(r-.5)*n,(s-.5)*n,2*n,2*n),h.setAttribute('pointer-events','none'),h.setAttribute('content','true');else{var g=JSON.parse(JSON.stringify(c));g.no_tracer=!0,delete g.offset,delete g.height,h=l.text_circle(r*n,s*n,1.75*n,e,g),h.firstChild.setAttribute('content','true')}var _=h.getAttribute('transform')||'';_=_+' rotate('+p+','+0*n*u+','+s*n*u+')',h.setAttribute('transform',_),m.contentElement.push(h)}),m.push(m.contentElement)}else m.contentElement=this.group(),c.bare_element||(m.contentElement.push(this.text_circle(0,.5*n,1.75*n,'',c)),m.contentElement.lastChild.firstChild.setAttribute('content','true')),o&&(!c.bare_element&&o.setAttribute('transform','translate(0,'+.5*n*u+')'),o.setAttribute('content','true'),m.contentElement.push(o)),m.push(m.contentElement);return m.setAttribute('marker','true'),m},l.text_circle=function(e,t,n,r,s){s||(s={});var o=0;if('string'==typeof e){var d=new RegExp(/(\d+)(.*)/g).exec(e);o=d[2],e=parseFloat(d[1]),d=new RegExp(/(\d+)(.*)/g).exec(t),t=parseFloat(d[1]),d=new RegExp(/(\d+)(.*)/g).exec(n),n=parseFloat(d[1])}var l={CX:e+o,CY:t+o,R:n+o,MIN_X:e-n+o,MAX_X:e+n+o,MIN_Y:t-n+o,MAX_Y:t+n+o,MID_X1:e-n/2+o,MID_X2:e+n/2+o,MID_Y1:t-n/2+o,MID_Y2:t+n/2+o},c=this.group(),p=this.text(0,l.CY,r);p.setAttribute('font-size',10*u),p.setAttribute('font-weight',s.weight||'bolder'),p.setAttribute('fill',s.text_fill||'#ffffff'),p.setAttribute('style','font-family: sans-serif; text-anchor: middle;'),p.firstChild.setAttribute('dy','0.35em'),p.setAttribute('text-anchor','middle');var h;if(!s.stretch)h=this.circle(0,l.CY,9/10*l.R);else{var g=1.2*(s.font_size||n)*p.getBBox().width/(10*u),m=3/2*l.R,_=-.5*g;g>3*l.R?(_=-.5*g,'right'==s.stretch&&(_=-.1*g),'left'==s.stretch&&(_=-.9*g)):(g=3*l.R,_=-.5*g),p.setAttribute('x',(.5*g+_)*u),h=this.roundRect(_,l.CY-.5*m,g,m,{x:.5*l.R,y:.5*m},{})}return p.setAttribute('font-size',(s.font_size||n)*u),h.setAttribute('fill',s.fill||'url(#simple_gradient)'),window.matchMedia('print').addListener(function(e){h.setAttribute('fill',e.matches?'#aaaaaa':s.fill||'url(#simple_gradient)')}),h.setAttribute('stroke',s.border||'#000000'),h.setAttribute('stroke-width',n/10*u),c.push(h),c.push(p),c.setAttribute('transform','translate('+l.CX*u+', 1) scale(1)'),c.setAttribute('height',l.R/2*u),c.setHeight=v,c},l.crossed_circle=function(e,t,n){var r=0;if('string'==typeof e){var s=new RegExp(/(\d+)(.*)/g).exec(e);r=s[2],e=parseFloat(s[1]),s=new RegExp(/(\d+)(.*)/g).exec(t),t=parseFloat(s[1]),s=new RegExp(/(\d+)(.*)/g).exec(n),n=parseFloat(s[1])}var o={CX:e+r,CY:t+r,R:n+r,MIN_X:e-n+r,MAX_X:e+n+r,MIN_Y:t-n+r,MAX_Y:t+n+r,MID_X1:e-n/2+r,MID_X2:e+n/2+r,MID_Y1:t-n/2+r,MID_Y2:t+n/2+r},d=this.group(),l=this.circle(o.CX,o.CY,o.R);l.setAttribute('fill','#000000'),l.setAttribute('stroke','#ffffff'),l.setAttribute('stroke-width','2'),d._button=l,d.push(l);var c=this.line(o.MID_X1,o.MID_Y1,o.MID_X2,o.MID_Y2);c.setAttribute('stroke','#ffffff'),c.setAttribute('stroke-width','2'),d.push(c);var u=c,c=this.line(o.MID_X1,o.MID_Y2,o.MID_X2,o.MID_Y1);return c.setAttribute('stroke','#ffffff'),c.setAttribute('stroke-width','2'),d.push(c),d.move=function(e,t){l.setAttribute('cx',e),o.MID_X1=e-n/2,o.MID_X2=e+n/2,o.MID_Y1=t-n/2,o.MID_Y2=t+n/2,u.setAttribute('x1',o.MID_X1),u.setAttribute('y1',o.MID_Y1),u.setAttribute('x2',o.MID_X2),u.setAttribute('y2',o.MID_Y2),c.setAttribute('x1',o.MID_X1),c.setAttribute('y1',o.MID_Y2),c.setAttribute('x2',o.MID_X2),c.setAttribute('y2',o.MID_Y1)},d},l.text=function(e,t,r){var n=document.createElementNS(c,'text'),s=document.createElementNS(c,'tspan');return'string'==typeof r?(n.appendChild(s),s.textContent=r,s.setAttribute('dy','0')):n.appendChild(r),n.style.fontFamily=this.font_order||'Helvetica, Verdana, Arial, Sans-serif',n.setAttribute('x','string'==typeof e?e:e*u),n.setAttribute('y','string'==typeof t?t:t*u),n.move=function(e){if('undefined'!=typeof this.offset&&this.getAttribute('transform')){var t=this.getAttribute('transform'),r=/translate\(.*[,\s](.*)\)/.exec(t);r[1]&&this.setAttribute('transform','translate('+e*u+','+r[1]+')')}else this.setAttribute('x',e*u)},this.appendChild(n),n},l.plus=function(e,r,n){var s=this.group();return s.appendChild(this.makeEl('rect',{x:t(.4*n*u).toString(),y:t(.1*n*u).toString(),"stroke-width":'1',width:t(.2*n*u).toString(),height:t(.8*n*u).toString(),stroke:'#ffffff',fill:'#ffffff'})),s.appendChild(this.makeEl('rect',{x:t(.1*n*u).toString(),y:t(.4*n*u).toString(),"stroke-width":'1',width:t(.8*n*u).toString(),height:t(.2*n*u).toString(),stroke:'#ffffff',fill:'#ffffff'})),s.setAttribute('transform','translate('+e*u+','+r*u+')'),s},l.minus=function(e,r,n){var s=this.group();return s.appendChild(this.makeEl('rect',{x:t(.1*n*u).toString(),y:t(.4*n*u).toString(),"stroke-width":'1',width:t(.8*n*u).toString(),height:t(.2*n*u).toString(),stroke:'#ffffff',fill:'#ffffff'})),s.setAttribute('transform','translate('+e*u+','+r*u+')'),s},l.transformedBoundingBox=function(e){var t=e.getBBox(),r=e.ownerSVGElement,s=e.parentNode.getScreenCTM().inverse().multiply(e.getScreenCTM()).inverse(),d=[r.createSVGPoint(),r.createSVGPoint(),r.createSVGPoint(),r.createSVGPoint()];d[0].x=t.x,d[0].y=t.y,d[1].x=t.x+t.width,d[1].y=t.y,d[2].x=t.x+t.width,d[2].y=t.y+t.height,d[3].x=t.x,d[3].y=t.y+t.height;var l=Infinity,c=-Infinity,u=Infinity,p=-Infinity;d.forEach(function(e){e=e.matrixTransform(s),l=o(l,e.x),c=n(c,e.x),u=o(u,e.y),p=n(p,e.y)});try{t.x=l,t.width=c-l,t.y=u,t.height=p-u}catch(r){t={x:l,y:u,width:c-l,height:p-u}}return t},l.set=function(){var t=[];return e(t,u),t},l.hide=function(){this.setAttribute('display','none')},l.show=function(){this.setAttribute('display','inline')}}}();t.a=c},function(e,t,r){'use strict';var n=Math.abs,s=r(21),o=r(0);const d=function(){this.oX=0,this.oY=0,this.dX=0,this.dY=0,this.dragging=!1,this.targetElement=null};d.prototype.applyToElement=function(t,e){var r=this;'undefined'!=typeof e&&(r.enabled=e);var s=[];'svg'==t.nodeName?(t.getPosition=function(){var e=t.currentTranslateCache||t.currentTranslate,r=e.x,n=e.y;return[r,n]},t.shiftPosition=function(e,s){var d={x:e,y:s},l=1,c=this.getAttribute('viewBox'),u,p,h,g;if(c){var m=this.getAttribute('viewBox').split(' ');l=parseFloat(this.width.baseVal.value)/parseFloat(m[2]),u=0,p=parseInt(m[1],10),h=parseInt(m[2],10),g=parseInt(m[3],10)}else u=0,p=0,h=t.width,g=t.height;if(t.style.GomapScrollLeftMargin&&(u+=t.style.GomapScrollLeftMargin),r.dragging&&(d.x=l*(d.x-r.oX),d.y=l*(d.y-r.oY),d.x+=r.dX,d.y+=r.dY,d.y=0),t._snapback&&(clearTimeout(t._snapback),t._snapback=null),d.x>l*u&&r.enabled){let e=function e(){var s=t.currentTranslateCache||t.currentTranslate,d;if(35<n(s.x-l*u)){var c=.95*(s.x-l*u);if(c<l*u&&(c=l*u),t.setCurrentTranslateXY(c,0),window.requestAnimationFrame(e,t),document.createEvent){var d=document.createEvent('Events');d.initEvent('panstart',!1,!0),t.dispatchEvent(d)}}else{if(t.setCurrentTranslateXY(l*u,0),document.createEvent){var d=document.createEvent('Events');d.initEvent('pan',!1,!0),t.dispatchEvent(d)}r.dragging||o.a.fire(t,'panend'),t._snapback=null}};t._snapback=setTimeout(e,300)}var _=l*(h-2*u);if(0===u&&(_*=.9),0>d.x&&n(d.x)>_&&r.enabled){let e=function e(){var s=t.currentTranslateCache||t.currentTranslate,d;if(35<n(s.x- -1*_)){var l=.95*s.x;l>-1*_&&(l=-1*_),t.setCurrentTranslateXY(l,0),window.requestAnimationFrame(e,t),document.createEvent&&(d=document.createEvent('Events'),d.initEvent('panstart',!1,!0),t.dispatchEvent(d))}else t.setCurrentTranslateXY(-1*_,0),document.createEvent&&(d=document.createEvent('Events'),d.initEvent('pan',!1,!0),t.dispatchEvent(d)),r.dragging||o.a.fire(t,'panend'),t._snapback=null};t._snapback=setTimeout(e,300)}if(d.y>l*p&&(d.y=l*p),n(d.y)>.5*l*g&&(d.y=-.5*l*g),this.setCurrentTranslateXY?this.setCurrentTranslateXY(d.x,d.y):this.currentTranslate.setXY?this.currentTranslate.setXY(d.x,d.y):(this.currentTranslate.x=d.x,this.currentTranslate.y=d.y),document.createEvent){var f=document.createEvent('Events');f.initEvent('pan',!1,!0),this.dispatchEvent(f)}}):(t.getPosition=function(){return[this.scrollLeft,this.scrollTop]},t.shiftPosition=function(e,t){if(this.scrollLeft=r.dX+(r.oX-e),this.scrollTop=r.dY+(r.oY-t),document.createEvent){var n=document.createEvent('Events');n.initEvent('pan',!1,!0),this.dispatchEvent(n)}});var d=function(e){var t=0,n=0;return e||(e=window.event),e.pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),r.targetElement&&(t=e.screenX,n=e.screenY),[t,n]},l=function(e){var n=d(e);if(r.targetElement)return r.targetElement.shiftPosition(n[0],n[1]),void(r.moved=!0);var s=t._cachedpoint||t.createSVGPoint();t._cachedpoint=s,n=d(e),s.x=n[0],s.y=n[1];var o=t._cachedrctm||t.firstElementChild.getScreenCTM();t._cachedrctm=o,s=s.matrixTransform(r.matrix),t.shiftPosition(s.x,s.y),r.moved=!0},c=function e(t){t.stopPropagation(),this.removeEventListener('click',e,!0)},u=function(e){if(r.clicktimeout&&(clearTimeout(r.clicktimeout),r.clicktimeout=null),!r.enabled)return!0;r.oX=0,r.oY=0,r.dX=null,r.dY=null,r.dragging=!1,e.preventDefault(!0);var n=r.targetElement?r.targetElement:t;n.removeAttribute('dragging'),n._snapback||o.a.fire(n,'panend',!0),'mouseup'==e.type&&r.moved&&n.addEventListener('click',c,!0),r.moved=!1},p=function(t){if(!r.dragging||!r.enabled)return!0;if(this==r.targetElement&&u(t),t.target==this||t.currentTarget){for(var e=t.relatedTarget?t.relatedTarget:t.toElement;null!==e;){if(e==this)return;e=e.parentNode}u(t)}};t.addEventListener||(t.addEventListener=function(e,t){this.attachEvent(e,t)}),t.addEventListener('touchstart',function(n){if(r.enabled){var e=r.targetElement?r.targetElement:t;if(r.momentum&&(window.clearTimeout(r.momentum),r.momentum=null),1==n.touches.length){var o=d(n.touches[0]),l;if('svg'==e.nodeName){l=e.createSVGPoint(),l.x=o[0],l.y=o[1];var c=this.getScreenCTM();r.matrix=c.inverse(),l=l.matrixTransform(r.matrix)}else l.x=o[0],l.y=o[1];if(r.oX=l.x,r.oY=l.y,r.dragging=!0,r.dX=e.getPosition()[0],r.dY=e.getPosition()[1],r._momentum_shrinker=setInterval(function(){s.shift()},20),document.createEvent){var u=document.createEvent('Events');u.initEvent('panstart',!1,!0),e.dispatchEvent(u)}n.preventDefault()}}},!1),t.addEventListener('touchmove',function(o){if(!r.drag_zoom){r.momentum&&(window.clearTimeout(r.momentum),r.momentum=null),1!=o.touches.length&&(r.dragging=!1);var e=r.targetElement?r.targetElement:t,l=d(o.touches[0]);if(l&&r.matrix){var c;return'svg'==e.nodeName?(c=e.createSVGPoint(),c.x=l[0],c.y=l[1],c=c.matrixTransform(r.matrix)):(c.x=l[0],c.y=l[1]),r.dragging&&6*n(r.oX-c.x)>n(r.oY-c.y),r.dragging?void(3<s.length&&s.splice(2),e.shiftPosition(c.x,c.y),s.push(e.getPosition()[0]-r.dX)):(r.oX=0,r.oY=0,r.dX=null,void(r.dY=null))}}},{passive:!0});t.addEventListener('touchend',function(o){if(!r.enabled)return!0;if(!r.dragging)return clearInterval(r._momentum_shrinker),void u(o);var e=r.targetElement?r.targetElement:t,d=0;if(0<s.length){var l=s[0];s.forEach(function(e){'undefined'!=typeof l&&(d+=e-l),l=e}),d/=s.length}var c=e.getPosition()[0],p=d;r.dragging=!1,r.momentum&&window.clearTimeout(r.momentum),r.momentum=1;let h=function t(){c=e.getPosition()[0],r.dragging?c+=r.oX-r.dX:(r.oX=0,r.dX=0),e.shiftPosition(c+d,0),c+=d,d*=.5,0<d&&10>n(p/d)?window.requestAnimationFrame(t,e):(r.momentum=null,clearInterval(r._momentum_shrinker),u(o))};h()},!1),'svg'==t.nodeName?(t.addEventListener('mousedown',function(e){if(!r.enabled)return!0;var n=r.targetElement?r.targetElement:t,s=d(e);if(r.dragging=!0,r.moved=!1,n.setAttribute('dragging','true'),r.targetElement)return r.oX=s[0],r.oY=s[1],r.dX=r.targetElement.scrollLeft,r.dY=r.targetElement.scrollTop,void e.preventDefault(!0);var o=t.createSVGPoint();s=d(e),o.x=s[0],o.y=s[1];var l=this.firstElementChild.getScreenCTM();r.matrix=l.inverse(),o=o.matrixTransform(r.matrix),r.dX=t.getPosition()[0],r.dY=t.getPosition()[1],r.oX=o.x,r.oY=o.y,e.preventDefault(!0),document.createEvent&&(r.clicktimeout=setTimeout(function(){var e=document.createEvent('Events');r.clicktimeout=null,e.initEvent('panstart',!1,!0),n.dispatchEvent(e)},200))},!1),t.addEventListener('mousemove',function(e){return!r.enabled||void(!r.dragging||l.call(this,e))},!1),t.addEventListener('mouseup',u,!1),t.addEventListener('mouseout',p,!1),r.targetElement&&r.targetElement.addEventListener('mouseout',p,!1)):(t.addEventListener('mousedown',function(e){r.dragging=!0,r.moved=!1;var n=d(e);r.oX=n[0],r.oY=n[1],r.dX=t.getPosition()[0],r.dY=t.getPosition()[1],e.preventDefault(!0);var s=r.targetElement?r.targetElement:t;if(s.setAttribute('dragging','true'),document.createEvent){var o=document.createEvent('Events');o.initEvent('panstart',!1,!0),s.dispatchEvent(o)}},!1),t.addEventListener('mousemove',function(e){var s=d(e);r.clicktimeout&&10>n(s[0]-r.oX)&&u();r.dragging&&(t.shiftPosition(s[0],s[1]),e.preventDefault(!0))},!1),t.addEventListener('mouseup',u,!1),t.addEventListener('mouseout',p,!1))},d.addTouchZoomControls=function(e,t,r){return r||(r={enabled:!0}),d.prototype.addTouchZoomControls.call(r,e,t),r},d.prototype.addTouchZoomControls=function(t,r){var n=this,s=null,e=null,d=null,l=function(e){var t=0,r=0;return e||(e=window.event),e.pageX||e.pageY?(t=e.pageX,r=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),n.targetElement&&(t=e.screenX,r=e.screenY),[t,r]},c=function(s){if(n.enabled&&n.drag_zoom&&1==s.touches.length){var o=l(s.touches[0]),c={};c.x=o[0],c.y=o[1],'svg'==r.nodeName&&(c=r.createSVGPoint(),c.x=o[0],c.y=o[1],c=c.matrixTransform(e)),t.zoom=n.zoom_start*Math.pow(10,(c.y-t.zoomCenter.y)/d)}},u=function e(){r.removeEventListener('touchmove',c),r.removeEventListener('touchend',e),n.drag_zoom=!1};r.addEventListener('touchstart',function(o){if(n.enabled){if(1==o.touches.length){if(300>=new Date().getTime()-s){n.drag_zoom=!0,n.zoom_start=t.zoom;var h=l(o.touches[0]),g=l(o.touches[0]),m;if('svg'==r.nodeName){m=r.createSVGPoint(),m.x=.5*(h[0]+g[0]),m.y=.5*(h[1]+g[1]);var p=this.getScreenCTM();e=p.inverse(),m=m.matrixTransform(e),d=parseInt(r.getAttribute('viewBox').split(' ')[3])}else m.x=.5*(h[0]+g[0]),m.y=.5*(h[1]+g[1]);return t.zoomCenter=m,r.addEventListener('touchmove',c,{passive:!0}),r.addEventListener('touchend',u,!1),void o.preventDefault()}return void(s=new Date().getTime())}if(2==o.touches.length){var h=l(o.touches[0]),g=l(o.touches[1]),m;if('svg'==r.nodeName){m=r.createSVGPoint(),m.x=.5*(h[0]+g[0]),m.y=.5*(h[1]+g[1]);var p=this.getScreenCTM();n.matrix=p.inverse(),m=m.matrixTransform(n.matrix)}else m.x=.5*(h[0]+g[0]),m.y=.5*(h[1]+g[1]);t.zoomCenter=m,o.preventDefault()}}},!1),Hammer(r).on('touch',function(s){if(n.enabled){var e=t.zoom,d=function(r){t.zoomCenter&&(t.zoom=e*r.gesture.scale),r.preventDefault()};Hammer(r).on('pinch',d,!1);Hammer(r).on('release',function e(){Hammer(r).off('pinch',d),Hammer(r).off('release',e),t.zoomCenter=null,t.zoomLeft=null,o.a.fire(t,'gestureend')},!1),s.preventDefault()}},!1)},d.addZoomControls=function(e,t,r,n,s){t=t||0,r=r||10,n=n||.5,s=s||e.zoom||t;var o=document.createElement('div'),d=document.createElement('input');d.setAttribute('type','button'),d.setAttribute('value','+');var l=document.createElement('input');l.setAttribute('type','button'),l.setAttribute('value','-');var c=document.createElement('input');c.setAttribute('type','button'),c.setAttribute('value','Reset'),o.appendChild(c),c.addEventListener('click',function(){e.zoom=e.defaultZoom||s},!1);var u=document.createElement('input');if(u.setAttribute('min',t),u.setAttribute('max',r),u.setAttribute('step',n),u.setAttribute('value',s),u.setAttribute('type','range'),u.setAttribute('style','-webkit-appearance: slider-horizontal; width: 100%; position: absolute; top: 0px; bottom: 0px; margin-top: 0.5em; left: 100%; margin-left: -0.5em;'),'range'==u.type){u.addEventListener('change',function(){e.zoom=this.value},!1);var p=null;e.addEventListener?p=e.addEventListener:e.bind&&(p=e.bind),p.apply(e,['zoomChange',function(){u.value=e.zoom},!1]),c.style.margin='0px',c.style.display='block',c.style.position='absolute',c.style.top='0px',o.appendChild(u),o.style.height='100%'}else{if(!d.addEventListener){var h=function(e,t){this.attachEvent(e,t)};d.addEventListener=h,c.addEventListener=h,l.addEventListener=h}d.addEventListener('click',function(){e.zoom+=n},!1),l.addEventListener('click',function(){e.zoom-=n},!1),d.style.margin='0px',d.style.display='block',d.style.position='absolute',d.style.top='0px',d.style.left='29px',l.style.margin='0px',l.style.display='block',l.style.position='absolute',l.style.top='0px',c.style.margin='0px',c.style.display='block',c.style.position='absolute',c.style.top='23px',c.style.left='3px',o.appendChild(l),o.appendChild(d),o.appendChild(c)}return this.addScrollZoomControls(e,o,n),o},d.addScrollBar=function(e,t,r){var n=!1;var s=function(){if(!n&&console){if(document.createEvent){var s=document.createEvent('Events');s.initEvent('panstart',!1,!0),t.dispatchEvent(s)}var d=100*e.getTotalLength()/e.getVisibleLength(),l=scroller.cached_width?parseInt(scroller.cached_width*d):scroller.clientWidth;e.setLeftPosition(parseInt(r.scrollLeft*e.getTotalLength()/l)),o.a.fire(t,'panend')}};var d},d.addScrollZoomControls=function(t,e,r){r=r||.5;var s=null===this.enabled?{enabled:!0}:this;var o=function(e,t,r){'string'==typeof e&&(e=document.getElementById(e)),null===e||(e.addEventListener?('mousewheel'==t&&(e.addEventListener('DOMMouseScroll',r,!1),e.addEventListener('wheel',r,!1)),e.addEventListener(t,r,!1)):e.attachEvent&&e.attachEvent('on'+t,r))},d=function(t){if(s.enabled){var r=0,n=0;t||(t=window.event),t.pageX||t.pageY?(r=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(r=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var o={};if('svg'==e.nodeName){o=e.createSVGPoint(),o.x=r,o.y=n;var d=e.firstElementChild.getScreenCTM();s.matrix=d.inverse(),o=o.matrixTransform(s.matrix)}else o.x=r,o.y=n;return o}},l=function(n){if(s.enabled){n=n?n:window.event;var e=n.detail?-1*n.detail:n.wheelDelta;return e||(e=n.deltaY),t.zoomCenter=d(n),t.zoom=0<e?t.zoom+=r:t.zoom-=r,n.preventDefault&&n.preventDefault(),n.returnValue=!1,n.stopPropagation(),!1}},c=!1;return 0<=navigator.userAgent.indexOf('Gecko')&&(c=parseFloat(navigator.userAgent.split('Firefox/')[1])||void 0),c&&'undefined'!=typeof svgweb&&'native'==svgweb.getHandlerType()?o(e,'mousewheel',l):o(e,'mousewheel',l),o(e,'mousemove',function(r){!s.enabled||t.zoomCenter&&100<n(t.zoomCenter.x-d(r).x)&&(t.zoomCenter=null,t.zoomLeft=null)}),s},t.a=d},function(e,t,r){e.exports=r(15)},function(e,t,r){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=r(16),s=r(4);const o=function(e){return s.a.GatorDataReader.authenticate().then(function(){let t=new s.a.UniprotReader;return new Promise((r)=>{t.retrieve(e,function(){r(this.result._raw_data.data[0])})})})},d=new Promise((e,t)=>{HTMLWidgets.shinyMode?$(document).on('shiny:sessioninitialized',e):t()}),l=function(e,t){HTMLWidgets.shinyMode&&Shiny.setInputValue('sequenceChange',t,{priority:'event'})},c=function(e,t){return o(t).then((r)=>{let n=e.querySelector('x-protviewer');return n.uniprot=t,new Promise((s)=>{let o=()=>{n.renderer.unbind('sequenceChange',o),n.refreshTracks(),n.fitToZoom();for(let e of n.querySelectorAll('x-gatortrack'))e.setAttribute('scale',t);d.then(()=>{l(e,r)}),s()};n.renderer.bind('sequenceChange',o),n.renderer.setSequence(r)})})},u=document.createElement('template');u.innerHTML=`
<x-protviewer id="protview" interactive>
    <x-gatortrack name="domains" fullname="Domains" scale="uniprot" ></x-gatortrack>
    <x-gatortrack name="ptms" fullname="PTMS" scale="uniprot" ></x-gatortrack>
    <x-gatortrack name="data" fullname="Data" scale="uniprot" ></x-gatortrack>
</x-protviewer>
<x-trackrenderer track="domains" renderer="protview"></x-trackrenderer>
<x-trackrenderer track="ptms" renderer="protview"></x-trackrenderer>
<x-trackrenderer track="data" renderer="protview"></x-trackrenderer>
`;const p=(e,t)=>Object(n.a)('glycodomain',t).then((t)=>{e.querySelector('x-trackrenderer[track="domains"]').data=t._raw_data.data}),h=(e,t)=>Object(n.a)('combined',t).then((t)=>{e.querySelector('x-trackrenderer[track="ptms"]').data=t._raw_data.data}),g=function(e){console.log('Pan listener',e);let t=e.renderer.leftVisibleResidue(),r=e.renderer.rightVisibleResidue();HTMLWidgets.shinyMode&&Shiny.setInputValue('pan',{left:t,right:r},{priority:'event'})},m=function(e){let t=g.bind(null,e);return e.addEventListener('pandone',t),e.renderer.bind('zoomChange',t),t},_={setUniprot:(e,t)=>{let r=t.uniprot.toUpperCase();return c(e,r).then(()=>{p(e,r),h(e,r)})},showRange:(e,t)=>{let r=e.querySelector('x-protviewer');r.removeEventListener('pandone',r.pan_listener),r.renderer.unbind('zoomChange',r.pan_listener),e.querySelector('x-protviewer').renderer.showResidues(t.min,t.max).then(()=>{r.pan_listener=m(r)})},showData:(e,t)=>{e.querySelector('x-trackrenderer[track="data"]').data=HTMLWidgets.dataframeToD3(t.dataframe)}};HTMLWidgets.widget({name:'SeqViewer',type:'output',factory:function(e){let t=null;return{renderValue:function(r){if(!t){let r=u.content.cloneNode(!0);e.appendChild(r),t=e.getElementsByTagName('x-protviewer').protview}let n=r.message;if(n.interactive?(t.setAttribute('interactive',''),t.removeAttribute('selecting')):t.removeAttribute('interactive'),!n.ptms){let t=e.querySelector('x-gatortrack[name="ptms"]');t.parentNode.removeChild(t)}if(!n.domains){let t=e.querySelector('x-gatortrack[name="domains"]');t.parentNode.removeChild(t)}if(e.querySelector('x-trackrenderer[track="domains"]').setAttribute('src',HTMLWidgets.getAttachmentUrl('renderers','glycodomain.packed')),e.querySelector('x-trackrenderer[track="ptms"]').setAttribute('src',HTMLWidgets.getAttachmentUrl('renderers','msdata.packed')),e.querySelector('x-trackrenderer[track="data"]').setAttribute('src',HTMLWidgets.getAttachmentUrl('renderers','customdata.packed')),HTMLWidgets.shinyMode){for(let e of Object.keys(_))Shiny.addCustomMessageHandler(`seqviewer:${e}`,(t)=>{var r=document.getElementById(t.id);r&&_[e](r,t)});t.pan_listener=m(t),console.log('Bound pan events')}let s=Promise.resolve();n.uniprot&&(s=_.setUniprot(e,n)),n.dataframe&&s.then(()=>_.showData(e,n))},resize:function(){}}}})},function(e,t,r){'use strict';r.d(t,'a',function(){return s});var n=r(4);n.a.GatorDataReader.anonymous=!0,n.a.GatorDataReader.server='https://glycodomain.glycomics.ku.dk',n.a.AUTH0_CLIENT_ID='fNED1UGvPaP0XlrcEvWsHXIODIKy6WVB',n.a.GATOR_CLIENT_ID=n.a.AUTH0_CLIENT_ID;let s=function(e,t){return n.a.GatorDataReader.authenticate().then(function(){let r=n.a.GatorDataReader.createReader(e);return r.datasetname=e,new Promise((e)=>{r.retrieve(t,function(){e(this.result)})})})},o=function(e){return n.a.GatorDataReader.authenticate().then(function(t){let r=new Headers;r.append('Authorization','Bearer '+n.a.GATOR_AUTH_TOKEN),r.append('x-api-key',n.a.GATOR_CLIENT_ID);let s=new Request(`${t}/metadata/${e}`,{method:'GET',headers:r});return fetch(s).then((e)=>e.json())})},d=(e,t)=>{let r=t._raw_data.data,n=e.locations;return n.forEach((e,t)=>e.expression=r[t]),n}},function(e,t,r){'use strict';var n=r(2),s=r(1),o=0,d=0,l,c,u,p,h,g,m,_,f,y,v;class b extends n.a{}b.BeginCaching=function(){b.CacheService(b.prototype)},b.SetMinimumAge=function(e){d=0===e?0:e.getTime()},b.SetMaximumAge=function(e){o=0===e?0:e.getTime()},b.SweepCache=function(e){e||(e=new Date),m(e.getTime())},b.CacheService=function(e){if(!(e.prototype&&e.prototype.retrieve.caching||e.retrieve.caching)){var t=e.retrieve,r;e.retrieve=function(e,n){var s=this,d=e?e:s.agi;return d?(d=d.toLowerCase(),s.agi=d,s.avoid_database)?r?void 0:(r=s._dataReceived,s._dataReceived=function(){return function(e){var t=r.call(this,e),n=s.agi;return t&&this.result&&null!==this.result._raw_data&&c(n,this.toString(),this.result._raw_data||{}),e={},t}}(),void n.call(s)):r&&!s.avoid_database?(s._dataReceived=r,r=null,void n.call(s)):(l(d,s.toString(),function(e,r){if(r){if(n){s.result=null;var l=function(e){bean.remove(s,'resultReceived',arguments.callee),bean.remove(s,'error',arguments.callee),n.call(s,e)};bean.add(s,'resultReceived',l),bean.add(s,'error',l)}var u=s._dataReceived(r,'db');u&&s.gotResult(),null===u?s.requestIncomplete():s.requestComplete()}else{var p=s._dataReceived;s._dataReceived=function(){return function(e,t){var r=p.call(this,e,t);return r&&this.result&&null!==this.result._raw_data&&c(d,this.toString(),this.result._raw_data||{}),this._dataReceived=null,this._dataReceived=p,e={},r}}();var h=s._endpointURL;0!==o&&(s._endpointURL=null),t.call(s,d,n),s._endpointURL=h}}),s):(t.call(s,d,n),s)},e.retrieve.caching=!0}},b.FindCachedService=function(e,t){var r=e.toString();return u(r,t),!0},b.CachedAgis=function(e,t){var r=e.toString();return _(r,t),!0},b.FirstAgi=function(e,t){var r=e.toString();return v(r,t),!0},b.ClearCache=function(e,t,r){var n=e.toString();return r||(r=function(){}),p(n,t,r),!0},b.HistoryForService=function(e,t){var r=e.toString();g(r,null,t)},b.Snapshot=function(e,t,r,n){var s=e.toString();get_snapshot(s,null,r,n)};var x=0,E=[];b.BulkOperation=function(e){x++;var t=function(e){e||(e=function(){}),x--,E.push(e),0==x&&y(function(e){E.forEach(function(t){t(e)}),E=[]})};return f(e,t),t};var A=function(e){var t=[],r;f=function(e,n){return null==r?(r=c,c=function(e,r,n){t.push([e,r,n])},setTimeout(function(){e.call({transaction:n})},0),!0):(setTimeout(function(){e.call({transaction:n})},0),!1)},y=function(n){if(null===r)return void n(null);c=r,r=null;var o=e.transaction(['cached'],'readwrite'),d=o.objectStore('cached');for(o.oncomplete=function(){n(null)},o.onerror=function(e){n(e.target.errorCode)};0<t.length;){var l=t.shift(),u=l[0],p=l[1],h=l[2];if(!('object'!=typeof h||'Object'!==h.constructor.name||'undefined'!=typeof Document&&h instanceof Document)){var g=h.retrieved?h.retrieved:new Date;('string'==typeof g||'number'==typeof g)&&(g=new Date(g)),g.setUTCHours(0),g.setUTCMinutes(0),g.setUTCSeconds(0),g.setUTCMilliseconds(0);var m=s(u,p),_=g.getTime();h.id=[u,p,_],h.acc=u,h.service=p,window.msIndexedDB&&(h.serviceacc=p+u),h.retrieved=_;var f=d.put(h);f.onerror=m}}};var s=function(){return function(e,t){}};c=function(t,r,n){var o=e.transaction(['cached'],'readwrite'),d=o.objectStore('cached');if(!('object'!=typeof n||'undefined'!=typeof Document&&n instanceof Document)){var l=n.retrieved?n.retrieved:new Date;('string'==typeof l||'number'==typeof l)&&(l=new Date(l)),l.setUTCHours(0),l.setUTCMinutes(0),l.setUTCSeconds(0),l.setUTCMilliseconds(0);var c=s(t,r),u=l.getTime();n.id=[t,r,u],n.acc=t,window.msIndexedDB&&(n.serviceacc=r+t),n.service=r,n.retrieved=u;var p=d.put(n);p.onerror=c}},l=function(e,t,r){var n=o?[d,o]:[d,new Date().getTime()];return h(e,t,n,r)},h=function(t,r,n,s){if(!t)return void s.call();var o=e.transaction(['cached'],'readonly'),d=o.objectStore('cached'),l=d.index(window.msIndexedDB?'entries-ms':'entries'),c=-1,u=null,p=IDBKeyRange.only(window.msIndexedDB?r+t:[t,r]);l.openCursor(p).onsuccess=function(e){var o=e.target.result;if(o){var d=window.msIndexedDB?o.value.retrieved:o.primaryKey[2],l=window.msIndexedDB?o.value.acc:o.primaryKey[0],p=window.msIndexedDB?o.value.service:o.primaryKey[1];d>=n[0]&&d<=n[1]&&d>c&&l==t&&p==r&&(u=o.value,c=d,u.retrieved=new Date(d)),o.continue()}else u,s.call(null,null,u)}},m=function(t){var r=e.transaction(['cached'],'readwrite'),n=r.objectStore('cached'),s=n.index('timestamps');s.openKeyCursor(null,'nextunique').onsuccess=function(e){var r=e.target.result;r&&(t>=r.key[1]&&n.delete(r.primaryKey),r.continue())}},g=function(t,r,n){r&&'object'==typeof r&&r.length||(r=[0,new Date().getTime()]);var s=e.transaction(['cached'],'readonly'),o=s.objectStore('cached'),d=o.index('timestamps'),l=[];d.openKeyCursor(null,'nextunique').onsuccess=function(e){var s=e.target.result;s?(s.key[0]==t&&r[0]<=s.key[1]&&r[1]>=s.key[1]&&l.push(new Date(parseInt(s.key[1]))),s.continue()):n.call(null,l)}},p=function(t,r,s){var o=e.transaction(['cached'],'readwrite'),d=o.objectStore('cached'),l=d.index('services'),c=IDBKeyRange.only(t);l.openCursor(c).onsuccess=function(e){var t=e.target.result;t&&((!r||t.value.acc==r)&&(window.msIndexedDB?d.delete(t.value.serviceacc):d.delete(t.value.id?t.value.id:t.primaryKey)),t.continue())},o.oncomplete=function(){s.call(n.a)}},u=function(t,r){var s=e.transaction(['cached'],'readonly'),o=s.objectStore('cached'),d=o.index('services'),l=[],c=IDBKeyRange.only(t);d.openKeyCursor(c,'nextunique').onsuccess=function(e){var t=e.target.result;t?(l.push(t.key),t.continue()):r.call(n.a,l)}},v=function(t,r){var s=e.transaction(['cached'],'readonly'),o=s.objectStore('cached'),d=o.index('services'),l=IDBKeyRange.only(t);d.openCursor(l,'nextunique').onsuccess=function(e){var t=e.target.result;t?r.call(n.a,t.value.acc):r.call(n.a,null)}},_=function(t,r){var s=e.transaction(['cached'],'readonly'),o=s.objectStore('cached'),d=o.index('services'),l=[],c=IDBKeyRange.only(t);d.openCursor(c).onsuccess=function(e){var t=e.target.result;t?(l.push(t.value.acc),t.continue()):r.call(n.a,l)}}},w=function(e){e.all('SELECT version from versions where tablename = "datacache"',function(t,r){var n=r&&0<r.length?r[0].version:null;return 1.3==n?(s.a.events&&s.a.events.emit('ready'),void(s.a.ready?(s.a.ready(),s.a.ready=!0):s.a.ready=!0)):void((!n||''==n||1>n)&&(e.exec('CREATE TABLE if not exists versions (version REAL, tablename TEXT);'),e.exec('CREATE TABLE if not exists "datacache" (agi TEXT,service TEXT,retrieved REAL,data TEXT);',function(e){if(e&&'Error: not an error'!=e)throw e}),e.exec('DELETE FROM versions where tablename = "datacache"'),e.exec('INSERT INTO versions(version,tablename) VALUES(1.1,"datacache");',function(e){}),n=1.1),1.2>n&&(e.exec('DROP TABLE if exists datacache_tmp;'),e.exec('CREATE TABLE if not exists datacache_tmp (acc TEXT,service TEXT,retrieved REAL,data TEXT);'),e.exec('INSERT INTO datacache_tmp(acc,service,retrieved,data) SELECT agi,service,retrieved,data FROM datacache;'),e.exec('DROP TABLE datacache;'),e.exec('ALTER TABLE datacache_tmp RENAME TO datacache;'),e.exec('CREATE INDEX accessions on datacache(acc);'),e.exec('CREATE INDEX accessions_service on datacache(acc,service);'),e.exec('DELETE FROM versions where tablename = "datacache"'),e.exec('INSERT INTO versions(version,tablename) VALUES(1.2,"datacache");',function(e){}),n=1.2),1.3>n&&(e.exec('CREATE INDEX if not exists services on datacache(service);'),e.exec('DELETE FROM versions where tablename = "datacache"'),e.exec('INSERT INTO versions(version,tablename) VALUES(1.3,"datacache");',function(e){e||(s.a.events&&s.a.events.emit('ready'),s.a.ready?(s.a.ready(),s.a.ready=!0):s.a.ready=!0)}),n=1.3))}),f=function(e,t){e.call({transaction:t})},y=function(e){e()},m=function(t){e.all('DELETE from datacache where retrieved <= ? ',[t],function(){})},p=function(t,r,s){var o=t;o+='%',r?e.all('DELETE from datacache where service like ? and acc = ?',[o,r.toLowerCase()],function(){s.call(n.a)}):e.all('DELETE from datacache where service like ? ',[o],function(){s.call(n.a)})},u=function(t,r){e.all('SELECT distinct service from datacache where service like ? ',[t+'%'],function(e,t){var s={};t&&0<t.length&&t.forEach(function(e){s[e.service]=!0});var o=[];for(var d in s)s.hasOwnProperty(d)&&o.push(d);return r.call(n.a,o),o})},v=function(t,r){e.all('SELECT distinct acc from datacache where service = ? limit 1',[t],function(e,t){!t||1>t.length?r.call(n.a,null):r.call(n.a,t[0].acc)})},_=function(t,r){e.all('SELECT distinct acc from datacache where service = ?',[t],function(e,t){for(var s=[],o=0;o<t.length;o++)s.push(t[o].acc);r.call(n.a,s)})},get_snapshot=function(t,r,n,s){r&&'object'==typeof r&&r.length||(r=[0,new Date().getTime()]);var o=[t,r[0],r[1]],d;if(n&&Array.isArray(n)){var l=Array(n.length+1).join(',?').substring(1);o=o.concat(n),d='SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? AND acc in ('+l+') ORDER BY retrieved ASC'}else n&&/^\d+$/.test(n.toString())?(d='SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? LIMIT ? ORDER BY retrieved ASC',o=o.concat(parseInt(n.toString()))):d='SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? ORDER BY retrieved ASC';e.all(d,o,function(e,t){t=t||[];var r={};t.forEach(function(e){var t='string'==typeof e.data?JSON.parse(e.data):e.data;t&&(t.retrieved=new Date(parseInt(e.retrieved)));r[e.acc]&&r[e.acc].retrieved>e.retrieved||(r[e.acc]=e)}),s.call(null,null,r)})},l=function(e,t,r){var n=o?[d,o]:[d,new Date().getTime()];return h(e,t,n,r)};var t=function(){return function(e,t){}};c=function(r,n,s){if(!('object'!=typeof s||'undefined'!=typeof Document&&s instanceof Document)){var o;try{o=JSON.stringify(s)}catch(e){return}var d=s.retrieved?s.retrieved:new Date;'string'==typeof d&&(d=new Date),d.setUTCHours(0),d.setUTCMinutes(0),d.setUTCSeconds(0),d.setUTCMilliseconds(0);var l=d.getTime();s={},e.all('INSERT INTO datacache(acc,service,retrieved,data) VALUES(?,?,?,?)',[r,n,l,o],t(r,n))}},h=function(t,r,n,s){var o=[t,r,n[0],n[1]];e.all('SELECT * from datacache where acc=? and service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved DESC LIMIT 1',o,function(e,t){if(t&&0<t.length&&'undefined'!=typeof t[0]){var r='string'==typeof t[0].data?JSON.parse(t[0].data):t[0].data;r&&(r.retrieved=new Date(parseInt(t[0].retrieved))),s.call(null,null,r)}else s.call(null,null,null)})},g=function(t,r,n){r&&'object'==typeof r&&r.length||(r=[0,new Date().getTime()]);var s=[t,r[0],r[1]];e.all('SELECT distinct retrieved from datacache where service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved ASC',s,function(e,t){var r=[];if(t&&0<t.length&&'undefined'!=typeof t[0])for(var s=t.length-1;0<=s;s--)r.push(new Date(parseInt(t[s].retrieved)));n.call(null,r)})}},T=function(){m=function(e){if('localStorage'in window){for(var t=[],r=0,n=localStorage.length;r<n;r++)t.push(localStorage.key(r));for(var s=t.shift();s;){if(/^MASCP.*/.test(s)){var o=localStorage[s];if(o&&'string'==typeof o){var d=JSON.parse(o);d.retrieved=e,localStorage.removeItem(s)}}s=t.shift()}}},p=function(e,t,r){if('localStorage'in window){for(var s=[],o=0,d=localStorage.length;o<d;o++)s.push(localStorage.key(o));for(var l=s.shift();l;){if(new RegExp('^'+e+'.*'+(t?'#'+t.toLowerCase()+'$':'')).test(l)&&(localStorage.removeItem(l),t))return;l=s.shift()}r.call(n.a)}},u=function(e,t){var r={};if('localStorage'in window)for(var n=new RegExp('^'+e+'.*'),s=0,o=localStorage.length,d;s<o;s++)d=localStorage.key(s),n.test(d)&&(r[d.replace(/\.#.*$/g,'')]=!0);var l=[];for(var c in r)r.hasOwnProperty(c)&&l.push(c);return t.call(b,l),l},v=function(e,t){if('localStorage'in window)for(var r=new RegExp('^'+e),n=0,s=localStorage.length,o;n<s;n++)if(o=localStorage.key(n),r.test(o))return o=o.replace(e,''),void t.call(b,o);t.call(b,null)},_=function(e,t){if('localStorage'in window)for(var r=new RegExp('^'+e),n=0,s=localStorage.length,o;n<s;n++)o=localStorage.key(n),r.test(o)&&(o=o.replace(e,''),results[o]=!0);var d=[];for(var l in results)results.hasOwnProperty(l)&&d.push(l);t.call(b,d)},l=function(e,t,r){var n=localStorage[t.toString()+'.#'+(e||'').toLowerCase()];if(n&&'string'==typeof n){var s=JSON.parse(n);s.retrieved=new Date(parseInt(s.retrieved)),r.call(null,null,s)}else r.call(null,null,null)},c=function(e,t,r){r&&('object'!=typeof r||r instanceof Document||r.nodeName)||(r.retrieved=new Date().getTime(),localStorage[t.toString()+'.#'+(e||'').toLowerCase()]=JSON.stringify(r))},h=function(e,t,r,n){return l(e,t,n)},g=function(e,t,r){r.call(null,[])},f=function(e){setTimeout(function(){e.call()},0)},y=function(e){setTimeout(function(){e()},0)},s.a.events&&s.a.events.emit('ready'),setTimeout(function(){s.a.ready?(s.a.ready(),s.a.ready=!0):s.a.ready=!0},100)},C,k;if('openDatabase'in window||'indexedDB'in window)if('indexedDB'in window){var S=function(e,t){var r=t.db;r.objectStoreNames&&r.objectStoreNames.contains('cached')&&r.deleteObjectStore('cached');var n=window.msIndexedDB?'serviceacc':'id',s=r.createObjectStore('cached',{keyPath:n});s.createIndex('entries',['acc','service'],{unique:!1}),window.msIndexedDB&&s.createIndex('entries-ms','serviceacc',{unique:!1}),s.createIndex('timestamps',['service','retrieved'],{unique:!1}),s.createIndex('services','service',{unique:!1}),t.oncomplete=function(){N(r),N=function(){}}};k=!0;var R=2,L=indexedDB.open('datacache',R);L.onupgradeneeded=function(t){var e=L.transaction;S(t.oldVersion,e)};var N=function(e){e&&(k=e),A(k),s.a.events&&s.a.events.emit('ready'),s.a.ready?(s.a.ready(),s.a.ready=!0):s.a.ready=!0};L.onerror=function(){console.log('Error loading Database'),T()},L.onsuccess=function(t){k=t.target.result;if(k.version!=+R){var e=C.setVersion(ver);e.onsuccess=function(){var t=e.result;S(oldVersion,t)}}else N()}}else{try{C=openDatabase('cached','','MASCP Gator cache',1048576)}catch(e){throw e}C.all=function(e,t,r){this.exec(e,t,r)},C.exec=function(e,t,r){var n=this,s=t,o=r;'undefined'==typeof o&&s&&'[object Array]'!=Object.prototype.toString.call(s)&&(o=t,s=null),n.transaction(function(t){t.executeSql(e,s,function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n));o&&o.call(C,null,r)},function(e,t){o&&o.call(C,t)})})}}'undefined'!=typeof k||('undefined'==typeof C?'localStorage'in window?T():(m=function(){},p=function(){},u=function(){},_=function(e,t){t.call(b,[])},l=function(e,t,r){r.call(null,null,null)},c=function(){},h=function(e,t,r,n){n.call(null,[])},g=function(e,t,r){r.call(null,[])},f=function(e,t){setTimeout(function(){e({transaction:t})},0)},y=function(e){setTimeout(function(){e()},0)}):w(C)),t.a=b},function(e,t,r){'use strict';var n=r(2),s=r(1),o=r(5),d=r(8),l=r(0),c=0<=['localhost','10.0.2.2'].indexOf(window.location.hostname)?'https://test.glycocode.com/api':'/api';const u=(e,t)=>{var r=t.metadata.mimetype;r&&(!e.samples&&(e.samples={}),t.data.forEach((e)=>{e.dataset=t.dataset,e.acc=t.acc,t.metadata.sample&&(e.species=t.metadata.sample.species)}),e.samples[t.dataset]=t.metadata.sample,e[r]=(e[r]||[]).concat(t.data))};const p=n.a.buildService(function(e){var t=this.datasetname||(e||{}).datasetname||'combined';if(!e||!e.data)return this;var r=e.data.filter(function(e){return 0<=e.dataset.indexOf(t)})[0]||{data:[]};if(1<t.split(',').length){t=t.split(',');var n={};e.data.filter((e)=>0<=t.indexOf(e.dataset)).forEach(u.bind(null,n)),r={data:n}}if('glycodomain'==t&&(r=e.data.filter(function(e){return'application/json+glycodomain'==e.metadata.mimetype})[0]||{data:[]},console.log(r)),'combined'==t||'homology'==t||'predictions'==t){var n={};e.data.forEach(u.bind(null,n)),r={data:n}}return'homology'==t&&(r.alignments=e.data.filter(function(e){return'homology_alignment'==e.dataset})[0].data),this._raw_data=r,this});p.prototype.requestData=function(){var e={type:'GET',dataType:'json',data:{}},t=(this._requestset||'combined')+'/'+(this.agi||this.acc).toLowerCase(),r='/'==(this._endpointURL||p.server).slice(-1)?this._endpointURL+t:this._endpointURL+'/'+t;return e.auth=s.a.GATOR_AUTH_TOKEN,e.api_key=s.a.GATOR_CLIENT_ID,e.session_cache=!0,e.url=r,e};var h;Object.defineProperty(p,'server',{get:function(){return c.replace('/api','')},set:function(e){c=e.replace('/$','')+'/api'}}),Object.defineProperty(p,'ID_TOKEN',{get:function(){return h},set:function(e){h=e,y=null,l.a.fire(p,'idtoken')}});var g;Object.defineProperty(p,'anonymous',{get:function(){return g},set:function(e){g=e,h=null,y=null}});var m=function(){return new Promise(function(e,t){n.a.request({url:c+'/login?cachebuster='+new Date().getTime(),type:'GET'},function(r,n){if(r)t(r);else{var s=JSON.parse(n);'string'==typeof s&&(s={id_token:s}),p.ID_TOKEN=s.id_token,e(c)}},!0)})},_=!0,f=function(e){var t=e.prototype.retrieve;e.prototype.retrieve=function(){console.log('Retrieve with auth retry');var e=[].slice.call(arguments),r=this;this.bind('error',function(t){401!=t.status&&403!=t.status||r.tried_auth||(r.unbind('error'),r.tried_auth=!0,_&&(delete s.a.GATOR_AUTH_TOKEN,p.ID_TOKEN=null,y=null,l.a.fire(p,'unauthorized'),_=!1),v().catch(function(e){throw console.log('Error after auth',e),e}).then(function(){_=!0,r.retrieve.apply(r,e)}).catch(function(e){console.log('Died on doing the reauth',e)}))}),t.apply(r,e)}},y;f(p),window.addEventListener('unhandledrejection',function(e){return e.reason&&'Unauthorized'==e.reason.message&&!e.reason.handled?(e.reason.handled=!0,void l.a.fire(p,'unauthorized')):void console.log(e)});var v=function e(){return y?y:(o.a.SERVICE_URL=c+'/tools/clustal',d.a.SERVICE_URL=c+'/data/latest/uniprot',d.a.reauthed||f(d.a),d.a.reauthed=!0,!p.ID_TOKEN&&p.anonymous)?(console.log('Doing an anonymous login'),y=m().then(function(){y=null}).then(e),y):p.ID_TOKEN||p.anonymous?(y=new Promise(function(e){setTimeout(function(){s.a.GATOR_AUTH_TOKEN=p.ID_TOKEN,l.a.fire(p,'auth',[c]),e(c)},0)}),y):(console.log('We cannot log in without an ID TOKEN, waiting for token'),y=new Promise(function(e,t){var r=function t(){console.log('Got a new ID token'),l.a.remove(p,'idtoken',t),s.a.GATOR_AUTH_TOKEN=p.ID_TOKEN,e(c)};l.a.add(p,'idtoken',r),setTimeout(function(){console.log('Timed out logging in'),t(new Error('Timed out'))},5e3)}),y)};p.prototype.setupSequenceRenderer=function(e){var t=this;'homology'!==this.datasetname||(e.forceTrackAccs=!0,e.addAxisScale('homology',function(e,r,n){return t.result&&t.agi!==r.name&&t.acc!==r.name?n?t.result.calculateSequencePositionFromPosition(t.agi||t.acc,r.name.toLowerCase(),e):t.result.calculatePositionForSequence(t.agi||t.acc,r.name.toLowerCase(),e):e}))},function(){var e=function(e){var t=[],r={},n;for(n in e)e.hasOwnProperty(n)&&-1<=parseInt(n)&&t.push(parseInt(n));t=t.sort(function(e,t){return e-t});for(var s=t.length-1,o;0<=s;s--){o=s-1,n=parseInt(t[s]);for(var d=e[n];0<=o;)n-=e[t[o]].length,o--;d.match(/^\s+$/)||(r[n+1]=d+(r[n+1]||''))}return r},t=function(e,t,r){for(var n=0,s;n<e.length;n++)s=e[n].toString(),'-'==s.charAt(t)?r[n]&&(r[n][t-1]=' ',(r[n][t]||'').match(/^\s+$/)&&(r[n][t-1]+=r[n][t],delete r[n][t])):(!r[n]&&(r[n]={},r[n][-1]=''),r[n][t-1]=s.charAt(t),r[n][t]&&r[n][t].match(/\w/)&&(r[n][t-1]+=r[n][t],delete r[n][t])),e[n]=s.slice(0,t)+s.slice(t+1)};p.Result.prototype.makeSequences=function(r,n){var s=[],o=[],d=[],l='';n.forEach(function(e){!e.cigar&&e.cigar_line&&(e.cigar=e.cigar_line,delete e.cigar_line),e.cigar.match(/^[\-\.]*$/)||(e.cigar=e.cigar.match(/\d*[MD]/g).map(function(e){return Array((parseInt(e.slice(0,-1))||1)+1).join('M'==e.slice(-1)?'.':'-')}).join('')),e.uniprot===r.toUpperCase()?l=e.cigar:(d.push(e.uniprot),s.push(e.cigar))});var c=l,u=c.length-1;for(u;0<=u;u--)'-'==c.charAt(u)&&t(s,u,o);for(u=0;u<s.length;u++)if(o[u]){o[u]=e(o[u]);var p=s[u];s[u]={sequence:p,insertions:o[u]},s[u].toString=function(){return this.sequence}}var h={};return d.forEach(function(e,t){h[e.toLowerCase()]=s[t]}),h[r.toLowerCase()]=l.replace('-',''),h}}(),p.Result.prototype.calculatePositionForSequence=function(e,t,r){if(e.toLowerCase()===t.toLowerCase())return r;this.sequences||(this.sequences=this.makeSequences(e,this._raw_data.alignments));for(var n=this.sequences[t.toLowerCase()].insertions||{},s=0,o=this.sequences[t.toLowerCase()].toString(),d=0;d<o.length;d++)if(n[d]&&(s+=n[d].length),s+=1,'-'==o.charAt(d)&&(s-=1),r<=s)return r==s?d+1:(0==d&&(d=1),-1*d);return-1*o.length},p.Result.prototype.calculateSequencePositionFromPosition=function(e,t,r){if(e.toLowerCase()===t.toLowerCase())return r;this.sequences||(this.sequences=this.makeSequences(e,this._raw_data.alignments));for(var n=this.sequences[t.toLowerCase()].insertions||{},s=0,o=this.sequences[t.toLowerCase()].toString(),d=0;d<r;d++)n[d]&&(s+=n[d].length),s+=1,'-'==o.charAt(d)&&(s-=1);return 0==s&&(s+=1),s};var b=p.Result;Object.defineProperty(p.prototype,'datasetname',{get:function(){return this._datasetname},set:function(e){this._datasetname=e,this._requestset='homology'===e?'homology':'combined';this.Result=class extends b{constructor(t){return t.datasetname=e,super(t),this}}}}),p.authenticate=function(){return v()};var x={},E=function e(t){var r=this,n=[].slice.call(arguments);return x[t+'-'+this._requestset]?void x[t+'-'+this._requestset].then(function(){p.prototype.retrieve.apply(r,n)}).catch(function(){v().then(function(){e.apply(r,n)})}):void(x[t+'-'+this._requestset]=new Promise(function(e,t){r.bind('resultReceived',e),r.once('error',t)}),x[t+'-'+this._requestset].catch(function(){v().then(function(){x[t+'-'+r._requestset]=null})}),p.prototype.retrieve.apply(r,n))};p.createReader=function(e){var t=new p(null,c+'/data/latest/');return console.log(e),t.datasetname=e,v().then(function(){t.retrieve=E,l.a.fire(t,'ready')}),t},t.a=p},function(e,t,r){'use strict';var n=r(1),s=r(0);const o=function(){var e=function(e){var t=[],r={getTrackOrder:function(){return t},setTrackOrder:function(r){var o=[],d=r;!d instanceof Array&&(d=[r]);for(var l=0,c;l<d.length;l++){if(c=d[l],n.a.getLayer(c)){for(;0<=o.indexOf(c);)o.splice(o.indexOf(c),1);o.push(c)}if(n.a.getGroup(c)){let e=l+1;n.a.getGroup(d[l]).eachLayer(function(t){for(;0<=o.indexOf(t.name);)o.splice(o.indexOf(t.name),1);d.splice(e,0,t.name),e+=1})}}for(l=(t||[]).length-1;0<=l;l--)0>o.indexOf(t[l])&&(this.hideLayer(t[l]),this.hideGroup(t[l]),n.a.getLayer(t[l])&&s.a.fire(n.a.getLayer(t[l]),'removed',[e]),n.a.getGroup(t[l])&&s.a.fire(n.a.getGroup(t[l]),'removed',[e]));t=o,this.refresh&&this.refresh(!0),s.a.fire(e,'orderChanged',[o])}};n.a.IE&&(e.setTrackOrder=r.setTrackOrder),'function'!=typeof Object.defineProperty||n.a.IE8||Object.defineProperty(e,'trackOrder',{get:r.getTrackOrder,set:r.setTrackOrder})};return function(t){return t?('undefined'!=typeof t&&(this._container=t,!this._container.style.position&&(this._container.style.position='relative'),s.a.add(this,'sequenceChange',function(){for(;t.firstChild;)t.removeChild(t.firstChild);this._sequence_els.forEach(function(e){t.appendChild(e)});var e=document.createElement('div');e.setAttribute('style','clear: both; float: none; height: 0px; width: 100%;'),t.appendChild(e),t.style.width=this._sequence_els.length+'em'}),this.setSequence(t.textContent||'')),e(this),this):this}}();o.prototype={sequence:null},n.a.IE&&(o.prototype.prototype=document.createElement('div')),o.prototype.setSequence=function(e){this.sequence=this._cleanSequence(e);var t=[],r=this;if(this.sequence){for(var n=this.sequence.split(''),d=0,l;d<n.length;d++)if(l=n[d],l.match(/[A-Za-z]/)){var c=document.createElement('span');c.textContent=l,t.push(c)}t.forEach(function(e,t){e._index=t,e.style.display='block',e.style.cssFloat='left',e.style.styleFloat='left',e.style.height='1.1em',e.style.position='relative',e.addToLayer=o.addElementToLayer,e.addBoxOverlay=o.addBoxOverlayToElement,e.addToLayerWithLink=o.addElementToLayerWithLink,e._renderer=r}),this._sequence_els=t,s.a.fire(this,'sequenceChange')}},o.prototype.colorResidues=function(e,t){var r=Math.floor(1e3*Math.random()).toString();n.a.registerLayer(r,{color:t||'#ff0000'});for(var s=this.getAminoAcidsByPosition(e),o=0;o<s.length;o++)s[o].addToLayer(r);return n.a.getLayer(r)},o.prototype._cleanSequence=function(e){if(!e)return e;var t=e;return t=t.replace(/ /g,''),t=t.replace(/[\n\t\s\d]+/mgi,''),t=t.replace(/\(.*\)/g,''),t},o.prototype.getAminoAcidsByPosition=function(e){var t=this._sequence_els;return e.map(function(e){return 0>e?null:t[e-1]})},o.prototype.getAA=function(e){return this.getAminoAcidsByPosition([e]).shift()},o.prototype.getAminoAcidsByPeptide=function(e){var t=this.sequence.indexOf(e),r=[];return 0>t?(r.addToLayer=function(){},r):(r=r.concat(this._sequence_els.slice(t,t+e.length)),r.addToLayer=r.length?function(e,t,n){return r[0].addBoxOverlay(e,r.length,t,n)}:function(){},r)},o.prototype.toggleLayer=function(e,t){var r=e;return'string'==typeof e?e=n.a.layers[e]:r=e.name,this._container.classList.toggle(r+'_active'),this._container.classList.toggle(r+'_inactive'),t||s.a.fire(e,'visibilityChange',[this,this.isLayerActive(e)]),this},o.prototype.showLayer=function(e,t){var r=n.a.getLayer(e);if(r&&!r.disabled)return this._container.classList.add(r.name+'_active'),this._container.classList.add('active_layer'),this._container.classList.remove(r.name+'_inactive'),t||s.a.fire(r,'visibilityChange',[this,!0]),this},o.prototype.hideLayer=function(e,t){var r=n.a.getLayer(e);if(r&&!r.disabled)return this._container.classList.remove(r.name+'_active'),this._container.classList.remove('active_layer'),this._container.classList.add(r.name+'_inactive'),t||s.a.fire(r,'visibilityChange',[this,!1]),this},o.prototype.registerLayer=function(e,t){return n.a.registerLayer(e,t)},o.prototype.setGroupVisibility=function(e,t,r){var o=n.a.getGroup(e);if(o){var d=o.name,l=this;o.eachLayer(function(e){return n.a.getGroup(e)===e?void 0:this.disabled&&t?void l.hideLayer(e.name):void(!0===t?l.showLayer(e.name):!1===t?l.hideLayer(e.name):l.toggleLayer(e.name))}),null===t||r||s.a.fire(o,'visibilityChange',[l,t])}},o.prototype.hideGroup=function(e,t){this.setGroupVisibility(e,!1,t)},o.prototype.showGroup=function(e,t){this.setGroupVisibility(e,!0,t)},o.prototype.toggleGroup=function(e,t){this.setGroupVisibility(e,t)},o.prototype.isLayerActive=function(e){var t=e;return'string'!=typeof e&&(t=e.name),!e.disabled&&this._container.classList.contains(t+'_active')},o.prototype._setHighlight=function(){},o.prototype.createLayerController=function(){console.log('createLayerController is deprected')},o.prototype.createLayerCheckbox=function(){console.log('createLayerCheckbox is deprecated')},o.prototype._removeOtherBindings=function(e,t){for(var r=this,o=0;o<t._current_bindings.length;o++)if(t._current_bindings[o].renderer==r){var d=t._current_bindings[o];d.layer&&d.layer!=e.name&&(s.a.remove(n.a.getLayer(d.layer),'visibilityChange',d.object_function),s.a.remove(t,'change',d.input_function)),d.group&&d.group!=e.name&&(s.a.remove(n.a.getGroup(d.group),'visibilityChange',d.object_function),s.a.remove(t,'change',d.input_function)),d.group=null,d.layer=null}},o.prototype.createGroupController=function(e,t){var r=n.a.getLayer(e),o=n.a.getGroup(t),d=this;s.a.add(r,'visibilityChange',function(e,t){e==d&&(d.setGroupVisibility(o,t),d.refresh())})},o.addElementToLayer=function(e){return this.addBoxOverlay(e,1),this},o.addElementToLayerWithLink=function(e,t,r){this.classList.add(e);var n=document.createElement('a');for(n.setAttribute('href',t),n.classList.add(e+'_overlay'),n.setAttribute('style','display: box; left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;'),n.textContent='&nbsp;',this.appendChild(n);r&&0<r;)this._renderer._sequence_els[this._index+r].addToLayerWithLink(e,t),r-=1;return this._z_indexes&&this._z_indexes[e]&&(n.style.zIndex=this._z_indexes[e]),this},o.addBoxOverlayToElement=function(t,e,r){'undefined'==typeof r&&(r=1),this.classList.add(t);var o=document.createElement('div');for(o.classList.add(t+'_overlay'),o.setAttribute('style','top: 0px; width: 100%; position: absolute; height: 100%; opacity:'+r+';'),this.appendChild(o);e&&1<e;)this._renderer._sequence_els[this._index+e-1].addBoxOverlay(t,0,r),e-=1;this._z_indexes&&this._z_indexes[t]&&(o.style.zIndex=this._z_indexes[t]);for(var d=['mouseover','mousedown','mousemove','mouseout','click','dblclick','mouseup','mouseenter','mouseleave'],l=0;l<d.length;l++)s.a.add(o,d[l],function(){return function(r){s.a.fire(n.a.getLayer(t),r.type,[r,'SequenceRenderer'])}}(l));return this},o.prototype.reset=function(){for(;0<this._container.classList.length;)this._container.classList.remove(this._container.classList.item(0));for(var e in n.a.groups)n.a.groups.hasOwnProperty(e)&&this.hideGroup(e);for(var t in n.a.layers)n.a.layers.hasOwnProperty(t)&&(this.keeptracks||(this.hideLayer(t,!0),n.a.layers[t].disabled=!0));this.resetAnnotations&&this.resetAnnotations()},o.prototype.withoutRefresh=function(e){var t=this.refresh;this.refresh=function(){},this.refresh.suspended=!0,e.apply(this),this.refresh=t},o.prototype.refresh=function(){var e=-2;this._z_indexes||(this._z_indexes={});for(var t=0;t<(this.trackOrder||[]).length;t++)this.isLayerActive(this.trackOrder[t])&&(Array.prototype.slice.call(document.querySelectorAll('.'+this.trackOrder[t]+'_overlay')).forEach(function(t){t.style.zIndex=e}),this._z_indexes[this.trackOrder[t]]=e,e-=1)},o.prototype.bind=function(e,t){s.a.add(this,e,t)},o.prototype.unbind=function(e,t){s.a.remove(this,e,t)},o.prototype.trigger=function(e,t){s.a.fire(this,e,t)},t.a=o},function(e,t,r){'use strict';var n=r(12),s=r(0),o=r(1);const d='http://www.w3.org/2000/svg';var l=1,c=!1;'ontouchend'in document&&(l=1<window.devicePixelRatio?2:1,c=!0);var u=function(e){var t={},r={},n=e.removeTrack;return e.removeTrack=function(e){n.call(this,e),delete t[e.name],delete r[e.name]},this.isController=function(e){return!!t[e.name]},this.getController=function(e){for(var r in t)if(t.hasOwnProperty(r)&&t[r]==e)return o.a.getLayer(r);return null},this.isControllerExpanded=function(e){return r[e.name]},e.createGroupController=function(n,d){var l=o.a.getLayer(n),c=o.a.getGroup(d);if(l&&c&&!t[l.name]){t[l.name]=c,r[l.name]=!1;var u=this;s.a.add(l,'removed',function(){u.setGroupVisibility(c)}),s.a.add(l,'visibilityChange',function(t,n){0<c.size()&&(!r.hasOwnProperty(l.name)&&(r[l.name]=!1),u.setGroupVisibility(c,r[l.name]&&n,!0),e.refresh())}),s.a.add(c,'visibilityChange',function(e,t){t&&(u.showLayer(l,!0),r[l.name]=!0)}),s.a.remove(l,'_expandevent'),s.a.add(l,'_expandevent',function(){r[l.name]=!r[l.name],u.withoutRefresh(function(){u.setGroupVisibility(c,r[l.name])}),u.refresh(!0)})}},p(function(r,n,s){var d=e.trackOrder;d.trackIndex=function(e){return e?this.indexOf(e.name):this.length},s&&!n&&(n=o.a.getLayer(d[d.trackIndex(s)+1])),d.splice(d.trackIndex(r),1);var l=[];if(t[r.name]){let e=function e(t){o.a.getGroup(t)===t&&o.a.getGroup(t).eachLayer(e),0<=d.trackIndex(t)&&(l=[d.splice(d.trackIndex(t),1)[0]].concat(l))};o.a.getGroup(t[r.name]).eachLayer(e)}if(n){d.splice(d.trackIndex(n),1,r.name,n?n.name:void 0);for(var c=0;c<l.length;c++)l[c]&&d.splice(d.trackIndex(n),0,l[c])}else e.hideLayer(r),o.a.getLayer(r).disabled=!0,l.forEach(function(t){e.hideLayer(t),o.a.getLayer(t).disabled=!0}),d.push(r.name),d=d.concat(l);e.trackOrder=d})},p=function(t){var r=[],n=!1,s={},e=null,o,d,l;let u,p;var h=function(h,m,_,f){var y=this,v=y.reset;null==e&&(y.reset=function(){r=[],v.call(this)},e=!0);var b=function(){window.clearTimeout(s.anim),window.clearTimeout(s.hover);for(var e=0;e<r.length;e++)r[e]!=o&&(r[e].removeAttribute('dragging'),r[e].removeAttribute('transform'),r[e].setAttribute('pointer-events','all'))};r.push(m),m.track=_;var x=function(t){return function(r){r.touches&&1==r.touches.length&&t.call(this,r)}},E=function(e,s,h){if(!g()){var m=f.nearestViewportElement;if(!n){h.setAttribute('dragging','true'),u=null,p=null;var y=h.nearestViewportElement.createSVGPoint();y.x=e.clientX||window.pageXOffset+e.touches[0].clientX,y.y=e.clientY||window.pageYOffset+e.touches[0].clientY;var v=h.nearestViewportElement.getScreenCTM(),E=v.inverse();y=y.matrixTransform(E);var A=y.x,T=y.y,C=function(t){var e=h.nearestViewportElement.createSVGPoint();e.x=t.clientX||window.pageXOffset+t.touches[0].clientX,e.y=t.clientY||window.pageYOffset+t.touches[0].clientY,e=e.matrixTransform(E);var n=e.x-A,s=e.y-T,o=h.getAttribute('transform')||'';return o=o.replace(/\s?translate\([^\)]+\)/,''),o+=' translate('+n+','+s+') ',o=o.replace(/\s*$/,''),h.setAttribute('transform',o),r.forEach(function(r){var n=r.getBBox();n.y<e.y&&n.y>e.y-n.height&&n.x<e.x&&n.x>e.x-n.width&&w.call(r,t,r.track)}),t.stopPropagation(),t.preventDefault(),!1};c&&(C=x(C));var k=function s(o){return o.relatedTarget&&(o.relatedTarget==h||o.relatedTarget.nearestViewportElement==h.nearestViewportElement||o.relatedTarget.nearestViewportElement==m)?void(n&&0<=r.indexOf(o.relatedTarget)&&b()):void(n&&('mouseup'==o.type||'touchend'==o.type)&&(u||p)&&t(d,u,p),m.removeEventListener('touchmove',C,!1),m.removeEventListener('mousemove',C,!1),m.removeEventListener('touchend',s,!1),m.removeEventListener('mouseup',s,!1),m.removeEventListener('mouseout',s,!1),n&&(h.setAttributeNS(null,'pointer-events','all'),h.removeAttribute('transform'),b(),n=!1,l=null))};h.setAttributeNS(null,'pointer-events','none'),h.addEventListener('touchmove',C,!1),h.addEventListener('touchend',k,!1),m.addEventListener('mousemove',C,!1),m.addEventListener('mouseup',k,!1),m.addEventListener('mouseout',k,!1),n=_,o=h}}},A=function(t){E(t,_,m)},w=function(t,e){var c=e?e:_,p=this?this:m;n&&n!=c&&c!=l&&(l=c,s.hover&&window.clearTimeout(s.hover),s.hover=window.setTimeout(function(){if((n.group||c.group)&&(n.group?c.group:!c.group)){if(n.group.name!=c.group.name)return;}else if(n.group||c.group)return;s.anim&&(window.clearInterval(s.anim),s.anim=null),b();for(var e=p,t=[];null!==e&&(e!=o&&0<=r.indexOf(e)&&t.push(e),e=e.nextSibling,e!=o););e=p.previousSibling;for(var l=[];null!==e&&(e!=o&&0<=r.indexOf(e)&&l.push(e),e=e.previousSibling,e!=o););var h=1,g=o.getBBox().height/4;s.anim=window.setInterval(function(){var e=0,r;if(5>h){for(e=0;e<t.length;e++)r=t[e].getAttribute('transform')||'',r=r.replace(/\s?translate\([^\)]+\)/,''),r+=' translate(0,'+h*g+')',t[e].setAttribute('transform',r);for(e=0;0<t.length&&e<l.length;e++)r=l[e].getAttribute('transform')||'',r=r.replace(/\s?translate\([^\)]+\)/,''),r+=' translate(0,'+-1*h*g+')',l[e].setAttribute('transform',r);h+=1}else u=c,d=n,window.clearInterval(s.anim),s.anim=null},30)},300))};h.addEventListener('mousedown',A,!1),h.addEventListener('touchstart',x(A),!1)},g=function(){return h.disabled};return h.spliceFunction=t,h},h=function(e,t){var r=window.navigator.userAgent;0<=r.indexOf('Edge/')?(t=t.replace(/px/g,''),e.setAttribute('transform',t)):e.style.transform=t},g=function(e){var t=this;t.zoom=1,t.nav_width_base=200;var r=t.nav_width_base;t.nav_width=t.nav_width_base;var n=e.group(),u=e.group(),p=e.rect(-10,0,r.toString(),'100%'),g=[12*l,10*l];p.setAttribute('rx',g[0].toString()),p.setAttribute('ry',g[1].toString()),c||p.setAttribute('opacity','0.8'),p.style.stroke='#000000',p.style.strokeWidth='2px',p.style.fill='#000000',p.id='nav_back',n.push(p),t.clipping_id='nav_clipping'+new Date().getTime();var m=document.createElementNS(d,'clipPath');m.id=t.clipping_id;var _=p.cloneNode();_.removeAttribute('id'),_.removeAttribute('opacity'),_.setAttribute('x','0'),_.setAttribute('width',''+(parseInt(_.getAttribute('width'))-10)),_.removeAttribute('style'),_.setAttribute('height','10000'),e.insertBefore(m,e.firstChild),m.appendChild(_);var f=e.crossed_circle(r-(10+11*l),12*l,10*l);f.style.cursor='pointer','undefined'!=typeof matchMedia&&(this.win()||window).matchMedia('print').addListener(function(e){e.matches?(f.setAttribute('display','none'),y.setAttribute('display','none')):(f.setAttribute('display','block'),y.setAttribute('display','none'))}),u.push(f);var y=o.a.IE?e.svgbutton(10,5,65,25,'Edit'):e.button(10,5,65,25,'Edit');y.id='controls',y.parentNode.setAttribute('clip-path','url(#'+t.clipping_id+')'),n.push(o.a.IE?y:y.parentNode),y.addEventListener('click',function(){s.a.fire(t,'toggleEdit'),s.a.fire(t,'click')},!1),n.setAttribute('style','transition: all 0.25s;');var v=y.getAttribute('style'),b=''+(r-(10+11*l))+'px '+12*l+'px';y.setAttribute('style',v+' transition: all 0.25s;'),f.style.transition='all 0.25s',f.style.transformOrigin=b;var x=!0,E=function(r,s){x=!1===r||!0===r?r:!x;var o=s?'all ease-in-out 0.4s':'';let d=e.parentNode.style.transform,c=l,u;(u=d.match(/scale\(([\d\.]+)\)/))&&(c=1);''+(t.nav_width_base-(10+11*l))+'px '+12*c+'px';return x?(t.promote(),h(n,'translate(0,0)'),n.style.transition=o,f._button.removeAttribute('filter'),('ontouchend'in window||window.getComputedStyle(f).getPropertyValue('-ms-transform'))&&h(f,''),h(f,'translate(0,0)'),f.style.transition=o,f.style.transformOrigin=f.getBoundingClientRect().left+'px '+f.getBoundingClientRect().top+' px',t.refresh()):(t.demote(),f.style.transition=o,f.style.transition=o,f.style.transformOrigin=f.getBoundingClientRect().left+'px '+f.getBoundingClientRect().top+' px',h(f,'translate('+-.75*t.nav_width_base+'px,0) rotate(405deg)'),'ontouchend'in window?(h(f,'translate('+-.75*t.nav_width_base+'px,0) rotate(45,'+(t.nav_width_base-(10+11*l))+'px,'+12*l+'px)'),h(n,'translate('+-1*t.nav_width*t.zoom+'px,0)'),n.style.transition=o):(h(n,'translate('+-1*t.nav_width*t.zoom+'px,0)'),n.style.transition=o)),!0};t.move_closer=function(){x||(h(f,'translate('+-.75*t.nav_width_base+'px,0) rotate(405deg)'),'ontouchend'in window&&h(f,'translate('+-.75*t.nav_width_base+'px,0) rotate(45,'+(t.nav_width_base-(10+11*l))+'px,'+12*l+'px)'))},t.hide=function(e){E.call(this,!1,e)},t.show=function(e){E.call(this,!0,e)},t.visible=function(){return x},t.setZoom=function(r){t.nav_width=t.nav_width_base/r,f.setAttribute('transform','scale('+r+','+r+') ');let n=e.parentNode.style.transform,s=l,o;(o=n.match(/scale\(([\d\.]+)\)/))&&(s=1);var d=''+(t.nav_width_base-(10+11*l)).toFixed(2)+'px '+12*s+'px';f.style.transformOrigin=d,f.move(t.nav_width_base-(10+11*l),12*l),p.setAttribute('transform','scale('+r+',1) '),p.setAttribute('ry',g[1].toString()),p.setAttribute('rx',(g[0]/r).toString()),p.setAttribute('x',parseInt(-10/r).toString()),p.setAttribute('width',t.nav_width.toString()),t.zoom=r,E.call(this,x),t.refresh()},f.addEventListener('click',function(){x?t.hide(!0):t.show(!0)},!1)},m=function(e,t){var r=this,o=0,d,u,p;Object(n.a)(e),e.setAttribute('preserveAspectRatio','xMinYMin meet');var h=[];r.reset=function(){for(;e.firstChild;)e.removeChild(e.firstChild);h=[],g=[]};var g=[];r.isEditing=function(){return p},r.refresh=function(){if(((d||[]).forEach(function(e){e.setAttribute('visibility',p?'visible':'hidden')}),(u||[]).forEach(function(e){e.setAttribute('visibility',p?'hidden':'visible')}),p?m.call(this,!0):m.call(this,!1),'none'!=e.getAttribute('display')&&'none'!=e.style.display)&&!(1>g.length)){var t=e.ownerSVGElement.getElementById('nav_back'),r=t.getScreenCTM().inverse().multiply(e.getScreenCTM()).inverse(),n=t.getBBox().width+t.getBBox().x,s=e.createSVGPoint();s.x=n,s.y=0,o=s.matrixTransform(r).x,g.forEach(function(e){var t=0;try{t=e.getBBox().width}catch(e){}if(0<t){var r=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(e.getAttribute('transform')||'');if('undefined'!=typeof r)r=r[2];else return;var n=o-1.5*parseInt(e.getAttribute('width'),10);e.setAttribute('transform','translate('+n+','+r+')')}})}};var m=function(e){h&&(h||[]).forEach(function(t){t.setAttribute('opacity',e?'1':c?'0.5':'0.1'),t.setAttribute('pointer-events',e?'all':'none'),e?t.parentNode.setAttribute('dragenabled','true'):t.parentNode.removeAttribute('dragenabled')})};s.a.add(r,'toggleEdit',function(){p=!('undefined'!=typeof p)||!p,t.disabled=!p,m.call(r,p),r.hide(),r.show(),(d||[]).forEach(function(e){e.setAttribute('visibility',p?'visible':'hidden')}),(u||[]).forEach(function(e){e.setAttribute('visibility',p?'hidden':'visible')})}),this.setViewBox=function(t){e.setAttribute('viewBox',t)},e.style.height='100%',e.style.width='100%',e.setAttribute('height','100%'),e.setAttribute('width','100%'),this.renderTrack=function(n,p,m,_){var f=e.group(),y=e.rect(0,p,'100%',m);y.setAttribute('stroke','#000000'),y.setAttribute('stroke-width','2'),y.setAttribute('fill','url(#simple_gradient)'),y.setAttribute('opacity',c?'0.5':'0.1'),y.setAttribute('pointer-events','none'),h=h||[],h.push(y),f.push(y);var v=_&&_['font-scale']?_['font-scale']:1,b=4/3*l*m*v,x=e.text(b,p+.5*m,n.fullname||n.name);x.setAttribute('height',m),x.setAttribute('width',m),x.setAttribute('font-size',.6*m*v),x.setAttribute('fill','#ffffff'),x.setAttribute('stroke','#ffffff'),x.setAttribute('stroke-width','0'),x.firstChild.setAttribute('dy','0.5ex'),f.push(x),x.setAttribute('pointer-events','none');var E;if(n.href){a_anchor=e.a(n.href);var A=null,w=[.5*m*v,0,m*v*l];w[1]=-.5*(w[2]-m),E=e.circle(w[0]+.5*w[2],.5*m,.5*w[2]),E.setAttribute('fill','#ffffff'),E.setAttribute('opacity','0.1'),a_anchor.appendChild(E);var T=n.href;'string'==typeof T&&T.match(/^javascript\:/)?A='#plus_icon':'function'==typeof T?(A='#plus_icon',a_anchor.setAttribute('href','#'),a_anchor.removeAttribute('target'),a_anchor.addEventListener('click',function(t){return T.call(),t.preventDefault?t.preventDefault():t.returnResult=!1,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1},!1)):A='#new_link_icon',n.icon&&(A=n.icon);var C=e.use(A,w[0],w[1],w[2],w[2]);C.style.cursor='pointer',a_anchor.appendChild(C),a_anchor.setAttribute('transform','translate('+(o-1.5*w[2])+','+p+')'),a_anchor.setAttribute('width',w[2].toString()),g.push(a_anchor)}if(f.addEventListener('touchstart',function(){f.onmouseover=void 0,f.onmouseout=void 0},!1),f.addEventListener('touchend',function(){f.onmouseover=void 0,f.onmouseout=void 0},!1),t.call(this,y,f,n,e),function(){if(!n.group){var r=.5*m*l;d||(d=[]);var s=e.crossed_circle(1.5*r,0,r);s.setAttribute('transform','translate(0,'+(p+.5*m)+') scale('+v+')'),s.firstChild.setAttribute('fill','url(#red_3d)');for(var o=s.childNodes,c=0,u=o.length;c<u;c++)o[c].setAttribute('stroke-width',(r/4).toString());s.addEventListener('click',function(){t.spliceFunction(n)},!1),f.push(s),d.push(s),s.setAttribute('visibility','hidden')}}(),this.isController(n)){u||(u=[]);var k=.5*m*l,S=e.group();E=e.circle(1.5*k,0,k),E.setAttribute('fill','#ffffff'),E.setAttribute('opacity','0.1'),S.push(E);var R=[1.1*k,-1.25*k,2.25*k,-.5*k,1.1*k,.25*k];R[1]+=.5*(k-0*m),R[3]+=.5*(k-0*m),R[5]+=.5*(k-0*m);var L=e.poly(''+R[0]+','+R[1]+' '+R[2]+','+R[3]+' '+R[4]+','+R[5]);this.isControllerExpanded(n)?S.setAttribute('transform','translate(0,'+(p+.5*m)+') scale('+v+') rotate(90,'+1.5*k+','+R[3]+')'):S.setAttribute('transform','translate(0,'+(p+.5*m)+') scale('+v+')'),L.setAttribute('height',1.75*k),L.setAttribute('font-size',1.5*k),L.setAttribute('fill','#ffffff'),L.setAttribute('pointer-events','none'),S.push(L),S.style.cursor='pointer',S.addEventListener('click',function(t){t.stopPropagation(),s.a.fire(n,'_expandevent'),r.isControllerExpanded(n)?S.setAttribute('transform','translate(0,'+(p+.5*m)+') scale('+v+') rotate(90,'+1.5*k+','+R[3]+')'):S.setAttribute('transform','translate(0,'+(p+.5*m)+') scale('+v+')')},!1),f.push(S),u.push(S),S.setAttribute('visibility','hidden')}}};t.a=function(e,t){Object(n.a)(e),this.win=function(){return t.win()},g.call(this,e);var r=e.group();e.insertBefore(r,e.lastChild);var s=document.createElementNS(d,'svg');m.call(this,s,u.call(this,t)),r.appendChild(s),r.setAttribute('clip-path','url(#'+this.clipping_id+')'),this.disable=function(){e.style.display='none',s.style.display='none'},this.enable=function(){e.style.display='block',s.style.display='block'},this.demote=function(){s.hide()},this.promote=function(){this.visible()?s.show():s.hide()},this.setDimensions=function(t,r){e.setAttribute('width',t),e.setAttribute('height',r)}}},function(e,t,r){'use strict';var n=Math.max,s=Math.min,o=Math.abs;(function(e){/*! Hammer.JS - v1.0.7dev - 2014-01-15
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */const t=function(t){function d(){l.READY||(l.event.determineEventTypes(),l.utils.each(l.gestures,function(e){l.detection.register(e)}),l.event.onTouch(l.DOCUMENT,l.EVENT_MOVE,l.detection.detect),l.event.onTouch(l.DOCUMENT,l.EVENT_END,l.detection.detect),l.READY=!0)}var l=function e(t,r){return new e.Instance(t,r||{})};l.defaults={stop_browser_behavior:{userSelect:'none',touchAction:'none',touchCallout:'none',contentZooming:'none',userDrag:'none',tapHighlightColor:'rgba(0,0,0,0)'}},l.HAS_POINTEREVENTS=t.navigator.pointerEnabled||t.navigator.msPointerEnabled,l.HAS_TOUCHEVENTS='ontouchstart'in t,l.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,l.NO_MOUSEEVENTS=l.HAS_TOUCHEVENTS&&t.navigator.userAgent.match(l.MOBILE_REGEX),l.EVENT_TYPES={},l.DIRECTION_DOWN='down',l.DIRECTION_LEFT='left',l.DIRECTION_UP='up',l.DIRECTION_RIGHT='right',l.POINTER_MOUSE='mouse',l.POINTER_TOUCH='touch',l.POINTER_PEN='pen',l.EVENT_START='start',l.EVENT_MOVE='move',l.EVENT_END='end',l.DOCUMENT=t.document,l.plugins=l.plugins||{},l.gestures=l.gestures||{},l.READY=!1,l.utils={extend:function(e,t,r){for(var n in t)void 0!==e[n]&&r||(e[n]=t[n]);return e},each:function(e,t,r){var n,s;if('forEach'in e)e.forEach(t,r);else if(void 0!==e.length){for(n=0,s=e.length;n<s;n++)if(!1===t.call(r,e[n],n,e))return;}else for(n in e)if(e.hasOwnProperty(n)&&!1===t.call(r,e[n],n,e))return},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],r=[];return l.utils.each(e,function(e){t.push('undefined'==typeof e.clientX?e.pageX:e.clientX),r.push('undefined'==typeof e.clientY?e.pageY:e.clientY)}),{pageX:(s.apply(Math,t)+n.apply(Math,t))/2,pageY:(s.apply(Math,r)+n.apply(Math,r))/2}},getVelocity:function(e,t,r){return{x:o(t/e)||0,y:o(r/e)||0}},getAngle:function(e,t){var r=t.pageY-e.pageY,n=t.pageX-e.pageX;return 180*Math.atan2(r,n)/Math.PI},getDirection:function(e,t){var r=o(e.pageX-t.pageX),n=o(e.pageY-t.pageY);return r>=n?0<e.pageX-t.pageX?l.DIRECTION_LEFT:l.DIRECTION_RIGHT:0<e.pageY-t.pageY?l.DIRECTION_UP:l.DIRECTION_DOWN},getDistance:function(e,t){var r=t.pageX-e.pageX,n=t.pageY-e.pageY;return Math.sqrt(r*r+n*n)},getScale:function(e,t){return 2<=e.length&&2<=t.length?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return 2<=e.length&&2<=t.length?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==l.DIRECTION_UP||e==l.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){t&&e&&e.style&&(l.utils.each(['webkit','khtml','moz','Moz','ms','o',''],function(r){l.utils.each(t,function(t,n){r&&(n=r+n.substring(0,1).toUpperCase()+n.substring(1)),n in e.style&&(e.style[n]=t)})}),'none'==t.userSelect&&(e.onselectstart=function(){return!1}),'none'==t.userDrag&&(e.ondragstart=function(){return!1}))}},l.Instance=function(e,t){var r=this;return d(),this.element=e,this.enabled=!0,this.options=l.utils.extend(l.utils.extend({},l.defaults),t||{}),this.options.stop_browser_behavior&&l.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),l.event.onTouch(e,l.EVENT_START,function(e){r.enabled&&l.detection.startDetect(r,e)}),this},l.Instance.prototype={on:function(e,t){var r=e.split(' ');return l.utils.each(r,function(e){this.element.addEventListener(e,t,!1)},this),this},off:function(e,t){var r=e.split(' ');return l.utils.each(r,function(e){this.element.removeEventListener(e,t,!1)},this),this},trigger:function(e,t){t||(t={});var r=l.DOCUMENT.createEvent('Event');r.initEvent(e,!0,!0),r.gesture=t;var n=this.element;return l.utils.hasParent(t.target,n)&&(n=t.target),n.dispatchEvent(r),this},enable:function(e){return this.enabled=e,this}};var c=null,u=!1,p=!1;return l.event={bindDom:function(e,t,r){var n=t.split(' ');l.utils.each(n,function(t){e.addEventListener(t,r,!1)})},onTouch:function(e,t,r){var n=this;this.bindDom(e,l.EVENT_TYPES[t],function(s){var o=s.type.toLowerCase();if(!(o.match(/mouse/)&&p)){o.match(/touch/)||o.match(/pointerdown/)||o.match(/mouse/)&&1===s.which?u=!0:o.match(/mouse/)&&!s.which&&(u=!1),o.match(/touch|pointer/)&&(p=!0);var d=0;u&&(l.HAS_POINTEREVENTS&&t!=l.EVENT_END?d=l.PointerEvent.updatePointer(t,s):o.match(/touch/)?d=s.touches.length:!p&&(d=o.match(/up/)?0:1),0<d&&t==l.EVENT_END?t=l.EVENT_MOVE:!d&&(t=l.EVENT_END),(d||null===c)&&(c=s),r.call(l.detection,n.collectEventData(e,t,n.getTouchList(c,t),s)),l.HAS_POINTEREVENTS&&t==l.EVENT_END&&(d=l.PointerEvent.updatePointer(t,s))),d||(c=null,u=!1,p=!1,l.PointerEvent.reset())}},{passive:!0})},determineEventTypes:function(){var e;e=l.HAS_POINTEREVENTS?l.PointerEvent.getEvents():l.NO_MOUSEEVENTS?['touchstart','touchmove','touchend touchcancel']:['touchstart mousedown','touchmove mousemove','touchend touchcancel mouseup'],l.EVENT_TYPES[l.EVENT_START]=e[0],l.EVENT_TYPES[l.EVENT_MOVE]=e[1],l.EVENT_TYPES[l.EVENT_END]=e[2]},getTouchList:function(e){return l.HAS_POINTEREVENTS?l.PointerEvent.getTouchList():e.touches?e.touches:(e.identifier=1,[e])},collectEventData:function(e,t,r,n){var s=l.POINTER_TOUCH;return(n.type.match(/mouse/)||l.PointerEvent.matchType(l.POINTER_MOUSE,n))&&(s=l.POINTER_MOUSE),{center:l.utils.getCenter(r),timeStamp:new Date().getTime(),target:n.target,touches:r,eventType:t,pointerType:s,srcEvent:n,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return l.detection.stopDetect()}}}},l.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return l.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==l.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var r=t.pointerType,n={};return n[l.POINTER_MOUSE]=r===t.MSPOINTER_TYPE_MOUSE||r===l.POINTER_MOUSE,n[l.POINTER_TOUCH]=r===t.MSPOINTER_TYPE_TOUCH||r===l.POINTER_TOUCH,n[l.POINTER_PEN]=r===t.MSPOINTER_TYPE_PEN||r===l.POINTER_PEN,n[e]},getEvents:function(){return['pointerdown MSPointerDown','pointermove MSPointerMove','pointerup pointercancel MSPointerUp MSPointerCancel']},reset:function(){this.pointers={}}},l.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:l.utils.extend({},t),lastEvent:!1,name:''},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst.options;return l.utils.each(this.gestures,function(r){if(!this.stopped&&!1!==t[r.name]&&!1===r.handler.call(r,e,this.current.inst))return this.stopDetect(),!1},this),this.current&&(this.current.lastEvent=e),e.eventType==l.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=l.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;t&&(e.touches.length!=t.touches.length||e.touches===t.touches)&&(t.touches=[],l.utils.each(e.touches,function(e){t.touches.push(l.utils.extend({},e))}));var r=e.timeStamp-t.timeStamp,n=e.center.pageX-t.center.pageX,s=e.center.pageY-t.center.pageY,o=l.utils.getVelocity(r,n,s),d,c;return'end'===e.eventType?(d=this.current.lastEvent&&this.current.lastEvent.interimAngle,c=this.current.lastEvent&&this.current.lastEvent.interimDirection):(d=this.current.lastEvent&&l.utils.getAngle(this.current.lastEvent.center,e.center),c=this.current.lastEvent&&l.utils.getDirection(this.current.lastEvent.center,e.center)),l.utils.extend(e,{deltaTime:r,deltaX:n,deltaY:s,velocityX:o.x,velocityY:o.y,distance:l.utils.getDistance(t.center,e.center),angle:l.utils.getAngle(t.center,e.center),interimAngle:d,direction:l.utils.getDirection(t.center,e.center),interimDirection:c,scale:l.utils.getScale(t.touches,e.touches),rotation:l.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var t=e.defaults||{};return void 0===t[e.name]&&(t[e.name]=!0),l.utils.extend(l.defaults,t,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},l.gestures.Drag={name:'drag',index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,t){if(l.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+'end',e),void(this.triggered=!1);if(!(0<t.options.drag_max_touches&&e.touches.length>t.options.drag_max_touches))switch(e.eventType){case l.EVENT_START:this.triggered=!1;break;case l.EVENT_MOVE:if(e.distance<t.options.drag_min_distance&&l.detection.current.name!=this.name)return;if(l.detection.current.name!=this.name&&(l.detection.current.name=this.name,t.options.correct_for_drag_min_distance&&0<e.distance)){var r=o(t.options.drag_min_distance/e.distance);l.detection.current.startEvent.center.pageX+=e.deltaX*r,l.detection.current.startEvent.center.pageY+=e.deltaY*r,e=l.detection.extendEventData(e)}(l.detection.current.lastEvent.drag_locked_to_axis||t.options.drag_lock_to_axis&&t.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var n=l.detection.current.lastEvent.direction;e.drag_locked_to_axis&&n!==e.direction&&(l.utils.isVertical(n)?e.direction=0>e.deltaY?l.DIRECTION_UP:l.DIRECTION_DOWN:e.direction=0>e.deltaX?l.DIRECTION_LEFT:l.DIRECTION_RIGHT),this.triggered||(t.trigger(this.name+'start',e),this.triggered=!0),t.trigger(this.name,e),t.trigger(this.name+e.direction,e),(t.options.drag_block_vertical&&l.utils.isVertical(e.direction)||t.options.drag_block_horizontal&&!l.utils.isVertical(e.direction))&&e.preventDefault();break;case l.EVENT_END:this.triggered&&t.trigger(this.name+'end',e),this.triggered=!1;}}},l.gestures.Hold={name:'hold',index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case l.EVENT_START:clearTimeout(this.timer),l.detection.current.name=this.name,this.timer=setTimeout(function(){'hold'==l.detection.current.name&&t.trigger('hold',e)},t.options.hold_timeout);break;case l.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case l.EVENT_END:clearTimeout(this.timer);}}},l.gestures.Release={name:'release',index:Infinity,handler:function(e,t){e.eventType==l.EVENT_END&&t.trigger(this.name,e)}},l.gestures.Swipe={name:'swipe',index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==l.EVENT_END){if(0<t.options.swipe_max_touches&&e.touches.length<t.options.swipe_min_touches&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},l.gestures.Tap={name:'tap',index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==l.EVENT_END&&'touchcancel'!=e.srcEvent.type){var r=l.detection.previous,n=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;r&&'tap'==r.name&&e.timeStamp-r.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger('doubletap',e),n=!0),(!n||t.options.tap_always)&&(l.detection.current.name='tap',t.trigger(l.detection.current.name,e))}}},l.gestures.Touch={name:'touch',index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,t){return t.options.prevent_mouseevents&&e.pointerType==l.POINTER_MOUSE?void e.stopDetect():void(t.options.prevent_default&&e.preventDefault(),e.eventType==l.EVENT_START&&t.trigger(this.name,e))}},l.gestures.Transform={name:'transform',index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,t){if(l.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+'end',e),void(this.triggered=!1);if(!(2>e.touches.length))switch(t.options.transform_always_block&&e.preventDefault(),e.eventType){case l.EVENT_START:this.triggered=!1;break;case l.EVENT_MOVE:var r=o(1-e.scale),n=o(e.rotation);if(r<t.options.transform_min_scale&&n<t.options.transform_min_rotation)return;l.detection.current.name=this.name,this.triggered||(t.trigger(this.name+'start',e),this.triggered=!0),t.trigger(this.name,e),n>t.options.transform_min_rotation&&t.trigger('rotate',e),r>t.options.transform_min_scale&&(t.trigger('pinch',e),t.trigger('pinch'+(1>e.scale?'in':'out'),e));break;case l.EVENT_END:this.triggered&&t.trigger(this.name+'end',e),this.triggered=!1;}}},'function'==typeof define&&r(22)?define(function(){return l}):'object'==typeof e&&e.exports?e.exports=l:t.Hammer=l,l}(window)}).call(t,r(6)(e))},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,r){'use strict';var n=r(10),s=r(3);const o=Symbol('last_retrieved_gene');class d extends s.a{static get observedAttributes(){return['geneid']}constructor(){super()}connectedCallback(){super.connectedCallback(),c.call(this),this.geneid&&u.call(this)}attributeChangedCallback(e){if('geneid'===e&&this.renderer)return void u.call(this)}get geneid(){return this.getAttribute('geneid')}set geneid(e){this.setAttribute('geneid',e)}}let l=function(){if(this.geneid&&this[o]!==this.geneid){this[o]=this.geneid,console.log('Getting data for ',this.geneid);var e=new n.a;e.geneid=this.geneid,this.hasAttribute('reviewed')&&(e.reviewed=!0),e.exon_margin=300,this.nt_mapping&&(e.nt_mapping=this.nt_mapping),this.ready||(e.registerSequenceRenderer(this.renderer),e.bind('requestComplete',()=>{this.renderer.hideAxis(),this.renderer.fitZoom()}),this.ready=new Promise((t)=>{e.bind('requestComplete',()=>{this.uniprots=Object.keys(e.result._raw_data.data).map((e)=>e.toUpperCase()),e.reviewed&&(this.uniprots=this.uniprots.filter((t)=>t===e.swissprot.toUpperCase())),this.refreshTracks(),t(),delete this.ready;var r=new Event('ready',{bubbles:!0});this.dispatchEvent(r)})})),e.retrieve(this.accession||''+this.geneid)}},c=function(){this.renderer.trackOrder=[],this.renderer.reset()},u=function(){this.renderer.bind('sequenceChange',l.bind(this)),this.renderer.setSequence('M')};customElements.define('x-geneviewer',d),t.a=d},function(e,t,r){'use strict';function n(){return Reflect.construct(HTMLElement,[],Object.getPrototypeOf(this).constructor)}var s=r(3),o=r(7),d=r(1),l=this;const c=new Map;let u=function(){let e=this.getAttribute('src');return fetch(e).then((e)=>e.text())};Object.setPrototypeOf(n.prototype,HTMLElement.prototype),Object.setPrototypeOf(n,HTMLElement);let p=(e,t)=>new Promise((r)=>{(function(){var n={gotResult:function(){r(e.sequence)},acc:t};e.trigger('readerRegistered',[n]),n.gotResult()})()}),h=(e,t)=>{e.forEach(function(e){if(e.options){if(e.options.offset)return void(e.options.offset+=t);e.options.offset=t}else e.options={offset:t}})},g=(e,t,n)=>{if(Array.isArray(n)){var r={};console.log('No accession provided'),r.DEFAULTACC=n,n=r}for(let o of Object.keys(n)){let c=n[o];h(c,0),e.renderObjects(t,c.filter(function(e){return!e.track}));var s={};c.filter(function(e){return e.track}).forEach(function(e){s[e.track]=s[e.track]||[],s[e.track].push(e)}),Object.keys(s).forEach(function(t){d.a.getLayer(t)&&(d.a.registerLayer(t,{},[e]),e.trackOrder=e.trackOrder,e.renderObjects(t,s[t]))}),e.trigger('resultsRendered',[l]),e.refresh()}},m=(e,t,r,n)=>{const s=c.get(t)||new o.a;c.set(t,s),p(e).then((o)=>{s.eval(t,()=>{s.eval({data:'renderData(input.sequence,input.data,input.acc,input.track)',input:{sequence:o,data:r,track:n},onerror:(e)=>{throw new Error(e)},callback:g.bind(null,e,n)})})})};class _ extends n{static get observedAttributes(){return['track','src']}constructor(){super()}connectedCallback(){this.script=u.call(this)}render(e,t,r){this.script.then((n)=>{m(e,n,t,r)})}get data(){return this._data}set data(e){this._data=e,this.render(this.ownerDocument.getElementById(this.getAttribute('renderer')).renderer,this._data,this.getAttribute('track'))}attributeChangedCallback(e){this.hasAttribute('renderer')&&this.data&&'track'===e&&this.render(document.getElementById(this.getAttribute('renderer')).renderer,this._data,this.getAttribute('track')),'src'===e&&(this.script=u.call(this))}}customElements.define('x-trackrenderer',_);let f=function(){d.a.registerLayer(this.name,{}),d.a.getLayer(this.name).fullname=this.fullname||this.name,d.a.getLayer(this.name).scales.clear();for(let e of this.scale)d.a.getLayer(this.name).scales.add(e)};class y extends n{static get observedAttributes(){return['name','fullname','scale']}constructor(){super()}connectedCallback(){f.call(this)}get name(){return this.getAttribute('name')}set name(e){return this.setAttribute('name',e)}get layer(){return d.a.getLayer(this.name)}get fullname(){return this.getAttribute('fullname')}set fullname(e){return this.setAttribute('fullname',e)}get scale(){return(this.getAttribute('scale')||'').split(',')}set scale(e){return this.setAttribute('scale',e)}attributeChangedCallback(){f.call(this)}}customElements.define('x-gatortrack',y),t.a=_}]);